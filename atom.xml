<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>IFwhale</title>
  
  <subtitle>个人工作学习生活记录</subtitle>
  <link href="https://ifwhale.top/atom.xml" rel="self"/>
  
  <link href="https://ifwhale.top/"/>
  <updated>2024-10-21T13:10:46.139Z</updated>
  <id>https://ifwhale.top/</id>
  
  <author>
    <name>刘贝宁</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>量化实习 v4丨Week 6：逐渐上手</title>
    <link href="https://ifwhale.top/posts/6a6a1b0a/"/>
    <id>https://ifwhale.top/posts/6a6a1b0a/</id>
    <published>2024-10-21T13:04:29.000Z</published>
    <updated>2024-10-21T13:10:46.139Z</updated>
    
    <content type="html"><![CDATA[<p>果然印证了我的判断：人的适应能力比自己想象的更强。这周开始，我对于深度学习的框架有了一定掌握，并且开始提出自己的质疑和思考。</p><p>这一次的训练大幅提升了训练集容量，这么做的结果是过拟合与不能拟合的情况确实减少了，但坏消息是，回测的情况看上去依然很差。仔细排查了代码，我发现一个可能很致命的问题：原本代码的损失函数，是将预测值与真实值的相关系数取绝对值再取负数。这一点致命之处在于，无法区分正相关与负相关，可能导致模型向相关系数为负且不断接近 -1 的方向收敛！</p><p>于是我绘制了不少图表，整理了一波这次的训练结果，做好了下周向带教老师回报的准备。</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;果然印证了我的判断：人的适应能力比自己想象的更强。这周开始，我对于深度学习的框架有了一定掌握，并且开始提出自己的质疑和思考。&lt;/p&gt;
&lt;p&gt;这一次的训练大幅提升了训练集容量，这么做的结果是过拟合与不能拟合的情况确实减少了，但坏消息是，回测的情况看上去依然很差。仔细排查了代码，我发现一个可能很致命的问题：原本代码的损失函数，是将预测值与真实值的相关系数取</summary>
        
      
    
    
    
    <category term="量化实习日记" scheme="https://ifwhale.top/categories/%E9%87%8F%E5%8C%96%E5%AE%9E%E4%B9%A0%E6%97%A5%E8%AE%B0/"/>
    
    
    <category term="Quant" scheme="https://ifwhale.top/tags/Quant/"/>
    
    <category term="实习" scheme="https://ifwhale.top/tags/%E5%AE%9E%E4%B9%A0/"/>
    
    <category term="日记" scheme="https://ifwhale.top/tags/%E6%97%A5%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>量化实习 v3丨Week 5：群策群力</title>
    <link href="https://ifwhale.top/posts/42d27edd/"/>
    <id>https://ifwhale.top/posts/42d27edd/</id>
    <published>2024-10-11T14:47:10.000Z</published>
    <updated>2024-10-11T15:01:39.718Z</updated>
    
    <content type="html"><![CDATA[<p>时间过得好快，而我的进展好慢。</p><p>带教大概看出我的状态不是很好，遂要求我每日提交一段工作总结到微信群。这样倒挺好的，还能倒逼自己一下。</p><p>这周做的事情也不太多，回测数据并形成了一份训练及结果的报告（用 <a href="https://marp.app/">Marp</a> 做完了 Slides，感觉还不错，效率挺高的），跟带教在线展示讨论了一会，确定了下一步能够改进的方向。</p><p>这周结束前还分到了一个新的北京服务器，终于不用再跟其他实习生抢算力了！</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;时间过得好快，而我的进展好慢。&lt;/p&gt;
&lt;p&gt;带教大概看出我的状态不是很好，遂要求我每日提交一段工作总结到微信群。这样倒挺好的，还能倒逼自己一下。&lt;/p&gt;
&lt;p&gt;这周做的事情也不太多，回测数据并形成了一份训练及结果的报告（用 &lt;a href=&quot;https://marp.app/&quot;&gt;Marp&lt;/a&gt; 做完了</summary>
        
      
    
    
    
    <category term="量化实习日记" scheme="https://ifwhale.top/categories/%E9%87%8F%E5%8C%96%E5%AE%9E%E4%B9%A0%E6%97%A5%E8%AE%B0/"/>
    
    
    <category term="Quant" scheme="https://ifwhale.top/tags/Quant/"/>
    
    <category term="实习" scheme="https://ifwhale.top/tags/%E5%AE%9E%E4%B9%A0/"/>
    
    <category term="日记" scheme="https://ifwhale.top/tags/%E6%97%A5%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>量化实习 v3丨Week 4：深度幽灵</title>
    <link href="https://ifwhale.top/posts/d3610788/"/>
    <id>https://ifwhale.top/posts/d3610788/</id>
    <published>2024-10-07T13:26:23.000Z</published>
    <updated>2024-10-07T13:54:48.057Z</updated>
    
    <content type="html"><![CDATA[<p>由于国庆前仅有 1 个工作日，因此将这个工作日也合并到上周一起写了。</p><p>本周状态有所回升，RNN 的代码总算跑起来了。由于设备性能的限制，仅使用了小样本数据来试跑，可惜效果不佳。此时带教总算想起他还没有给我公司的算力，于是我又吭哧吭哧把代码转移到服务器上，在节前将更大样本的代码跑起来了。</p><p>滚动训练-预测的模式下，需要训练大量模型，我也肉眼盯了一下各个模型的训练过程，发现训练与训练的悲欢并不相通。有的模型一开始测试集 loss 很大，但是能够迅速下降，最后收敛到较低数值；有的一开始就 loss 很小，但是随着训练进行反而越来越大；有的在测试集 loss 下降到较低位置后开始上升，有明显过拟合现象；有的则半死不活，loss 几乎没有什么变化。</p><p>这让我开始思考，训练时是不是应该对各个模型加以更加精细的调教，或者在训练失败的情况下，多随机几次参数重新训练一下。当然，重新训练的成本很高，因此当务之急，似乎是考察一下当前训练的结果，并看看不同训练效果下，因子回测效果如何。</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;由于国庆前仅有 1 个工作日，因此将这个工作日也合并到上周一起写了。&lt;/p&gt;
&lt;p&gt;本周状态有所回升，RNN</summary>
        
      
    
    
    
    <category term="量化实习日记" scheme="https://ifwhale.top/categories/%E9%87%8F%E5%8C%96%E5%AE%9E%E4%B9%A0%E6%97%A5%E8%AE%B0/"/>
    
    
    <category term="Quant" scheme="https://ifwhale.top/tags/Quant/"/>
    
    <category term="实习" scheme="https://ifwhale.top/tags/%E5%AE%9E%E4%B9%A0/"/>
    
    <category term="日记" scheme="https://ifwhale.top/tags/%E6%97%A5%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>量化实习 v3丨Week 3：仍然没有适应</title>
    <link href="https://ifwhale.top/posts/550011ce/"/>
    <id>https://ifwhale.top/posts/550011ce/</id>
    <published>2024-09-20T14:49:22.000Z</published>
    <updated>2024-09-20T15:18:01.210Z</updated>
    
    <content type="html"><![CDATA[<p>第三周了，虽然这周只有三天，但是状态依然很差。待在荒郊野岭公寓中的小房间里，连续几日不与任何人接触，寂静得令人发疯。</p><p>思维不清晰，稍微想一会就猪脑过载，编码进度缓慢。身后就是床，让人经常想偷懒，完全无法进入工作状态。无法推进工作的焦虑和因焦虑而导致的工作无法推进形成正反馈，将焦虑推向至高峰。</p><p>这周仍旧对 GRU+NN 的深度学习框架进行修改，解决了上周遗留下来的几个问题，现在终于能跑了，但是注意到几个问题：</p><ol><li>模型收敛疑似不正常，随着 epochs 迭代，测试集能够逐渐收敛，而训练集却常常震荡，非常奇怪。</li><li>模型运算耗时相当长。我只用了今年到最近为止的数据，且上百条的特征只随机选取了其中的 10 个，训练一个模型也需要几分钟。如果每小时迭代一次模型，那么相当于需要训练 5000 多个模型！这意味着我的电脑根本无法完成任务，只能寄希望于公司未来可能提供的服务器算力，以及减少模型训练的次数，将模型的利用最大化。</li><li>代码非常屎山，我自己都看不下去。溢出屏幕的语句、数十个参数的 class、毫无章法的代码组织形式，使得这一份工作到目前为止相当丑陋。好在带教没有 push，先硬着头皮这么用吧。</li></ol><p>总而言之，这个框架踉踉跄跄地能跑起来了，但是目前看来并没有机会计算出足够用来回测的因子。</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;第三周了，虽然这周只有三天，但是状态依然很差。待在荒郊野岭公寓中的小房间里，连续几日不与任何人接触，寂静得令人发疯。&lt;/p&gt;
&lt;p&gt;思维不清晰，稍微想一会就猪脑过载，编码进度缓慢。身后就是床，让人经常想偷懒，完全无法进入工作状态。无法推进工作的焦虑和因焦虑而导致的工作无法推进形成正反馈，将焦虑推向至高峰。&lt;/p&gt;
&lt;p&gt;这周仍旧对 GRU+NN</summary>
        
      
    
    
    
    <category term="量化实习日记" scheme="https://ifwhale.top/categories/%E9%87%8F%E5%8C%96%E5%AE%9E%E4%B9%A0%E6%97%A5%E8%AE%B0/"/>
    
    
    <category term="Quant" scheme="https://ifwhale.top/tags/Quant/"/>
    
    <category term="实习" scheme="https://ifwhale.top/tags/%E5%AE%9E%E4%B9%A0/"/>
    
    <category term="日记" scheme="https://ifwhale.top/tags/%E6%97%A5%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>量化实习 v3丨Week 1 &amp; 2：赶鸭子上架</title>
    <link href="https://ifwhale.top/posts/b8fcf2dc/"/>
    <id>https://ifwhale.top/posts/b8fcf2dc/</id>
    <published>2024-09-17T13:51:11.000Z</published>
    <updated>2024-09-20T15:16:54.538Z</updated>
    
    <content type="html"><![CDATA[<p>再一次开始一段实习时，发现自己写日记的冲动没有之前那么强烈了，不过思来想去，保持一个思绪的出口总是有利的，于是暂定接下来一周发表一篇周记。</p><p>由于入职匆忙，来到北京鸟不屙屎的地方租了个月租 2000 的一居室，前两周总体来说是兵荒马乱的，现在才有时间（和心情）坐下来总结一番，因此前两周就先合并这么一起写了。</p><p>这次顺利入职了一家稍微有点名气的私募，研究加密货币的交易。在另一个不太想接的offer到期前极限笔面收到这家公司的聘任，称得上是幸运了。老板和带教都很好说话，虽然见不到面，但是微信聊起来都难得地有礼貌修养。目前我还没有被 push 过，但我还是会紧张地 push 自己。</p><p>我目前主攻方向是深度学习高频因子挖掘，非常酷的新方向，唯一的麻烦在于我除了上课以外，基本没有接触过深度学习……本以为凭借自己的快速学习能力可以三两下上手，可还是费了一两天才把代码看明白。接下来的一周需要修改模型来适应我的研究方向。尽管可能还会遇到不少问题，不过我想这应该仅仅是一个工程问题了。</p><p>既然入职了就不过是好好干而已，可是焦虑似乎却未见减少。前两天忍不住把简历发给一个猎头并咨询道，加上目前刚开始的这一段实习，大概可以进入什么公司？猎头的答复是，有的公司（如稳博）对我目前公司出来的实习生很感兴趣，但有的公司（如灵均九坤）就不太喜欢。老实说，这不算一个坏消息，因为经过前段时间的拷打，我甚至没有对诸如稳博这种级别的公司抱有期望。这至少说明，我接下来的经历足够我尝试一些主流的量化机构。不过猎头也提到，应聘还是得看笔面试表现，再次提醒我笔面水平要过硬。这意味着数学、统计、脑筋急转弯、算法等等素质缺一不可，都是接下来需要逐步准备的。而深度学习的知识学习和训练、竞赛等丰富简历的经历、健身、阅读、兴趣爱好……工作外能做的事情实在太多了，出租屋里的环境对工作又不太友好，这些对我来说都是令人焦虑的因素。</p><p>我深刻地知道，目标无法退让的条件下，缓解焦虑最好的办法就是当即着手去做，因此我也希望自己能过上更有组织性的生活，这意味着克服拖延、有节奏地计划每一天的行动并执行。不如先从简单的开始做起，写下明天的任务单，看看生活会有什么改变吧。</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;再一次开始一段实习时，发现自己写日记的冲动没有之前那么强烈了，不过思来想去，保持一个思绪的出口总是有利的，于是暂定接下来一周发表一篇周记。&lt;/p&gt;
&lt;p&gt;由于入职匆忙，来到北京鸟不屙屎的地方租了个月租 2000</summary>
        
      
    
    
    
    <category term="量化实习日记" scheme="https://ifwhale.top/categories/%E9%87%8F%E5%8C%96%E5%AE%9E%E4%B9%A0%E6%97%A5%E8%AE%B0/"/>
    
    
    <category term="Quant" scheme="https://ifwhale.top/tags/Quant/"/>
    
    <category term="实习" scheme="https://ifwhale.top/tags/%E5%AE%9E%E4%B9%A0/"/>
    
    <category term="日记" scheme="https://ifwhale.top/tags/%E6%97%A5%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>阅读笔记丨《额尔古纳河右岸》——少数民族消亡史</title>
    <link href="https://ifwhale.top/posts/d0a0c715/"/>
    <id>https://ifwhale.top/posts/d0a0c715/</id>
    <published>2024-08-01T08:50:12.000Z</published>
    <updated>2024-08-01T08:57:26.884Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/posts/d0a0c715/s1515368.jpg" alt="额尔古纳河右岸"></p><p>额尔古纳河右岸一书，就是一部古老的游牧文明被现代文明蚕食直至消亡的历史。鄂温克族这一民族仍有后裔，但是不再放牧驯鹿、不再居住在乌力楞，也不再有萨满了，这实际上意味着这一文明的消失。</p><p>鄂温克族的生活是相当有秩序的。他们分布在一个个乌力楞中，逐水草而居，有自己的神明。每个部落各自有酋长和萨满，一个酋长死后会推举新的酋长，一个萨满死后三年会自然诞生一名新的萨满。他们将去世的孩子葬在向阳的山坡，将去世的成人葬在树间的山风中。在大兴安岭山脉中，这样的民族自有其生存循环的逻辑，他们的生活方式是自洽的，本可以就这样无穷尽地继承下去。</p><p>然而，自从日本人进入山林开始，直到新中国的工业轰隆声笼罩整座山脉，传统文明与现代文明开始发生无法避免的冲突与融合。当族人被强迫下山训练，当林中树木和苔藓越来越少，这一文明的生活循环被掐断了。他们无法再依赖原有的方式继续下去，这一民族被迫与外界进行频繁接触，其所赖以生存的自然环境受到连续的挤压与破坏。而文明与文明之间并不兼容，最终一定会有一种文明将另一种文明吞没，而鄂温克族的文明就是被吞没的那一个。</p><p>仔细想想，外面的世界真的不可接受吗？小说对于这一问题的描述相当冷静。对山林的开发使得这里不再适宜大量驯鹿和鄂温克族人居住，但是社会主义的世界也带来了免费安全的住宿条件，提供了良好的医疗和教育资源。人们的寿命将得到大幅延长，不用再为寒冷饥饿所威胁。外界的文明早就铺好道路，准备将这一民族的人们全部接纳为它的一部分。</p><p>然而作为代价的，是整片浩瀚的星空、森林的露水、充满神性的驯鹿、这一古老的文化体系。这一文化是如此美丽，人们对于自然的深刻理解如此动人。读完后我想，故事中的人们无论是喜是悲，都具有如此鲜活、如此厚重的生命；而习惯居住于城市中的的众人，却好像都沿着一条既定的人生路径盲目地行走，轻飘飘地像一片羽毛。究竟怎样的生活称得上更好呢？</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;&lt;img src=&quot;/posts/d0a0c715/s1515368.jpg&quot;</summary>
        
      
    
    
    
    <category term="赏阅纪" scheme="https://ifwhale.top/categories/%E8%B5%8F%E9%98%85%E7%BA%AA/"/>
    
    
    <category term="阅读笔记" scheme="https://ifwhale.top/tags/%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/"/>
    
    <category term="额尔古纳河右岸" scheme="https://ifwhale.top/tags/%E9%A2%9D%E5%B0%94%E5%8F%A4%E7%BA%B3%E6%B2%B3%E5%8F%B3%E5%B2%B8/"/>
    
  </entry>
  
  <entry>
    <title>量化实习 v2丨Day -1：大结局 &amp; 复盘</title>
    <link href="https://ifwhale.top/posts/953424b/"/>
    <id>https://ifwhale.top/posts/953424b/</id>
    <published>2024-07-16T04:23:44.000Z</published>
    <updated>2024-07-23T08:33:13.496Z</updated>
    
    <content type="html"><![CDATA[<p>距离职仅剩最后几日了，三个月的时间过得真快。</p><p>最后的时间里，带教没有再给我安排策略研究的工作，而是让我对数据再作一番筛选，算是用任务填充一下离职前的工作空窗。但我心猿意马，已经在考虑下一段实习的投递，因此大部分时间无心工作，转而刷了十几道 LeetCode 题。</p><p>既然如此，这几日的实习日记也就不写了，不如好好总结一下这段时间的经历与思考，复盘一下成功与失败的经验。平时产生的想法总是零零散散，因此这篇文章也许会写得慢一些，并时不时增添新的内容。</p><h2 id="这段时间，发生了什么？"><a href="#这段时间，发生了什么？" class="headerlink" title="这段时间，发生了什么？"></a>这段时间，发生了什么？</h2><h3 id="面试与-Offer"><a href="#面试与-Offer" class="headerlink" title="面试与 Offer"></a>面试与 Offer</h3><p>三个月以来，我在一家期货公司担任量化投研实习生。进入这家公司的经历很有趣，当时我正被上一家公司裁掉，一股脑投了几十份简历，回应的公司当然也寥寥无几。接到这家期货公司的电话时，面试官完全没有问那些典型的量化面试题，而是深度追问了我过往的实习项目，并确认了一下我的代码水平。</p><p>这家公司就这么发了 offer。</p><h3 id="我做的事情"><a href="#我做的事情" class="headerlink" title="我做的事情"></a>我做的事情</h3><p>入职以后，我花了三周左右的时间，专门负责寻找和整理数据。由于我将会主要开展基本面量化研究，因此对数据的发现和筛选就极为重要。最初，我主要对黑色板块进行需求分析，因此我对照着研报，整理了数百条黑色品种下游行业的基本面指标，包括产量、销量、开工率等等。</p><p>数据整理完成后，我便开始对黑色板块整体进行择时研究。这一部分对我来说是进度最慢、最没有思路的环节。由于带教倾向于让我自己探索研究，因此没有给我指定很明确的方向。而我彼时对于期货投研毫无概念，故而全无思路，只能就相关性作一些盲目的分析，最后选取几个看似不错的数据进行简单的回测。可以想见，这样做的效果非常差——尽管我的回测净值曲线能够在训练集中高歌猛进，但是一旦进入测试集就一落千丈。毫无疑问，这意味着严重的过拟合。这段时间里我相当郁闷，进展也不足。由于公司开发的回测框架远远不能满足我的需求，我还花了不少时间自己写了一份回测框架（并一直在使用）。这个自研的回测框架相比公司的框架性能提升了百倍不止。</p><p>后来，在一次与带教的深入讨论后，我开始采取更加精细化的数据处理方式：挑选我认为有经济逻辑的数据，分别一个个作滞后、移动平均、时序排序、差分等处理，再对黑色板块价格指数进行回测。一通测试之后，选出几个效果较好的指标进行简单线性合成，最后再针对某些年份的回撤进行具体的处理。处理完效果很不错，无论是本地回测还是用公司的框架回测，都能得到大于 1 的夏普。</p><p>黑色板块的择时因子提交后，我又花了一周时间整理有色板块的下游行业基本面数据，但是最后并没有使用这些数据，而是转而做了仓单因子和期限结构因子的研究。这两个因子的研究相对就简单多了，只需要找到一两篇合适的研报照猫画虎，再按照自己的理解修正一下，基本就能得到不错的结果。这两个因子的研究过程大概持续了两三周。</p><p>回头来看，这三个月来提交的工作成果其实并不很多。想来，大部分时间是消耗在了与研究没有直接关联的环节上，比如开发回测框架、折腾公司的回测框架、找数据等等；而即使是在研究上，似乎也常常在没有头绪的混沌中内耗而毫无进展。因此总体来说，这不是一段高效产出、成果丰硕的实习。</p><h2 id="基本面量化研究的特征"><a href="#基本面量化研究的特征" class="headerlink" title="基本面量化研究的特征"></a>基本面量化研究的特征</h2><p>还记得上一段实习面试的时候，面试官曾问我：基本面量化有什么困难？当时我说不出什么所以然，但是现在有了一些新的想法：</p><ul><li>数据的频率与滞后性。基本面数据往往频率很低。我所用来作基本面分析的数据，几乎都是月频或更低频的数据。这样的发布频率必然导致回测样本较小，比如十年内最多提供 120 个调仓信号，十分容易过拟合。而基本面发生改变往往不会立即对合约价格产生影响，而是需要将影响慢慢传导到价格上。这样的传导过程有快有慢，同样给策略研究带来了难度。</li><li>基本面印象因素的广泛性。从较大的时间尺度来看，商品合约的价格的影响因素非常多。从宏观的经济周期到中观的供需关系、库存、预期、政策等因素，再到短期的情绪、套利行为，一个单一的基本面指标很难对某一商品的价格具有很强的相关性。而又由于上述的样本小的原因，没有办法在足够长期的视角下评判一个指标对于价格是真的会产生影响还是仅仅存在相关性。</li></ul><p>我想，基本面研究对我而言最大的好处在于，不苛求很底层的编程技术，也不需要对机器学习和神经网络这些工具精通，但是需要有比较好的市场逻辑观点，而这恰恰是与我的经历相符合的。</p><h2 id="关于接下来的计划"><a href="#关于接下来的计划" class="headerlink" title="关于接下来的计划"></a>关于接下来的计划</h2><p>当然是继续投递下一份实习了。面对当今的市场行情，实习经历似乎多少都不够。</p><p>对于下一份实习的方向，我其实没有什么具体的想法。做 CTA 很好，但是我也愿意尝试不同的路径：股票、数字货币、固收；高频、中频、低频；因子、规则、技术指标；机器学习、手搓因子、自动挖掘，我目前愿意尝试不同的实习方向。我觉得，不论是什么细分领域的实习，都能够为我整体知识技能体系的构建有所贡献。有时候人容易陷入抉择的内耗中，但与其犹豫不决，不如先动手做做看。我相信，前进总比停滞要好。</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;距离职仅剩最后几日了，三个月的时间过得真快。&lt;/p&gt;
&lt;p&gt;最后的时间里，带教没有再给我安排策略研究的工作，而是让我对数据再作一番筛选，算是用任务填充一下离职前的工作空窗。但我心猿意马，已经在考虑下一段实习的投递，因此大部分时间无心工作，转而刷了十几道 LeetCode</summary>
        
      
    
    
    
    <category term="量化实习日记" scheme="https://ifwhale.top/categories/%E9%87%8F%E5%8C%96%E5%AE%9E%E4%B9%A0%E6%97%A5%E8%AE%B0/"/>
    
    
    <category term="Quant" scheme="https://ifwhale.top/tags/Quant/"/>
    
    <category term="实习" scheme="https://ifwhale.top/tags/%E5%AE%9E%E4%B9%A0/"/>
    
    <category term="日记" scheme="https://ifwhale.top/tags/%E6%97%A5%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>量化实习 v2丨Day 54：就这么着吧</title>
    <link href="https://ifwhale.top/posts/75f46a68/"/>
    <id>https://ifwhale.top/posts/75f46a68/</id>
    <published>2024-07-10T08:58:48.000Z</published>
    <updated>2024-07-10T15:20:08.288Z</updated>
    
    <content type="html"><![CDATA[<p>尝试对策略进行风险管理，但是几无思路。上网找了一些资料，尝试了两种方法，一种是根据策略回撤来决定是否开平仓，一种是根据各品种净值回撤来调整各品种持仓权重。但是无论是哪一种方法，效果都不好，只会导致原本的夏普比率下降。这样做真的有意义吗？</p><p>把当前工作写了文档发给带教，带教让我先把黑色和有色的数据再筛一遍。感觉这段时间确实没学到什么……而且筛数据的事情现在另外两个实习生也在做，感觉实际上就是不知道给我安排什么活了。接下来就慢慢摸鱼？</p><p>过几天就离职了，感觉最后的工作并没有啥产出，稀里糊涂地这三个月就这么结束了。</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;尝试对策略进行风险管理，但是几无思路。上网找了一些资料，尝试了两种方法，一种是根据策略回撤来决定是否开平仓，一种是根据各品种净值回撤来调整各品种持仓权重。但是无论是哪一种方法，效果都不好，只会导致原本的夏普比率下降。这样做真的有意义吗？&lt;/p&gt;
&lt;p&gt;把当前工作写了文档发给带教，带教让我先把黑色和有色的数据再筛一遍。感觉这段时间确实没学到什么……而且筛</summary>
        
      
    
    
    
    <category term="量化实习日记" scheme="https://ifwhale.top/categories/%E9%87%8F%E5%8C%96%E5%AE%9E%E4%B9%A0%E6%97%A5%E8%AE%B0/"/>
    
    
    <category term="Quant" scheme="https://ifwhale.top/tags/Quant/"/>
    
    <category term="实习" scheme="https://ifwhale.top/tags/%E5%AE%9E%E4%B9%A0/"/>
    
    <category term="日记" scheme="https://ifwhale.top/tags/%E6%97%A5%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>量化实习 v2丨Day 51：周五综合征</title>
    <link href="https://ifwhale.top/posts/2746c340/"/>
    <id>https://ifwhale.top/posts/2746c340/</id>
    <published>2024-07-05T08:52:34.000Z</published>
    <updated>2024-07-05T14:01:16.007Z</updated>
    
    <content type="html"><![CDATA[<p>上午提交了一下因子代码，但是下午带教让我再多想想，把夏普进一步提高一下。</p><p>然而今天是又一个周五，慵懒的气息弥漫在办公室里，加之下午又困困的，实在是不想再工作了，于是读了一篇关于高频交易的<a href="https://mp.weixin.qq.com/s/fRhgKDWW3TigoPuLRF8Kjg">科普文章</a>，读到一半真的开始打瞌睡了，于是又刷了刷手机，决定把下午就这么消耗掉算了。</p><p>对着日历算了算，今天结束之后，在这家公司的时间就只剩一周多几天了，时间过得真快。回头想一想，实在不觉得自己做了很多事情，除了做数据确实占用了一些时间以外，自己的摸索和思考也消耗工作时长，而且这样的过程里是没有明确成果产出的。</p><p>大部分研究策略的时间，我在做黑色板块策略的研究。由于几无参考，我完全是凭自己的感觉摸索出来了这个因子，当然中途也有不少带教和领导的点拨。相比之下，复现研报就快得多了，只需要按照研报上的方法一步一步做就可以了，而且这样的正反馈也更加及时，是容易产生成就感的。总得来说，鉴于我目前对于量化策略的研究仍然处于入门的阶段，也许多读一读研报论文，并以复现调优为主的工作能够带来更快的能力提升。</p><p>这段时间以来，我的研究一直缺乏系统性，有些碎片化。有时候找一下数据，偶尔又做一做横向项目，还常常花大量时间自己盯着数据思考构建因子的逻辑，简单的研报也复现了两三篇，无论是哪个工作都不够系统，而这家公司给我提供的工作范式本来就是不太系统的，这促使我在考虑下一份实习时，仍然倾向于先从量化私募开始投起。</p><p>然而量化私募哪有那么好投，何况这几个月来行情不但没有好装，反而依然在变得越来越差。两周？一个月？一切似乎只能慢慢来。</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;上午提交了一下因子代码，但是下午带教让我再多想想，把夏普进一步提高一下。&lt;/p&gt;
&lt;p&gt;然而今天是又一个周五，慵懒的气息弥漫在办公室里，加之下午又困困的，实在是不想再工作了，于是读了一篇关于高频交易的&lt;a</summary>
        
      
    
    
    
    <category term="量化实习日记" scheme="https://ifwhale.top/categories/%E9%87%8F%E5%8C%96%E5%AE%9E%E4%B9%A0%E6%97%A5%E8%AE%B0/"/>
    
    
    <category term="Quant" scheme="https://ifwhale.top/tags/Quant/"/>
    
    <category term="实习" scheme="https://ifwhale.top/tags/%E5%AE%9E%E4%B9%A0/"/>
    
    <category term="日记" scheme="https://ifwhale.top/tags/%E6%97%A5%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>量化实习 v2丨Day 50：不合预期但确实神奇的期限结构因子</title>
    <link href="https://ifwhale.top/posts/d247b77c/"/>
    <id>https://ifwhale.top/posts/d247b77c/</id>
    <published>2024-07-04T08:21:57.000Z</published>
    <updated>2024-07-05T01:28:39.000Z</updated>
    
    <content type="html"><![CDATA[<p>今日花了一天时间，好好检查了一下数据和程序逻辑，重点检查是否使用了未来数据；接着将目前为止所做的工作写了一份报告提交给带教，真够折腾的。</p><p>尽管做策略的时候已经很小心了，但是果然还是在不经意间引入了未来数据。而罪魁祸首就是 <code>pandas.DataFrame.resample()</code> 这一方法。</p><h2 id="pandas-的-resample-之谜"><a href="#pandas-的-resample-之谜" class="headerlink" title="pandas 的 resample() 之谜"></a><code>pandas</code> 的 <code>resample()</code> 之谜</h2><p>使用这一方法的场景是，由于我的回测框架无法设置调仓频率，因此不得不通过将因子值降频来保证非调仓交易日的因子值与上一交易日的因子值相同，以此来达到不调仓的效果。要做到这一点，我的思路是先将因子 <code>resample()</code> 一下，取最后一个值，然后再通过 <code>reindex()</code> 回到之前的因子格式，举例如</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># use resample() to resample</span></span><br><span class="line">index = pd_shift.index</span><br><span class="line"></span><br><span class="line">factor = pd_shift.resample(<span class="string">&quot;20D&quot;</span>).last()</span><br><span class="line">factor = factor.reindex(index)</span><br><span class="line">factor = factor.fillna(method=<span class="string">&#x27;ffill&#x27;</span>)</span><br></pre></td></tr></table></figure><p>然而这一方法的使用却出现了意外：<code>resample()</code> 的重采样是严格的，在它想要采样的时点，如果该时点不在原本的 <code>index</code> 中，就会将上一个找到的值强行作为这一时点的采样值。而因子值的 <code>index</code> 是确实了大量日期的，因为一部分日期不是交易日。这就会导致，有的重采样点会出现在非交易日，造成最后结果不符合预期。</p><p>为了保证按照原数据的 <code>index</code> 来重采样，就需要用到 <code>DataFrame</code> 的 <code>groupby()</code> 方法，如</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># use groupby() to resample</span></span><br><span class="line">index = pd_shift.index</span><br><span class="line"></span><br><span class="line">reindexed_pd_shift = pd_shift.reset_index()</span><br><span class="line">num_index = reindexed_pd_shift.index</span><br><span class="line"></span><br><span class="line">factor = reindexed_pd_shift.groupby(num_index // <span class="number">20</span>).last()</span><br><span class="line">factor = factor.set_index(<span class="string">&#x27;index&#x27;</span>)</span><br><span class="line">factor = factor.reindex(index)</span><br><span class="line">factor = factor.fillna(method=<span class="string">&#x27;ffill&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="期限结构因子"><a href="#期限结构因子" class="headerlink" title="期限结构因子"></a>期限结构因子</h2><p>上一篇日记提到，我主要研究了两个期限结构因子：</p><h3 id="展期收益率因子"><a href="#展期收益率因子" class="headerlink" title="展期收益率因子"></a>展期收益率因子</h3><p>$$<br>R_t &#x3D; \left[\ln{\left(P_{t,n}\right) - \ln{\left(P_{t,d}\right)}} \right] \times {365\over N_{t,d} - N_{t,n}}<br>$$</p><p>其中，$P_{t,n}$ 和 $P_{t,d}$ 分别代表 $t$ 日近月合约与远月合约的价格，而 $N_{t,d}$ 和 $N_{t,n}$ 则分别代表远月合约和近月合约的到期日距离 $t$ 日天数。由于我手头数据并无合约到期日信息，因此我舍弃了因子结构的后半部分，实际上因子结构为<br>$$<br>R_t &#x3D; \ln{\left(P_{t,n}\right) - \ln{\left(P_{t,d}\right)}}<br>$$<br>变得更简单了。</p><p>这里能够调整的参数主要有二：</p><ul><li>持仓周期天数；</li><li>所选近月合约与远月合约组合，包括最近月合约与主力合约、最近月合约与次近月合约和最近月合约与最远月合约等。</li></ul><p>展期收益率可以理解为将近月合约平仓并向后展期到远月合约，这两个期货合约间的价差。若因子值为正说明近月合约价格高于远月合约价格，给出做多信号；反之则给出做空信号。</p><h3 id="基差动量因子"><a href="#基差动量因子" class="headerlink" title="基差动量因子"></a>基差动量因子</h3><p>$$<br>basis\ momentum&#x3D;\prod^t_{i&#x3D;t-R+1}\left(1+R^{T_1}_{fut,i}\right)-\prod^t_{i&#x3D;t-R+1}\left(1+R^{T_2}_{fut,i} \right)<br>$$</p><p>这一因子在一个给定的滚动窗口中反复计算两个合约的累计收益率，并作差来得到基差动量数值。其中，$R^{T_1}_{fut,i}$ 和 $R^{T_2}_{fut,i}$ 分别代表近月合约和远月合约在 $i$ 日的收益率，$R$ 表示计算累计收益率的窗口，得到的是 $t$ 日的因子值。</p><p>这里能调整三类参数：</p><ul><li>持仓周期天数；</li><li>所选近月合约与远月合约组合，包括最近月合约与主力合约、最近月合约与次近月合约和最近月合约与最远月合约等；</li><li>滚动窗口大小 $R$。</li></ul><p>因子值越大，说明近月合约价格的上涨幅度超过远月合约价格越多，则价差越可能回归，因此给出越强的做多信号；相反则给出越强的做空信号。</p><h2 id="回测结果"><a href="#回测结果" class="headerlink" title="回测结果"></a>回测结果</h2><p>以下回测均考虑 0.02% 的交易费率。</p><h3 id="展期收益率因子-1"><a href="#展期收益率因子-1" class="headerlink" title="展期收益率因子"></a>展期收益率因子</h3><p>对最近月合约与主力合约组合、最近月合约与次近月合约组合、最近月合约与最远月合约组合分别测试因子绩效。</p><h4 id="最近月合约与主力合约组合"><a href="#最近月合约与主力合约组合" class="headerlink" title="最近月合约与主力合约组合"></a>最近月合约与主力合约组合</h4><p>因子结构简单，但是有效。这一因子最有效的合约组合是最近月合约与主力合约。在这一组合下，因子收益率<strong>对参数不敏感</strong>，基本都能获得稳定收益，只是收益率有差别，这与因子带来的信息衰减和交易费率都有关。以 10 个交易日的持仓周期为例，本地回测结果：</p><p><img src="/posts/d247b77c/8c12dc51-417c-4e78-bdeb-705cc163fb35.png" alt="最近月合约与主力合约组合回测结果"></p><p>夏普比率能够达到 1.17。</p><h4 id="其他合约组合"><a href="#其他合约组合" class="headerlink" title="其他合约组合"></a>其他合约组合</h4><p>然而若尝试其他合约组合则会出现各种问题。无论是使用近月合约与次近月合约的组合，还是近月合约与最远月合约的组合，用同样的方式计算因子并回测的结果却呈现完全相反的结果。以最近月合约与最远月合约为例：</p><p><img src="/posts/d247b77c/dd5a9f2c-c3fb-4f4c-936e-6d58c3fc86fb.png" alt="最近月合约与最远月合约回测结果"></p><h3 id="基差动量因子-1"><a href="#基差动量因子-1" class="headerlink" title="基差动量因子"></a>基差动量因子</h3><p>由于这一因子存在更多参数，因此可以通过网格寻参来寻找较优参数。接下来，我将持有周期设为左轴，滚动窗口设为上轴来展示寻参结果，并仅展示回测的夏普比率数值。</p><h4 id="最近月合约与主力合约组合-1"><a href="#最近月合约与主力合约组合-1" class="headerlink" title="最近月合约与主力合约组合"></a>最近月合约与主力合约组合</h4><p>使用这一组合时，在本地回测能够得到较好收益曲线。本地参数网格搜索结果如下：</p><p><img src="/posts/d247b77c/tmpAAD.png" alt="最近月合约与主力合约组合网格搜索结果"></p><p>以回测结果较好的参数组合 (20, 210) 为例，回测结果如下图：</p><p><img src="/posts/d247b77c/a16f02bb-3b57-472f-809a-cd88ac0d6936.png" alt="参数组合 (20, 210) 回测结果"></p><h4 id="其他合约组合-1"><a href="#其他合约组合-1" class="headerlink" title="其他合约组合"></a>其他合约组合</h4><p>对于最近月合约与次近月合约和次近月合约的组合，则在本地回测效果欠佳。比如，对于最近月合约与次近月合约组合，其因子效果对于参数更加敏感，且基本都带来负收益：</p><p><img src="/posts/d247b77c/tmp8B03.png" alt="最近月合约与次近月合约组合网格搜索结果"></p><p>尝试 (25, 210) 这一本地回测结果为正的参数组合，本地回测结果如下：</p><p><img src="/posts/d247b77c/62aeba5f-3dbb-4133-aee0-9a3c70636849.png" alt="参数组合 (25, 210) 回测结果"></p><p>绩效尚可。但是由于参数的敏感性，这一收益曲线存在过拟合嫌疑。而尝试其他参数组合时，基本回测结果都很差劲。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>根据以上结果，无论使用展期收益率因子还是基差动量因子，都只有采用<strong>最近月合约与主力合约组合</strong>才能获得最稳健的收益。此外，我还稍微测试了一下因子在不同板块中的表现，似乎黑色板块相对是拖后腿的家伙，去掉这一板块之后，因子绩效倾向于变得更好。</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a class="link-card" target="_blank" href="https://www.htsec.com/jfimg/colimg/upload/20170309/38441489040672863.pdf"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">FICC系列研究之二——基于动量和期限结构的商品期货策略</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://www.htsec.com/jfimg/colimg/upload/20170309/38441489040672863.pdf</span></span></span></a></p><p><a class="link-card" target="_blank" href="https://www.htsec.com/jfimg/colimg/upload/20170821/7561503296377058.pdf"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">FICC系列研究之五——商品期货因子挖掘与组合构建再探究 </span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://www.htsec.com/jfimg/colimg/upload/20170821/7561503296377058.pdf</span></span></span></a></p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;今日花了一天时间，好好检查了一下数据和程序逻辑，重点检查是否使用了未来数据；接着将目前为止所做的工作写了一份报告提交给带教，真够折腾的。&lt;/p&gt;
&lt;p&gt;尽管做策略的时候已经很小心了，但是果然还是在不经意间引入了未来数据。而罪魁祸首就是 &lt;code&gt;pandas.DataFrame.resample()&lt;/code&gt; 这一方法。&lt;/p&gt;
&lt;h2</summary>
        
      
    
    
    
    <category term="量化实习日记" scheme="https://ifwhale.top/categories/%E9%87%8F%E5%8C%96%E5%AE%9E%E4%B9%A0%E6%97%A5%E8%AE%B0/"/>
    
    
    <category term="Quant" scheme="https://ifwhale.top/tags/Quant/"/>
    
    <category term="实习" scheme="https://ifwhale.top/tags/%E5%AE%9E%E4%B9%A0/"/>
    
    <category term="日记" scheme="https://ifwhale.top/tags/%E6%97%A5%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>量化实习 v2丨Day 49：更高、更快、更强</title>
    <link href="https://ifwhale.top/posts/c8d7bab9/"/>
    <id>https://ifwhale.top/posts/c8d7bab9/</id>
    <published>2024-07-03T08:56:57.000Z</published>
    <updated>2024-07-03T13:02:22.061Z</updated>
    
    <content type="html"><![CDATA[<p>今天仍旧在处理期限结构因子，但是大部分时间在做另一件事儿：优化回测框架的 <code>Position</code> 类的性能。</p><p>起因是在研究策略的时候，发现用自己开发的回测框架运行常常耗费大量时间，一次回测甚至要 3 秒。究其原因，发现性能瓶颈主要出现在 <code>Position</code> 类生成持仓数据的过程。这个过程会在一个 <code>for</code> 循环中处理每一日的持仓，而且仅使用 <code>pandas</code> 的方法来处理数据，效率极低。</p><p>于是我决定将这一过程也向量化。首先，需要每日将因子值正反排序，并取其 rank。由于 <code>numpy</code> 中没有类似的方法，于是我刚开始的想法是诉诸于 <code>scipy</code>。但是测试之后发现，<code>scipy</code> 并没有为 rank 的计算带来很高的效率提升。对源代码层层拨茧抽丝，发现 <code>scipy</code> 实现时完全使用 <code>numpy</code> 进行计算，而 <code>pandas.DataFrame</code> 的 <code>rank()</code> 方法本来就是用 Cython 实现的，自然不会有很大的性能差异。因此，rank 的计算就交给 <code>pandas</code> 本身了。后续，我将数据由 <code>DataFrame</code> 转换成 <code>NDArray</code>，一通操作，又处理了一大堆 bug、warning 和计算结果不一致的问题，最后终于将函数改写成效果一样，但性能差异巨大的另一个函数。经过测试，新的函数计算效率能够达到原函数的几十上百倍。</p><p>有了快速回测的函数，终于可以愉快地对策略调参了。这个期限结构的策略真的很有意思，它带来的信息不会迅速衰减，因此即使按照 20 日的频率调仓都能够带来很好的正收益，而且曲线相当稳定，即使考虑了一定的交易费率。我仔细检查了因子逻辑，应当是没有使用到未来数据。而再用公司的回测框架测试，效果也十分可观。</p><p><img src="/posts/c8d7bab9/84ec4dd7-17af-4b1e-97a4-284cecfcca0b.png" alt="策略回测结果"></p><p>这件事相当神奇，因为一个这么简单的因子按道理不会有这么漂亮的收益。而这不是最令我费解的部分。诡异的事情在于，如果要得到这样好的收益，我必须要将因子值做成研报所展示的因子的相反数。也就是说，研报上的逻辑要做多时我应该做空，研报上的逻辑要做空时我则应该做多。这不太正常，尽管我对于这一因子的经济逻辑仍然理解得不是很清楚。但是应该不是我的回测框架的问题，因为我的因子值即使在公司的回测框架上也能得到很好的收益，乃至 2 以上的夏普比率。</p><p>明天要再好好检查一下因子逻辑是否有问题，不行就跟带教讨论一下好了。</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;今天仍旧在处理期限结构因子，但是大部分时间在做另一件事儿：优化回测框架的 &lt;code&gt;Position&lt;/code&gt; 类的性能。&lt;/p&gt;
&lt;p&gt;起因是在研究策略的时候，发现用自己开发的回测框架运行常常耗费大量时间，一次回测甚至要 3 秒。究其原因，发现性能瓶颈主要出现在 &lt;code&gt;Position&lt;/code&gt;</summary>
        
      
    
    
    
    <category term="量化实习日记" scheme="https://ifwhale.top/categories/%E9%87%8F%E5%8C%96%E5%AE%9E%E4%B9%A0%E6%97%A5%E8%AE%B0/"/>
    
    
    <category term="Quant" scheme="https://ifwhale.top/tags/Quant/"/>
    
    <category term="实习" scheme="https://ifwhale.top/tags/%E5%AE%9E%E4%B9%A0/"/>
    
    <category term="日记" scheme="https://ifwhale.top/tags/%E6%97%A5%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>量化实习 v2丨Day 48：更神奇的期限结构因子</title>
    <link href="https://ifwhale.top/posts/6a2aaf19/"/>
    <id>https://ifwhale.top/posts/6a2aaf19/</id>
    <published>2024-07-02T09:01:34.000Z</published>
    <updated>2024-07-04T08:44:22.000Z</updated>
    
    <content type="html"><![CDATA[<p>上午向带教确认了一下，才搞明白我需要做的不是买近卖远或者卖近买远，而是根据远近合约的价差来交易主力合约。因此尽管因子的构造方式可能与近远月合约有关，但是交易和它们没有关系。</p><p>盯了半天数据，实在没有什么思路。于是决定上网找找研报，发挥一下我查找资料能力的比较优势。好不容易寻得海通证券的两篇量化研报，一篇来自 2014 年，一篇来自 2015 年，都相当古老了。</p><p>第一篇研报给出的相关因子很简单，就是给出一个展期收益率因子：</p><p>$$<br>R_t &#x3D; \left[\ln{P_{t,n} - \ln{P_{t,d}}} \right] \times {365\over N_{t,d} - N_{t,n}}<br>$$</p><p>其中 $P_{t,n}$ 和 $P_{t,d}$ 可以代表近月远月合约，也可以代表近月和次近月合约、近月和主力合约、甚至主力和次主力合约。</p><p>文章用 5 日、10 日等周期来截面交易，但是我编写的功能贫瘠的回测框架暂时只支持每日交易，因此我也就没管那么多，先拿来试一试。结果很神奇，上述不同的合约组合有的能赚钱，有的不赚钱，有的甚至要将因子值取相反数才赚钱。</p><p>下班前又试了试第二篇研报，这篇研报稍微认真了点儿，参考了一篇国外的论文，整了一个更复杂的因子：<br>$$<br>basis\ momentum&#x3D;\prod^t_{i&#x3D;t-R+1}\left(1+R^{T_1}_{fut,i}\right)-\prod^t_{i&#x3D;t-R+1}\left(1+R^{T_2}_{fut,i} \right)<br>$$<br>这里的 $R^{T_1}_{fut,i}$ 和 $R^{T_2}_{fut,i}$ 同样指的是不同期限的合约。这个因子多了一个参数，也就是用来滚动计算的窗口 $R$。为了寻参方便，我不得不将耗时过长的 <code>pandas.DataFrame.rolling()</code> 用向量化的方法重新实现，果然效率提高了几十倍。Pandas 原来这么垃圾。</p><p>研究尚未进行完全，等结论比较清晰了再详细写一下这类因子好了。</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;上午向带教确认了一下，才搞明白我需要做的不是买近卖远或者卖近买远，而是根据远近合约的价差来交易主力合约。因此尽管因子的构造方式可能与近远月合约有关，但是交易和它们没有关系。&lt;/p&gt;
&lt;p&gt;盯了半天数据，实在没有什么思路。于是决定上网找找研报，发挥一下我查找资料能力的比较优势。好不容易寻得海通证券的两篇量化研报，一篇来自 2014 年，一篇来自</summary>
        
      
    
    
    
    <category term="量化实习日记" scheme="https://ifwhale.top/categories/%E9%87%8F%E5%8C%96%E5%AE%9E%E4%B9%A0%E6%97%A5%E8%AE%B0/"/>
    
    
    <category term="Quant" scheme="https://ifwhale.top/tags/Quant/"/>
    
    <category term="实习" scheme="https://ifwhale.top/tags/%E5%AE%9E%E4%B9%A0/"/>
    
    <category term="日记" scheme="https://ifwhale.top/tags/%E6%97%A5%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>量化实习 v2丨Day 47：月差？</title>
    <link href="https://ifwhale.top/posts/41231dca/"/>
    <id>https://ifwhale.top/posts/41231dca/</id>
    <published>2024-07-01T15:52:48.000Z</published>
    <updated>2024-07-01T15:57:16.509Z</updated>
    
    <content type="html"><![CDATA[<p>今日本想在有色金属的基本面研究上大展宏图，结果带教又甩出一份数据，是另一个实习生做的月差数据，用来做跨期套利策略。看了半天，感觉数据有点问题，而且网上也没有很多有用的资料，挠头。</p><p>至于有色金属的基本面，神奇的是，之前黑色板块的众多因子似乎大部分也还能一用，虽然效果好像也不是特别好。也许有色金属最终的策略可以多用一些指标，这样的结果可能会更加稳健。</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;今日本想在有色金属的基本面研究上大展宏图，结果带教又甩出一份数据，是另一个实习生做的月差数据，用来做跨期套利策略。看了半天，感觉数据有点问题，而且网上也没有很多有用的资料，挠头。&lt;/p&gt;
&lt;p&gt;至于有色金属的基本面，神奇的是，之前黑色板块的众多因子似乎大部分也还能一用，虽然效果好像也不是特别好。也许有色金属最终的策略可以多用一些指标，这样的结果可能会更</summary>
        
      
    
    
    
    <category term="量化实习日记" scheme="https://ifwhale.top/categories/%E9%87%8F%E5%8C%96%E5%AE%9E%E4%B9%A0%E6%97%A5%E8%AE%B0/"/>
    
    
    <category term="Quant" scheme="https://ifwhale.top/tags/Quant/"/>
    
    <category term="实习" scheme="https://ifwhale.top/tags/%E5%AE%9E%E4%B9%A0/"/>
    
    <category term="日记" scheme="https://ifwhale.top/tags/%E6%97%A5%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>量化实习 v2丨Day 46：无所事事</title>
    <link href="https://ifwhale.top/posts/29ae1c5c/"/>
    <id>https://ifwhale.top/posts/29ae1c5c/</id>
    <published>2024-06-28T08:48:17.000Z</published>
    <updated>2024-06-28T13:47:27.560Z</updated>
    
    <content type="html"><![CDATA[<p>上午花时间补上了昨天的日记，结果今天就啥也不想干了，陷入一种奇怪的懒得工作的虚无中。</p><p>仓单因子做到这里，我感觉也没有啥非得做下去的内容了。尝试了一些不同的数据，发现能赚钱的只有有色金属和白银；探索一下其他的因子表达式，基本还是研报给的最有用；寻找一下最优参数，大概是 10，很快就找到了。</p><p>下周的任务应该围绕有色金属的基本面分析展开，这部分工作大概就跟黑色金属差不多了，希望顺利</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;上午花时间补上了昨天的日记，结果今天就啥也不想干了，陷入一种奇怪的懒得工作的虚无中。&lt;/p&gt;
&lt;p&gt;仓单因子做到这里，我感觉也没有啥非得做下去的内容了。尝试了一些不同的数据，发现能赚钱的只有有色金属和白银；探索一下其他的因子表达式，基本还是研报给的最有用；寻找一下最优参数，大概是</summary>
        
      
    
    
    
    <category term="量化实习日记" scheme="https://ifwhale.top/categories/%E9%87%8F%E5%8C%96%E5%AE%9E%E4%B9%A0%E6%97%A5%E8%AE%B0/"/>
    
    
    <category term="Quant" scheme="https://ifwhale.top/tags/Quant/"/>
    
    <category term="实习" scheme="https://ifwhale.top/tags/%E5%AE%9E%E4%B9%A0/"/>
    
    <category term="日记" scheme="https://ifwhale.top/tags/%E6%97%A5%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>量化实习 v2丨Day 45：神奇的仓单因子</title>
    <link href="https://ifwhale.top/posts/1bbaf0dc/"/>
    <id>https://ifwhale.top/posts/1bbaf0dc/</id>
    <published>2024-06-28T01:52:27.000Z</published>
    <updated>2024-06-28T16:20:29.483Z</updated>
    
    <content type="html"><![CDATA[<p>居然连续两天没有写日记了，至少补上昨天的吧。</p><p>这两天实际上在折腾一个新的小玩意，叫仓单因子。</p><h2 id="什么是仓单"><a href="#什么是仓单" class="headerlink" title="什么是仓单"></a>什么是仓单</h2><blockquote><p>  期货标准仓单是指现货商将手头上符合交易所交割标准的现货存放在交易所指定的交割仓库，并经检验合格后由交易所给现货商签发的一种实物提货凭证。</p><p>  当市场供给过剩，现货商认为期货价格比现货更有利时，会倾向于把现货注册成仓单，用于在期货市场中交割。反之当市场供不应求，现货价格更为有利时，现货商则会倾向于直接在现货市场中交易，从而减少仓单的注册，甚至注销已有仓单。</p></blockquote><p>因此，仓单因子实际上交易的是反转逻辑，反映的是市场供给的过剩或者不足。要应用仓单因子，就需要在仓单增加时做空，仓单减少时做多。</p><h2 id="仓单的适用性条件"><a href="#仓单的适用性条件" class="headerlink" title="仓单的适用性条件"></a>仓单的适用性条件</h2><p>仓单的增减若能反映市场供求关系，其首要条件是，仓单的注册或者注销必须完全是市场行为。但是这一条件并不能普遍被满足。根据<a href="https://www.founderfu.com/jiaogejicangdanguizejianbiao/426.html">交割及仓单规则简表 </a>，在所有商品期货中，除了 10 种期货以外，其他期货均设有有效期，这意味着仓单注册者必须在仓单到期前注销仓单，这是非市场行为，与产业方对商品供求的判断无关，因此无法反映市场状态。</p><p>上述的 10 种期货为：铜（cu）、铝（al）、锌（zn）、铅（pb）、镍（ni）、锡（sn）、白银（ag）、黄金（au）、原油（sc）和国际铜（bc）。而在其中，国际铜（bc）上市时间较短，以下不讨论。</p><p><img src="/posts/1bbaf0dc/image-20240628101305980.png" alt="不设有效期的仓单数据：以有色板块为例"></p><p>因此，从逻辑上，仅有这几种期货品种有可能适用于仓单因子交易。而从实践上看，以黑色板块品种为例，热轧板卷（hc）、螺纹钢（rb）、铁矿（i）等品种的仓单数据都会周期性地清零。</p><p><img src="/posts/1bbaf0dc/85d12307-bdc7-481d-821d-fae286c7ab5d.png" alt="周期性清零的仓单数据：以黑色板块为例"></p><h2 id="策略构造"><a href="#策略构造" class="headerlink" title="策略构造"></a>策略构造</h2><p>以下以这个简单的因子结构来对仓单因子进行讨论：<br>$$<br>factor_t &#x3D; -\left({warrant_t\over {1\over5}\sum^4_{i&#x3D;0}warrant_{t-i}}-1\right)<br>$$<br>其中 $warrant$ 表示各商品的仓单数量。这一因子的含义即仓单数量相对最近 5 日均值变化的相反数。因子值更大意味着更强的做多信号，相反则意味着更强的做空信号。</p><p>策略及回测分为两步进行：</p><ol><li>讨论仓单因子的择时能力。对于每个仓单因子可能适用的品种，当仓单因子数值为正时做多，数值为负时做空。</li><li>讨论仓单因子的截面择品种能力。对于每个交易日，选择仓单因子数值排名前 2 的品种做多，排名后 2 的品种做空。</li></ol><p>所有交易考虑 0.02% 的交易费用。</p><h2 id="回测结果"><a href="#回测结果" class="headerlink" title="回测结果"></a>回测结果</h2><p>以下若无特殊说明，均使用开盘价进行交易。</p><h3 id="单因子回测"><a href="#单因子回测" class="headerlink" title="单因子回测"></a>单因子回测</h3><p>对于单因子回测，其效果参差不齐，但是基本都能够得到正收益。</p><p><img src="/posts/1bbaf0dc/9e89c4f5-546e-473c-a83f-d21214324101.png" alt="较好的单品种回测结果：以铅（pb）为例"></p><p><img src="/posts/1bbaf0dc/c365ebe2-4954-4754-a453-05ae67986621.png" alt="较差的单品种回测结果：以铜（cu）为例"></p><h3 id="截面回测"><a href="#截面回测" class="headerlink" title="截面回测"></a>截面回测</h3><p>而截面回测的结果更加可观。为保证品种的可比性，以下截面回测在 6 种有色品种之间进行，即铜（cu）、铝（al）、锌（zn）、铅（pb）、镍（ni）、锡（sn）。</p><p><img src="/posts/1bbaf0dc/ceba5dd8-7f40-4e86-8419-821ae4b3f9e2.png" alt="有色品种截面回测结果"></p><h3 id="关于黄金（au）与原油（sc）的讨论"><a href="#关于黄金（au）与原油（sc）的讨论" class="headerlink" title="关于黄金（au）与原油（sc）的讨论"></a>关于黄金（au）与原油（sc）的讨论</h3><p>值得注意的是黄金（au）和原油（sc）仓单数据的特别性。这两个品种的仓单尽管不设期限，但是其仓单数据却常常连续几个月不发生任何变化，目前原因未知。</p><p><img src="/posts/1bbaf0dc/e2922a1c-d9eb-4853-b883-46e4a05779ca.png" alt="与白银（ag）不同，黄金（au）和原油（sc）仓单常常几个月保持不变"></p><p>而从回测结果来看，这两个品种基本不能应用仓单因子，而白银（ag）却能获得相当稳定的收益。</p><p><img src="/posts/1bbaf0dc/7131ddb2-6dfd-44ec-aed1-6da790b39025.png" alt="黄金（au）和原油（sc）基本不能通过仓单因子获得收益"></p><p><img src="/posts/1bbaf0dc/25488cc0-4491-4796-abca-b8d1a73c498d.png" alt="但是白银（ag）可以"></p><h3 id="关于价格数据的讨论"><a href="#关于价格数据的讨论" class="headerlink" title="关于价格数据的讨论"></a>关于价格数据的讨论</h3><p>仓单因子交易的是短期逻辑，其对交易时间十分敏感。同样是对有色板块的 6 个品种进行择品种交易，仅仅是将开盘价替换为收盘价，就会导致结果发生巨大差异。</p><p><img src="/posts/1bbaf0dc/cfe8068b-3343-4eb2-a0c4-bb64776ec869.png" alt="使用收盘价交易的绩效显著降低"></p><p>因此，仓单因子的交易要点是<strong>交易得越快越好</strong>。</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a class="link-card" target="_blank" href="https://mp.weixin.qq.com/s/ns7TM4hWF3KAUDFfH9TiTw"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">再议仓单因子——测测截面策略的效果</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://mp.weixin.qq.com/s/ns7TM4hWF3KAUDFfH9TiTw</span></span></span></a></p><p><a class="link-card" target="_blank" href="https://mp.weixin.qq.com/s/EQcRkk6BPG3t28cHK78moQ"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">仓单因子的正确打开方式</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://mp.weixin.qq.com/s/EQcRkk6BPG3t28cHK78moQ</span></span></span></a></p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;居然连续两天没有写日记了，至少补上昨天的吧。&lt;/p&gt;
&lt;p&gt;这两天实际上在折腾一个新的小玩意，叫仓单因子。&lt;/p&gt;
&lt;h2 id=&quot;什么是仓单&quot;&gt;&lt;a href=&quot;#什么是仓单&quot; class=&quot;headerlink&quot; title=&quot;什么是仓单&quot;&gt;&lt;/a&gt;什么是仓单&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt; </summary>
        
      
    
    
    
    <category term="量化实习日记" scheme="https://ifwhale.top/categories/%E9%87%8F%E5%8C%96%E5%AE%9E%E4%B9%A0%E6%97%A5%E8%AE%B0/"/>
    
    
    <category term="Quant" scheme="https://ifwhale.top/tags/Quant/"/>
    
    <category term="实习" scheme="https://ifwhale.top/tags/%E5%AE%9E%E4%B9%A0/"/>
    
    <category term="日记" scheme="https://ifwhale.top/tags/%E6%97%A5%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>量化实习 v2丨Day 43：错漏百出的代码</title>
    <link href="https://ifwhale.top/posts/8ff6c948/"/>
    <id>https://ifwhale.top/posts/8ff6c948/</id>
    <published>2024-06-25T08:38:42.000Z</published>
    <updated>2024-06-26T14:51:31.320Z</updated>
    
    <content type="html"><![CDATA[<p>今天读了一下带教给的处理期货数据的代码，完全被雷到了。</p><p>先说代码风格，其中一个文件 <code>TradeDay.py</code> 还是不错的，像模像样，但是另一个文件 <code>data_update_handler2.py</code> 就堪称乱七八糟，和前者肯定不是一个人写的。长得快要溢出 24 寸屏幕的语句、几十上百行的函数、30 个字符以上的变量名、冗余没啥用的逻辑充斥着整个文件，令人不忍直视。</p><p>利用一步一步 debug 的方式，总算是读完了所有代码。其实核心逻辑相当直白，就是把当前持仓量最大的合约当作主力合约。而在主力切换的时点，用新旧合约的 close 或者 vwap 价格来复权价格数据。但是其中的细节有两个重要的错误：</p><ol><li><p>一般而言，主力合约切换的原则是将连续几日持仓量都最大的合约作为新的主力合约，且主力合约切换都是向前切换，不可能再回退。而这段代码却简单将每日持仓量最大的合约作为主力合约，这不但可能导致主力合约提前切换，还可能导致主力合约发生回退（从实践上来看，确实会发生回退）。</p></li><li><p>这段代码会计算换月时产生的价差，并且将价格直接加上价差来成为复权后的价格。但是这样可能会导致收益计算不准确，比如，假设存在两个合约的价格序列：</p></li></ol>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">旧主力合约 A：[4, 6, 8, 10]</span><br><span class="line">新主力合约 B：[1, 2, 3, 4]</span><br></pre></td></tr></table></figure><p>  假设在第二日结束后换月，按照代码逻辑，直接将新合约价格加上价差，复权后价格序列应当是：</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">复权后价格 C：[4, 6, 7, 8]</span><br></pre></td></tr></table></figure><p>  但实际上，如果我在换月前持有 1 手合约 A，那么换月后我就持有 3 手合约 B，那么我的净值实际上应该是：</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">实际净值 D：[4, 6, 9, 12]</span><br></pre></td></tr></table></figure><p>  这会导致复权后的价格完全错误！</p><p>于是带教让我别看这份代码了，之前做啥继续做啥。也挺好的，阅读这样的代码确实是一种折磨。</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;今天读了一下带教给的处理期货数据的代码，完全被雷到了。&lt;/p&gt;
&lt;p&gt;先说代码风格，其中一个文件 &lt;code&gt;TradeDay.py&lt;/code&gt; 还是不错的，像模像样，但是另一个文件 &lt;code&gt;data_update_handler2.py&lt;/code&gt; 就堪称乱七八糟，和前者肯定不是一个人写的。长得快要溢出 24</summary>
        
      
    
    
    
    <category term="量化实习日记" scheme="https://ifwhale.top/categories/%E9%87%8F%E5%8C%96%E5%AE%9E%E4%B9%A0%E6%97%A5%E8%AE%B0/"/>
    
    
    <category term="Quant" scheme="https://ifwhale.top/tags/Quant/"/>
    
    <category term="实习" scheme="https://ifwhale.top/tags/%E5%AE%9E%E4%B9%A0/"/>
    
    <category term="日记" scheme="https://ifwhale.top/tags/%E6%97%A5%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>量化实习 v2丨Day 42：稍显混乱的工作进展</title>
    <link href="https://ifwhale.top/posts/59f7f36f/"/>
    <id>https://ifwhale.top/posts/59f7f36f/</id>
    <published>2024-06-24T09:10:16.000Z</published>
    <updated>2024-06-24T12:53:15.618Z</updated>
    
    <content type="html"><![CDATA[<p>上午又来了两位实习生，终于可以凑一桌麻将了。</p><p>一问带教才知道，原来有色数据还没开始弄😓，白等了两三天。不过既然没数据用不如自己捣鼓一下，复现了一下领导之前发在群里的<a href="https://mp.weixin.qq.com/s/EQcRkk6BPG3t28cHK78moQ">仓单因子研报</a>。</p><p>这篇研报非常神奇，它用的仓单数据是交易所每日公开发布的，用 WIND 或者 iFind 都很容易获取。而交易逻辑非常直白，仓单增加就做空，仓单减少就做多。实际测试一下，效果惊人。在没有引入未来数据的情况下，每个品种的收益基本都丝滑稳增，个别品种日频曲线收益竟然直逼 2000%，非常吓人。</p><p>趁兴用公司框架回测一下，立马被浇了一盆冷水。除了部分品种仍然能够保持不错的收益以外，另一部分品种的净值开始剧烈波动，甚至基本不能获得收益。更搞笑的是，为了达到和本地回测相似的效果，需要将因子值取相反数！</p><p>这一结果相当神秘，讲不清楚是公司回测框架的原因还是我自己的原因，恐怕还需要进一步研究。</p><p>这时带教又丢了个活，要我研究一下期货品种数据的处理。简单来说就是对主力品种换月这一情况作复权处理。近来工作进度有些混乱，有色弄到一半进度受阻，仓单因子研究了一个下午又没有后文（兴许也可以自己找时间做一做），现在又开始研究期货数据处理，好吧。离实习结束还有不到一个月，还会有什么成果产出吗？</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;上午又来了两位实习生，终于可以凑一桌麻将了。&lt;/p&gt;
&lt;p&gt;一问带教才知道，原来有色数据还没开始弄😓，白等了两三天。不过既然没数据用不如自己捣鼓一下，复现了一下领导之前发在群里的&lt;a</summary>
        
      
    
    
    
    <category term="量化实习日记" scheme="https://ifwhale.top/categories/%E9%87%8F%E5%8C%96%E5%AE%9E%E4%B9%A0%E6%97%A5%E8%AE%B0/"/>
    
    
    <category term="Quant" scheme="https://ifwhale.top/tags/Quant/"/>
    
    <category term="实习" scheme="https://ifwhale.top/tags/%E5%AE%9E%E4%B9%A0/"/>
    
    <category term="日记" scheme="https://ifwhale.top/tags/%E6%97%A5%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>量化实习 v2丨Day 41：回测框架逐步成型</title>
    <link href="https://ifwhale.top/posts/10cdd80a/"/>
    <id>https://ifwhale.top/posts/10cdd80a/</id>
    <published>2024-06-20T08:59:56.000Z</published>
    <updated>2024-06-23T16:25:12.944Z</updated>
    
    <content type="html"><![CDATA[<p>今天带教好像有点忙，似乎还没有处理完我的数据，而明天我又请了个假，也就是说我这周的工作就差不多是这样了。</p><p>在摸鱼的间隙还是决定继续构建一下回测框架。<code>Position</code> 这个类其实写起来挺麻烦的，我上次遗留的进度是将未赋权的持仓数据转换成赋权后的持仓数据。我预想了好几种权重计算方法，但是由于懒惰，仅实现了等权的计算函数，之后如果有其他需求再说。</p><p>接着，我又稍微写了一下因子基类 <code>FacBasic</code> 用来被将来可能编写的各个因子继承；一个 <code>FacData</code> 类，用于利用因子类来生成因子数据。这一部分我目前想法不多，因此仅实现了基本框架，之后有需要再细想好了。</p><p>放假！</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;今天带教好像有点忙，似乎还没有处理完我的数据，而明天我又请了个假，也就是说我这周的工作就差不多是这样了。&lt;/p&gt;
&lt;p&gt;在摸鱼的间隙还是决定继续构建一下回测框架。&lt;code&gt;Position&lt;/code&gt;</summary>
        
      
    
    
    
    <category term="量化实习日记" scheme="https://ifwhale.top/categories/%E9%87%8F%E5%8C%96%E5%AE%9E%E4%B9%A0%E6%97%A5%E8%AE%B0/"/>
    
    
    <category term="Quant" scheme="https://ifwhale.top/tags/Quant/"/>
    
    <category term="实习" scheme="https://ifwhale.top/tags/%E5%AE%9E%E4%B9%A0/"/>
    
    <category term="日记" scheme="https://ifwhale.top/tags/%E6%97%A5%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>量化实习 v2丨Day 40：间歇性摆烂</title>
    <link href="https://ifwhale.top/posts/a06d820a/"/>
    <id>https://ifwhale.top/posts/a06d820a/</id>
    <published>2024-06-19T08:52:30.000Z</published>
    <updated>2024-06-19T14:02:55.055Z</updated>
    
    <content type="html"><![CDATA[<p>上午提交了下载的数据，接下来就等待带教处理数据没啥事可干了。</p><p>下午打算继续开干回测框架，但是不知道为何动力熄火，看见代码就烦，写了二三十行就动不下去了，昏昏沉沉的，摸一会儿键盘就想看手机，真没意思。</p><p>有时候也挺怀疑自己对于这一行的热情是否足够支撑将来的事业，也许有一天会厌烦也说不定。下午想了想，自己天天做基本面数据的处理、按照自己的想法做策略，但是这样的工作方式也许并不具有普适性，如果未来去了别的公司或许也需要重新适应。而从面试的角度来看，数学、机器学习、算法、绿皮书等等方面其实都还挺欠缺的，但是又没有足够的动机去弥补。不知道下一次找实习的时候是否又会四处碰壁。</p><p>明天要好好恢复一下状态，记得周五要请假别忘了。</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;上午提交了下载的数据，接下来就等待带教处理数据没啥事可干了。&lt;/p&gt;
&lt;p&gt;下午打算继续开干回测框架，但是不知道为何动力熄火，看见代码就烦，写了二三十行就动不下去了，昏昏沉沉的，摸一会儿键盘就想看手机，真没意思。&lt;/p&gt;
&lt;p&gt;有时候也挺怀疑自己对于这一行的热情是否足够支撑将来的事业，也许有一天会厌烦也说不定。下午想了想，自己天天做基本面数据的处理、按</summary>
        
      
    
    
    
    <category term="量化实习日记" scheme="https://ifwhale.top/categories/%E9%87%8F%E5%8C%96%E5%AE%9E%E4%B9%A0%E6%97%A5%E8%AE%B0/"/>
    
    
    <category term="Quant" scheme="https://ifwhale.top/tags/Quant/"/>
    
    <category term="实习" scheme="https://ifwhale.top/tags/%E5%AE%9E%E4%B9%A0/"/>
    
    <category term="日记" scheme="https://ifwhale.top/tags/%E6%97%A5%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>量化实习 v2丨Day 39：数据矿工回归</title>
    <link href="https://ifwhale.top/posts/92884c19/"/>
    <id>https://ifwhale.top/posts/92884c19/</id>
    <published>2024-06-17T09:18:22.000Z</published>
    <updated>2024-06-17T11:15:08.062Z</updated>
    
    <content type="html"><![CDATA[<p>这周打算效率高一点，赶一赶进度，于是今天一直在整理数据，之前大概一周才完成的任务，今天一天就做得七七八八了。下班前，我下载好家用电器、电子、电力设备和交通运输四个行业的基本面数据，明天再整理成标准格式应该就可以提交了。</p><p>由于绝大部分指标都是在一个 PPT 里面找的，为了在下载数百条数据的过程中加快效率，我又写了一个 <a href="https://getquicker.net/">Quicker</a> 动作，将一列指标名称全部复制下来，并且利用用户选择窗口来简化指标名称选择过程，还是挺有意思的。</p><p>除此以外今天就没什么值得写的了，因为基本上都在重复“选择指标 → 搜索指标 → 添加指标 → 下载指标”这一过程，做得头昏脑胀。</p><p>感觉今天都不想健身了，回去骑骑车好了。</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;这周打算效率高一点，赶一赶进度，于是今天一直在整理数据，之前大概一周才完成的任务，今天一天就做得七七八八了。下班前，我下载好家用电器、电子、电力设备和交通运输四个行业的基本面数据，明天再整理成标准格式应该就可以提交了。&lt;/p&gt;
&lt;p&gt;由于绝大部分指标都是在一个 PPT 里面找的，为了在下载数百条数据的过程中加快效率，我又写了一个 &lt;a</summary>
        
      
    
    
    
    <category term="量化实习日记" scheme="https://ifwhale.top/categories/%E9%87%8F%E5%8C%96%E5%AE%9E%E4%B9%A0%E6%97%A5%E8%AE%B0/"/>
    
    
    <category term="Quant" scheme="https://ifwhale.top/tags/Quant/"/>
    
    <category term="实习" scheme="https://ifwhale.top/tags/%E5%AE%9E%E4%B9%A0/"/>
    
    <category term="日记" scheme="https://ifwhale.top/tags/%E6%97%A5%E8%AE%B0/"/>
    
  </entry>
  
</feed>
