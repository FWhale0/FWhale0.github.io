<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>代码随笔丨Soft Rank：排序微分的解决之道</title>
      <link href="/posts/af905acf/"/>
      <url>/posts/af905acf/</url>
      
        <content type="html"><![CDATA[<h2 id="前情提要"><a href="#前情提要" class="headerlink" title="前情提要"></a>前情提要</h2><p>在做金融时序收益率预测时，尤其在需要按照分位数来选择标的回测的情况下，我们可能会希望使用 <a href="https://bbs.quantclass.cn/thread/23991">Rank IC</a>（可理解为秩相关性）作为评价收益率预测能力的标准。然而在深度学习中，这一指标却无法直接作为损失函数使用，因为反向传播要求损失函数的计算是可微的，而 rank 计算却是不可微分的。</p><p>为了解决这一问题，Soft Rank 算法应运而生。</p><h2 id="Soft-Rank-简介"><a href="#Soft-Rank-简介" class="headerlink" title="Soft Rank 简介"></a>Soft Rank 简介</h2><p>以我的理解，Soft Rank 算法是一种近似算法， 能够在允许一定误差的情况下给出一个数列的 rank 值。比如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line">ts = torch.randn(<span class="number">1</span>, <span class="number">10</span>, requires_grad=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Original data:\n&quot;</span>, ts)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Rank of data:\n&quot;</span>, torch.tensor(rankdata(ts.detach().numpy()), dtype=torch.float32))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Soft ranked data:\n&quot;</span>, soft_rank(ts, regularization_strength=<span class="number">0.1</span>))</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Original data:</span></span><br><span class="line"><span class="string"> tensor([[-0.2936,  1.3017, -0.7662,  1.9435, -1.1154, -0.4187,  1.0562,  0.8975,</span></span><br><span class="line"><span class="string">         -1.7620,  1.5031]], requires_grad=True)</span></span><br><span class="line"><span class="string">Rank of data:</span></span><br><span class="line"><span class="string"> tensor([ 5.,  8.,  3., 10.,  2.,  4.,  7.,  6.,  1.,  9.])</span></span><br><span class="line"><span class="string">Soft ranked data:</span></span><br><span class="line"><span class="string"> tensor([[ 5.,  8.,  3., 10.,  2.,  4.,  7.,  6.,  1.,  9.]],</span></span><br><span class="line"><span class="string">       grad_fn=&lt;StackBackward0&gt;)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>可以看到，<code>soft_rank</code> 函数输出的值是近似于真实 rank 的，同时它还保留了 <code>Tensor</code> 的梯度信息，便于进行反向传播运算。</p><h2 id="Soft-Rank-应用"><a href="#Soft-Rank-应用" class="headerlink" title="Soft Rank 应用"></a>Soft Rank 应用</h2><p>接下来介绍两种我接触过的 Soft Rank 算法实践。</p><h3 id="方法-1：Soft-Rank-直接实现"><a href="#方法-1：Soft-Rank-直接实现" class="headerlink" title="方法 1：Soft Rank 直接实现"></a>方法 1：Soft Rank 直接实现</h3><p>以下给出直接用 <code>PtTorch</code> 原生方法实现 Soft Rank 的算法：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">soft_rank</span>(<span class="params">y, regularization_strength=<span class="number">1.0</span></span>):</span><br><span class="line">    <span class="comment"># 计算所有 pairwise 差异，形状为 (n, n)</span></span><br><span class="line">    pairwise_diff = y.t() - y</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 应用 sigmoid 函数</span></span><br><span class="line">    sigmoid_vals = torch.sigmoid(pairwise_diff / regularization_strength)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 计算每个元素的 soft rank</span></span><br><span class="line">    ranks = sigmoid_vals.<span class="built_in">sum</span>(dim=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 标准化</span></span><br><span class="line">    <span class="keyword">return</span> ranks / y.shape[<span class="number">0</span>]</span><br></pre></td></tr></table></figure><p>注意这一函数最终输出的结果与真正的 Rank 分布可能有很大差异，比如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line">ts = torch.randn(<span class="number">1</span>, <span class="number">10</span>, requires_grad=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Original data:\n&quot;</span>, ts)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Rank of data:\n&quot;</span>, torch.tensor(rankdata(ts.detach().numpy()), dtype=torch.float32))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Soft ranked data:\n&quot;</span>, soft_rank(ts, regularization_strength=<span class="number">0.1</span>))</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Original data:</span></span><br><span class="line"><span class="string"> tensor([[-0.7919,  2.1005, -0.8140, -0.0836,  0.7290,  0.5838,  0.9163, -0.0866,</span></span><br><span class="line"><span class="string">          1.0455,  0.7178]], requires_grad=True)</span></span><br><span class="line"><span class="string">Rank of data:</span></span><br><span class="line"><span class="string"> tensor([ 2., 10.,  1.,  4.,  7.,  5.,  8.,  3.,  9.,  6.])</span></span><br><span class="line"><span class="string">Soft ranked data:</span></span><br><span class="line"><span class="string"> tensor([1.5000, 9.5000, 0.5000, 3.4509, 6.5000, 4.5000, 7.5000, 2.5491, 8.5000,</span></span><br><span class="line"><span class="string">        5.5000], grad_fn=&lt;DivBackward0&gt;)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><p>不过这一差异对于相关性的计算没有任何影响。</p><h3 id="方法-2：fast-soft-sort-by-Google-Research"><a href="#方法-2：fast-soft-sort-by-Google-Research" class="headerlink" title="方法 2：fast-soft-sort by Google Research"></a>方法 2：<code>fast-soft-sort</code> by Google Research</h3><p>凭借 Google 对 <a href="https://arxiv.org/abs/2002.08871">Fast Differentiable Sorting and Ranking</a> 的研究和开发，我们有了可以直接调用的 Soft Sort 和Soft Rank 的工具：<a href="https://github.com/google-research/fast-soft-sort?tab=readme-ov-file"><code>fast-soft-sort</code></a>。使用方式相当简单：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fast_soft_sort.pytorch_ops <span class="keyword">import</span> soft_rank</span><br><span class="line"></span><br><span class="line">ts = torch.randn(<span class="number">1</span>, <span class="number">10</span>, requires_grad=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Soft ranked data:\n&quot;</span>, soft_rank(ts, regularization_strength=<span class="number">0.1</span>))</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Soft ranked data:</span></span><br><span class="line"><span class="string"> tensor([5.5000, 3.5000, 6.5000, 1.5000, 4.5000, 7.5000, 2.5000, 8.5000, 0.5000,</span></span><br><span class="line"><span class="string">        9.5000], grad_fn=&lt;DivBackward0&gt;)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure><h2 id="方法比较"><a href="#方法比较" class="headerlink" title="方法比较"></a>方法比较</h2><p>从性能上看，方法 2 远超 方法 1。</p><p><code>fast-soft-sort</code> 的时间复杂度为 $O(n\log{n})$，空间复杂度为 $O(n)$，而直接实现的函数时间复杂度和空间复杂度都是 $O(n^2)$。实践上看也的确如此，当数列长度大于 5000 时，两者性能差异就已经很明显了，这里就不进一步测试了。</p><p>当然，方法 1 也不是没有优点，它直接使用 PyTorch 内置方法实现，无需引入其他库。另外，<code>fast-soft-sort</code> 底层算法使用 NumPy 实现，因此必须先将 <code>Tensor</code> 通过 <code>.cpu()</code> 转移到 CPU 上进行计算，再转移回 GPU 中，这也会带来一定的性能消耗。好在，也有人实现了 <a href="https://github.com/teddykoker/torchsort">Torchsort</a>，它采用了和 <code>fast-soft-sort</code> 相同的算法，但是使用 PyTorch 内置方法实现。我没有使用过这一工具，感兴趣的读者可以自行尝试。</p><h2 id="Soft-Rank-参数"><a href="#Soft-Rank-参数" class="headerlink" title="Soft Rank 参数"></a>Soft Rank 参数</h2><p>你可能注意到，两种方法都存在 <code>regularization_strength</code> 这一参数。这个参数的效果如下：</p><table><thead><tr><th>优缺点</th><th>参数较大时</th><th>参数较小时</th></tr></thead><tbody><tr><td>优点</td><td>相关系数梯度较大，可能更容易收敛</td><td>rank 值估算更精确，秩相关系数误差较小</td></tr><tr><td>缺点</td><td>rank 值估算更粗糙，秩相关系数误差较大</td><td>相关系数梯度较小，可能不容易收敛</td></tr></tbody></table><p>且在参数不变的情况下，样本量增大同样会导致估计精确程度的下降。但是估计精度仅仅是对于 soft rank 后数值的分布而言。无论参数如何，soft rank 后数值的顺序都是完全正确的。</p><h3 id="不同参数下估计准确程度对比"><a href="#不同参数下估计准确程度对比" class="headerlink" title="不同参数下估计准确程度对比"></a>不同参数下估计准确程度对比</h3><p>首先，生成两组随机数据进行测试：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设定样本数量</span></span><br><span class="line">num_samples = <span class="number">5000</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 均值</span></span><br><span class="line">mu = np.array([<span class="number">0</span>, <span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 协方差矩阵</span></span><br><span class="line">r = np.array([</span><br><span class="line">    [<span class="number">1</span>, <span class="number">0.5</span>],</span><br><span class="line">    [<span class="number">0.5</span>, <span class="number">1</span>]</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用相关函数，生成随机数</span></span><br><span class="line">rng = np.random.default_rng()</span><br><span class="line">y = rng.multivariate_normal(mu, r, size=num_samples)</span><br><span class="line"></span><br><span class="line">y_true = torch.tensor(y[:, <span class="number">0</span>], dtype=torch.float32, requires_grad=<span class="literal">True</span>).reshape(-<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">y_pred = torch.tensor(y[:, <span class="number">1</span>], dtype=torch.float32, requires_grad=<span class="literal">True</span>).reshape(-<span class="number">1</span>, <span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>此时，两组数据分布如下：</p><p><img src="/posts/af905acf/image-20241023204947513.png" alt="两组数列分布图"></p><p>以下两图展示了在不同参数下，同一组数据使用 <code>soft_rank</code> 计算的结果与精确计算 rank 的结果的相关性：</p><p><img src="/posts/af905acf/image-20241023205011669.png" alt="不同参数下，估算值与精确值相关性展示"></p><p>此时，在我预设的数据下，计算出来的相关系数为</p><table><thead><tr><th>精确 Rank IC</th><th>参数为 0.001 时 Soft Rank IC</th><th>参数为 0.0001 时 Soft Rank IC</th></tr></thead><tbody><tr><td>0.46844181418418884</td><td>0.4764254093170166</td><td>0.46844363212585</td></tr></tbody></table><h3 id="不同参数下-Rank-IC-梯度对比"><a href="#不同参数下-Rank-IC-梯度对比" class="headerlink" title="不同参数下 Rank IC 梯度对比"></a>不同参数下 Rank IC 梯度对比</h3><p>下图绘制了当 <code>regularization_strength</code> 分别取值为 0.001 和 0.0001 的情况下，以及直接计算 IC（而非 Rank IC）的情况下，IC 的梯度向量中数值的分布，并标注了每个分布的 25% 和 75% 分位的位置。</p><p><img src="/posts/af905acf/image-20241023205213659.png" alt="不同参数下以及 IC 计算后梯度向量数值分布"></p><p>可以看到，当 <code>regularization_strength</code> 取值为 0.001 时，梯度向量中数值的分布与直接计算 IC 相似，但当取值为 0.0001 时，梯度向量中数值除了少数离散值以外，数量级都很小，以至于 25% 和 75% 分位线都无法分辨。</p><h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><ul><li>相比方法 1，方法 2 的复杂度远远更低，从性能角度考虑，如果没有特别需求，建议使用方法 2。</li><li><code>regularization_strength</code> 除了影响估算精度以外，也会影响梯度的分布。实际应用时，应当充分考虑两边的利弊来调整参数。</li></ul>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具 </tag>
            
            <tag> 深度学习 </tag>
            
            <tag> 损失函数 </tag>
            
            <tag> Soft Rank </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v4丨Week 6：逐渐上手</title>
      <link href="/posts/6a6a1b0a/"/>
      <url>/posts/6a6a1b0a/</url>
      
        <content type="html"><![CDATA[<p>果然印证了我的判断：人的适应能力比自己想象的更强。这周开始，我对于深度学习的框架有了一定掌握，并且开始提出自己的质疑和思考。</p><p>这一次的训练大幅提升了训练集容量，这么做的结果是过拟合与不能拟合的情况确实减少了，但坏消息是，回测的情况看上去依然很差。仔细排查了代码，我发现一个可能很致命的问题：原本代码的损失函数，是将预测值与真实值的相关系数取绝对值再取负数。这一点致命之处在于，无法区分正相关与负相关，可能导致模型向相关系数为负且不断接近 -1 的方向收敛！</p><p>于是我绘制了不少图表，整理了一波这次的训练结果，做好了下周向带教老师回报的准备。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v3丨Week 5：群策群力</title>
      <link href="/posts/42d27edd/"/>
      <url>/posts/42d27edd/</url>
      
        <content type="html"><![CDATA[<p>时间过得好快，而我的进展好慢。</p><p>带教大概看出我的状态不是很好，遂要求我每日提交一段工作总结到微信群。这样倒挺好的，还能倒逼自己一下。</p><p>这周做的事情也不太多，回测数据并形成了一份训练及结果的报告（用 <a href="https://marp.app/">Marp</a> 做完了 Slides，感觉还不错，效率挺高的），跟带教在线展示讨论了一会，确定了下一步能够改进的方向。</p><p>这周结束前还分到了一个新的北京服务器，终于不用再跟其他实习生抢算力了！</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v3丨Week 4：深度幽灵</title>
      <link href="/posts/d3610788/"/>
      <url>/posts/d3610788/</url>
      
        <content type="html"><![CDATA[<p>由于国庆前仅有 1 个工作日，因此将这个工作日也合并到上周一起写了。</p><p>本周状态有所回升，RNN 的代码总算跑起来了。由于设备性能的限制，仅使用了小样本数据来试跑，可惜效果不佳。此时带教总算想起他还没有给我公司的算力，于是我又吭哧吭哧把代码转移到服务器上，在节前将更大样本的代码跑起来了。</p><p>滚动训练-预测的模式下，需要训练大量模型，我也肉眼盯了一下各个模型的训练过程，发现训练与训练的悲欢并不相通。有的模型一开始测试集 loss 很大，但是能够迅速下降，最后收敛到较低数值；有的一开始就 loss 很小，但是随着训练进行反而越来越大；有的在测试集 loss 下降到较低位置后开始上升，有明显过拟合现象；有的则半死不活，loss 几乎没有什么变化。</p><p>这让我开始思考，训练时是不是应该对各个模型加以更加精细的调教，或者在训练失败的情况下，多随机几次参数重新训练一下。当然，重新训练的成本很高，因此当务之急，似乎是考察一下当前训练的结果，并看看不同训练效果下，因子回测效果如何。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v3丨Week 3：仍然没有适应</title>
      <link href="/posts/550011ce/"/>
      <url>/posts/550011ce/</url>
      
        <content type="html"><![CDATA[<p>第三周了，虽然这周只有三天，但是状态依然很差。待在荒郊野岭公寓中的小房间里，连续几日不与任何人接触，寂静得令人发疯。</p><p>思维不清晰，稍微想一会就猪脑过载，编码进度缓慢。身后就是床，让人经常想偷懒，完全无法进入工作状态。无法推进工作的焦虑和因焦虑而导致的工作无法推进形成正反馈，将焦虑推向至高峰。</p><p>这周仍旧对 GRU+NN 的深度学习框架进行修改，解决了上周遗留下来的几个问题，现在终于能跑了，但是注意到几个问题：</p><ol><li>模型收敛疑似不正常，随着 epochs 迭代，测试集能够逐渐收敛，而训练集却常常震荡，非常奇怪。</li><li>模型运算耗时相当长。我只用了今年到最近为止的数据，且上百条的特征只随机选取了其中的 10 个，训练一个模型也需要几分钟。如果每小时迭代一次模型，那么相当于需要训练 5000 多个模型！这意味着我的电脑根本无法完成任务，只能寄希望于公司未来可能提供的服务器算力，以及减少模型训练的次数，将模型的利用最大化。</li><li>代码非常屎山，我自己都看不下去。溢出屏幕的语句、数十个参数的 class、毫无章法的代码组织形式，使得这一份工作到目前为止相当丑陋。好在带教没有 push，先硬着头皮这么用吧。</li></ol><p>总而言之，这个框架踉踉跄跄地能跑起来了，但是目前看来并没有机会计算出足够用来回测的因子。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v3丨Week 1 &amp; 2：赶鸭子上架</title>
      <link href="/posts/b8fcf2dc/"/>
      <url>/posts/b8fcf2dc/</url>
      
        <content type="html"><![CDATA[<p>再一次开始一段实习时，发现自己写日记的冲动没有之前那么强烈了，不过思来想去，保持一个思绪的出口总是有利的，于是暂定接下来一周发表一篇周记。</p><p>由于入职匆忙，来到北京鸟不屙屎的地方租了个月租 2000 的一居室，前两周总体来说是兵荒马乱的，现在才有时间（和心情）坐下来总结一番，因此前两周就先合并这么一起写了。</p><p>这次顺利入职了一家稍微有点名气的私募，研究加密货币的交易。在另一个不太想接的offer到期前极限笔面收到这家公司的聘任，称得上是幸运了。老板和带教都很好说话，虽然见不到面，但是微信聊起来都难得地有礼貌修养。目前我还没有被 push 过，但我还是会紧张地 push 自己。</p><p>我目前主攻方向是深度学习高频因子挖掘，非常酷的新方向，唯一的麻烦在于我除了上课以外，基本没有接触过深度学习……本以为凭借自己的快速学习能力可以三两下上手，可还是费了一两天才把代码看明白。接下来的一周需要修改模型来适应我的研究方向。尽管可能还会遇到不少问题，不过我想这应该仅仅是一个工程问题了。</p><p>既然入职了就不过是好好干而已，可是焦虑似乎却未见减少。前两天忍不住把简历发给一个猎头并咨询道，加上目前刚开始的这一段实习，大概可以进入什么公司？猎头的答复是，有的公司（如稳博）对我目前公司出来的实习生很感兴趣，但有的公司（如灵均九坤）就不太喜欢。老实说，这不算一个坏消息，因为经过前段时间的拷打，我甚至没有对诸如稳博这种级别的公司抱有期望。这至少说明，我接下来的经历足够我尝试一些主流的量化机构。不过猎头也提到，应聘还是得看笔面试表现，再次提醒我笔面水平要过硬。这意味着数学、统计、脑筋急转弯、算法等等素质缺一不可，都是接下来需要逐步准备的。而深度学习的知识学习和训练、竞赛等丰富简历的经历、健身、阅读、兴趣爱好……工作外能做的事情实在太多了，出租屋里的环境对工作又不太友好，这些对我来说都是令人焦虑的因素。</p><p>我深刻地知道，目标无法退让的条件下，缓解焦虑最好的办法就是当即着手去做，因此我也希望自己能过上更有组织性的生活，这意味着克服拖延、有节奏地计划每一天的行动并执行。不如先从简单的开始做起，写下明天的任务单，看看生活会有什么改变吧。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>阅读笔记丨《额尔古纳河右岸》——少数民族消亡史</title>
      <link href="/posts/d0a0c715/"/>
      <url>/posts/d0a0c715/</url>
      
        <content type="html"><![CDATA[<p><img src="/posts/d0a0c715/s1515368.jpg" alt="额尔古纳河右岸"></p><p>额尔古纳河右岸一书，就是一部古老的游牧文明被现代文明蚕食直至消亡的历史。鄂温克族这一民族仍有后裔，但是不再放牧驯鹿、不再居住在乌力楞，也不再有萨满了，这实际上意味着这一文明的消失。</p><p>鄂温克族的生活是相当有秩序的。他们分布在一个个乌力楞中，逐水草而居，有自己的神明。每个部落各自有酋长和萨满，一个酋长死后会推举新的酋长，一个萨满死后三年会自然诞生一名新的萨满。他们将去世的孩子葬在向阳的山坡，将去世的成人葬在树间的山风中。在大兴安岭山脉中，这样的民族自有其生存循环的逻辑，他们的生活方式是自洽的，本可以就这样无穷尽地继承下去。</p><p>然而，自从日本人进入山林开始，直到新中国的工业轰隆声笼罩整座山脉，传统文明与现代文明开始发生无法避免的冲突与融合。当族人被强迫下山训练，当林中树木和苔藓越来越少，这一文明的生活循环被掐断了。他们无法再依赖原有的方式继续下去，这一民族被迫与外界进行频繁接触，其所赖以生存的自然环境受到连续的挤压与破坏。而文明与文明之间并不兼容，最终一定会有一种文明将另一种文明吞没，而鄂温克族的文明就是被吞没的那一个。</p><p>仔细想想，外面的世界真的不可接受吗？小说对于这一问题的描述相当冷静。对山林的开发使得这里不再适宜大量驯鹿和鄂温克族人居住，但是社会主义的世界也带来了免费安全的住宿条件，提供了良好的医疗和教育资源。人们的寿命将得到大幅延长，不用再为寒冷饥饿所威胁。外界的文明早就铺好道路，准备将这一民族的人们全部接纳为它的一部分。</p><p>然而作为代价的，是整片浩瀚的星空、森林的露水、充满神性的驯鹿、这一古老的文化体系。这一文化是如此美丽，人们对于自然的深刻理解如此动人。读完后我想，故事中的人们无论是喜是悲，都具有如此鲜活、如此厚重的生命；而习惯居住于城市中的的众人，却好像都沿着一条既定的人生路径盲目地行走，轻飘飘地像一片羽毛。究竟怎样的生活称得上更好呢？</p>]]></content>
      
      
      <categories>
          
          <category> 赏阅纪 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 阅读笔记 </tag>
            
            <tag> 额尔古纳河右岸 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day -1：大结局 &amp; 复盘</title>
      <link href="/posts/953424b/"/>
      <url>/posts/953424b/</url>
      
        <content type="html"><![CDATA[<p>距离职仅剩最后几日了，三个月的时间过得真快。</p><p>最后的时间里，带教没有再给我安排策略研究的工作，而是让我对数据再作一番筛选，算是用任务填充一下离职前的工作空窗。但我心猿意马，已经在考虑下一段实习的投递，因此大部分时间无心工作，转而刷了十几道 LeetCode 题。</p><p>既然如此，这几日的实习日记也就不写了，不如好好总结一下这段时间的经历与思考，复盘一下成功与失败的经验。平时产生的想法总是零零散散，因此这篇文章也许会写得慢一些，并时不时增添新的内容。</p><h2 id="这段时间，发生了什么？"><a href="#这段时间，发生了什么？" class="headerlink" title="这段时间，发生了什么？"></a>这段时间，发生了什么？</h2><h3 id="面试与-Offer"><a href="#面试与-Offer" class="headerlink" title="面试与 Offer"></a>面试与 Offer</h3><p>三个月以来，我在一家期货公司担任量化投研实习生。进入这家公司的经历很有趣，当时我正被上一家公司裁掉，一股脑投了几十份简历，回应的公司当然也寥寥无几。接到这家期货公司的电话时，面试官完全没有问那些典型的量化面试题，而是深度追问了我过往的实习项目，并确认了一下我的代码水平。</p><p>这家公司就这么发了 offer。</p><h3 id="我做的事情"><a href="#我做的事情" class="headerlink" title="我做的事情"></a>我做的事情</h3><p>入职以后，我花了三周左右的时间，专门负责寻找和整理数据。由于我将会主要开展基本面量化研究，因此对数据的发现和筛选就极为重要。最初，我主要对黑色板块进行需求分析，因此我对照着研报，整理了数百条黑色品种下游行业的基本面指标，包括产量、销量、开工率等等。</p><p>数据整理完成后，我便开始对黑色板块整体进行择时研究。这一部分对我来说是进度最慢、最没有思路的环节。由于带教倾向于让我自己探索研究，因此没有给我指定很明确的方向。而我彼时对于期货投研毫无概念，故而全无思路，只能就相关性作一些盲目的分析，最后选取几个看似不错的数据进行简单的回测。可以想见，这样做的效果非常差——尽管我的回测净值曲线能够在训练集中高歌猛进，但是一旦进入测试集就一落千丈。毫无疑问，这意味着严重的过拟合。这段时间里我相当郁闷，进展也不足。由于公司开发的回测框架远远不能满足我的需求，我还花了不少时间自己写了一份回测框架（并一直在使用）。这个自研的回测框架相比公司的框架性能提升了百倍不止。</p><p>后来，在一次与带教的深入讨论后，我开始采取更加精细化的数据处理方式：挑选我认为有经济逻辑的数据，分别一个个作滞后、移动平均、时序排序、差分等处理，再对黑色板块价格指数进行回测。一通测试之后，选出几个效果较好的指标进行简单线性合成，最后再针对某些年份的回撤进行具体的处理。处理完效果很不错，无论是本地回测还是用公司的框架回测，都能得到大于 1 的夏普。</p><p>黑色板块的择时因子提交后，我又花了一周时间整理有色板块的下游行业基本面数据，但是最后并没有使用这些数据，而是转而做了仓单因子和期限结构因子的研究。这两个因子的研究相对就简单多了，只需要找到一两篇合适的研报照猫画虎，再按照自己的理解修正一下，基本就能得到不错的结果。这两个因子的研究过程大概持续了两三周。</p><p>回头来看，这三个月来提交的工作成果其实并不很多。想来，大部分时间是消耗在了与研究没有直接关联的环节上，比如开发回测框架、折腾公司的回测框架、找数据等等；而即使是在研究上，似乎也常常在没有头绪的混沌中内耗而毫无进展。因此总体来说，这不是一段高效产出、成果丰硕的实习。</p><h2 id="基本面量化研究的特征"><a href="#基本面量化研究的特征" class="headerlink" title="基本面量化研究的特征"></a>基本面量化研究的特征</h2><p>还记得上一段实习面试的时候，面试官曾问我：基本面量化有什么困难？当时我说不出什么所以然，但是现在有了一些新的想法：</p><ul><li>数据的频率与滞后性。基本面数据往往频率很低。我所用来作基本面分析的数据，几乎都是月频或更低频的数据。这样的发布频率必然导致回测样本较小，比如十年内最多提供 120 个调仓信号，十分容易过拟合。而基本面发生改变往往不会立即对合约价格产生影响，而是需要将影响慢慢传导到价格上。这样的传导过程有快有慢，同样给策略研究带来了难度。</li><li>基本面印象因素的广泛性。从较大的时间尺度来看，商品合约的价格的影响因素非常多。从宏观的经济周期到中观的供需关系、库存、预期、政策等因素，再到短期的情绪、套利行为，一个单一的基本面指标很难对某一商品的价格具有很强的相关性。而又由于上述的样本小的原因，没有办法在足够长期的视角下评判一个指标对于价格是真的会产生影响还是仅仅存在相关性。</li></ul><p>我想，基本面研究对我而言最大的好处在于，不苛求很底层的编程技术，也不需要对机器学习和神经网络这些工具精通，但是需要有比较好的市场逻辑观点，而这恰恰是与我的经历相符合的。</p><h2 id="关于接下来的计划"><a href="#关于接下来的计划" class="headerlink" title="关于接下来的计划"></a>关于接下来的计划</h2><p>当然是继续投递下一份实习了。面对当今的市场行情，实习经历似乎多少都不够。</p><p>对于下一份实习的方向，我其实没有什么具体的想法。做 CTA 很好，但是我也愿意尝试不同的路径：股票、数字货币、固收；高频、中频、低频；因子、规则、技术指标；机器学习、手搓因子、自动挖掘，我目前愿意尝试不同的实习方向。我觉得，不论是什么细分领域的实习，都能够为我整体知识技能体系的构建有所贡献。有时候人容易陷入抉择的内耗中，但与其犹豫不决，不如先动手做做看。我相信，前进总比停滞要好。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 54：就这么着吧</title>
      <link href="/posts/75f46a68/"/>
      <url>/posts/75f46a68/</url>
      
        <content type="html"><![CDATA[<p>尝试对策略进行风险管理，但是几无思路。上网找了一些资料，尝试了两种方法，一种是根据策略回撤来决定是否开平仓，一种是根据各品种净值回撤来调整各品种持仓权重。但是无论是哪一种方法，效果都不好，只会导致原本的夏普比率下降。这样做真的有意义吗？</p><p>把当前工作写了文档发给带教，带教让我先把黑色和有色的数据再筛一遍。感觉这段时间确实没学到什么……而且筛数据的事情现在另外两个实习生也在做，感觉实际上就是不知道给我安排什么活了。接下来就慢慢摸鱼？</p><p>过几天就离职了，感觉最后的工作并没有啥产出，稀里糊涂地这三个月就这么结束了。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 51：周五综合征</title>
      <link href="/posts/2746c340/"/>
      <url>/posts/2746c340/</url>
      
        <content type="html"><![CDATA[<p>上午提交了一下因子代码，但是下午带教让我再多想想，把夏普进一步提高一下。</p><p>然而今天是又一个周五，慵懒的气息弥漫在办公室里，加之下午又困困的，实在是不想再工作了，于是读了一篇关于高频交易的<a href="https://mp.weixin.qq.com/s/fRhgKDWW3TigoPuLRF8Kjg">科普文章</a>，读到一半真的开始打瞌睡了，于是又刷了刷手机，决定把下午就这么消耗掉算了。</p><p>对着日历算了算，今天结束之后，在这家公司的时间就只剩一周多几天了，时间过得真快。回头想一想，实在不觉得自己做了很多事情，除了做数据确实占用了一些时间以外，自己的摸索和思考也消耗工作时长，而且这样的过程里是没有明确成果产出的。</p><p>大部分研究策略的时间，我在做黑色板块策略的研究。由于几无参考，我完全是凭自己的感觉摸索出来了这个因子，当然中途也有不少带教和领导的点拨。相比之下，复现研报就快得多了，只需要按照研报上的方法一步一步做就可以了，而且这样的正反馈也更加及时，是容易产生成就感的。总得来说，鉴于我目前对于量化策略的研究仍然处于入门的阶段，也许多读一读研报论文，并以复现调优为主的工作能够带来更快的能力提升。</p><p>这段时间以来，我的研究一直缺乏系统性，有些碎片化。有时候找一下数据，偶尔又做一做横向项目，还常常花大量时间自己盯着数据思考构建因子的逻辑，简单的研报也复现了两三篇，无论是哪个工作都不够系统，而这家公司给我提供的工作范式本来就是不太系统的，这促使我在考虑下一份实习时，仍然倾向于先从量化私募开始投起。</p><p>然而量化私募哪有那么好投，何况这几个月来行情不但没有好装，反而依然在变得越来越差。两周？一个月？一切似乎只能慢慢来。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 50：不合预期但确实神奇的期限结构因子</title>
      <link href="/posts/d247b77c/"/>
      <url>/posts/d247b77c/</url>
      
        <content type="html"><![CDATA[<p>今日花了一天时间，好好检查了一下数据和程序逻辑，重点检查是否使用了未来数据；接着将目前为止所做的工作写了一份报告提交给带教，真够折腾的。</p><p>尽管做策略的时候已经很小心了，但是果然还是在不经意间引入了未来数据。而罪魁祸首就是 <code>pandas.DataFrame.resample()</code> 这一方法。</p><h2 id="pandas-的-resample-之谜"><a href="#pandas-的-resample-之谜" class="headerlink" title="pandas 的 resample() 之谜"></a><code>pandas</code> 的 <code>resample()</code> 之谜</h2><p>使用这一方法的场景是，由于我的回测框架无法设置调仓频率，因此不得不通过将因子值降频来保证非调仓交易日的因子值与上一交易日的因子值相同，以此来达到不调仓的效果。要做到这一点，我的思路是先将因子 <code>resample()</code> 一下，取最后一个值，然后再通过 <code>reindex()</code> 回到之前的因子格式，举例如</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># use resample() to resample</span></span><br><span class="line">index = pd_shift.index</span><br><span class="line"></span><br><span class="line">factor = pd_shift.resample(<span class="string">&quot;20D&quot;</span>).last()</span><br><span class="line">factor = factor.reindex(index)</span><br><span class="line">factor = factor.fillna(method=<span class="string">&#x27;ffill&#x27;</span>)</span><br></pre></td></tr></table></figure><p>然而这一方法的使用却出现了意外：<code>resample()</code> 的重采样是严格的，在它想要采样的时点，如果该时点不在原本的 <code>index</code> 中，就会将上一个找到的值强行作为这一时点的采样值。而因子值的 <code>index</code> 是确实了大量日期的，因为一部分日期不是交易日。这就会导致，有的重采样点会出现在非交易日，造成最后结果不符合预期。</p><p>为了保证按照原数据的 <code>index</code> 来重采样，就需要用到 <code>DataFrame</code> 的 <code>groupby()</code> 方法，如</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># use groupby() to resample</span></span><br><span class="line">index = pd_shift.index</span><br><span class="line"></span><br><span class="line">reindexed_pd_shift = pd_shift.reset_index()</span><br><span class="line">num_index = reindexed_pd_shift.index</span><br><span class="line"></span><br><span class="line">factor = reindexed_pd_shift.groupby(num_index // <span class="number">20</span>).last()</span><br><span class="line">factor = factor.set_index(<span class="string">&#x27;index&#x27;</span>)</span><br><span class="line">factor = factor.reindex(index)</span><br><span class="line">factor = factor.fillna(method=<span class="string">&#x27;ffill&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="期限结构因子"><a href="#期限结构因子" class="headerlink" title="期限结构因子"></a>期限结构因子</h2><p>上一篇日记提到，我主要研究了两个期限结构因子：</p><h3 id="展期收益率因子"><a href="#展期收益率因子" class="headerlink" title="展期收益率因子"></a>展期收益率因子</h3><p>$$<br>R_t &#x3D; \left[\ln{\left(P_{t,n}\right) - \ln{\left(P_{t,d}\right)}} \right] \times {365\over N_{t,d} - N_{t,n}}<br>$$</p><p>其中，$P_{t,n}$ 和 $P_{t,d}$ 分别代表 $t$ 日近月合约与远月合约的价格，而 $N_{t,d}$ 和 $N_{t,n}$ 则分别代表远月合约和近月合约的到期日距离 $t$ 日天数。由于我手头数据并无合约到期日信息，因此我舍弃了因子结构的后半部分，实际上因子结构为<br>$$<br>R_t &#x3D; \ln{\left(P_{t,n}\right) - \ln{\left(P_{t,d}\right)}}<br>$$<br>变得更简单了。</p><p>这里能够调整的参数主要有二：</p><ul><li>持仓周期天数；</li><li>所选近月合约与远月合约组合，包括最近月合约与主力合约、最近月合约与次近月合约和最近月合约与最远月合约等。</li></ul><p>展期收益率可以理解为将近月合约平仓并向后展期到远月合约，这两个期货合约间的价差。若因子值为正说明近月合约价格高于远月合约价格，给出做多信号；反之则给出做空信号。</p><h3 id="基差动量因子"><a href="#基差动量因子" class="headerlink" title="基差动量因子"></a>基差动量因子</h3><p>$$<br>basis\ momentum&#x3D;\prod^t_{i&#x3D;t-R+1}\left(1+R^{T_1}_{fut,i}\right)-\prod^t_{i&#x3D;t-R+1}\left(1+R^{T_2}_{fut,i} \right)<br>$$</p><p>这一因子在一个给定的滚动窗口中反复计算两个合约的累计收益率，并作差来得到基差动量数值。其中，$R^{T_1}_{fut,i}$ 和 $R^{T_2}_{fut,i}$ 分别代表近月合约和远月合约在 $i$ 日的收益率，$R$ 表示计算累计收益率的窗口，得到的是 $t$ 日的因子值。</p><p>这里能调整三类参数：</p><ul><li>持仓周期天数；</li><li>所选近月合约与远月合约组合，包括最近月合约与主力合约、最近月合约与次近月合约和最近月合约与最远月合约等；</li><li>滚动窗口大小 $R$。</li></ul><p>因子值越大，说明近月合约价格的上涨幅度超过远月合约价格越多，则价差越可能回归，因此给出越强的做多信号；相反则给出越强的做空信号。</p><h2 id="回测结果"><a href="#回测结果" class="headerlink" title="回测结果"></a>回测结果</h2><p>以下回测均考虑 0.02% 的交易费率。</p><h3 id="展期收益率因子-1"><a href="#展期收益率因子-1" class="headerlink" title="展期收益率因子"></a>展期收益率因子</h3><p>对最近月合约与主力合约组合、最近月合约与次近月合约组合、最近月合约与最远月合约组合分别测试因子绩效。</p><h4 id="最近月合约与主力合约组合"><a href="#最近月合约与主力合约组合" class="headerlink" title="最近月合约与主力合约组合"></a>最近月合约与主力合约组合</h4><p>因子结构简单，但是有效。这一因子最有效的合约组合是最近月合约与主力合约。在这一组合下，因子收益率<strong>对参数不敏感</strong>，基本都能获得稳定收益，只是收益率有差别，这与因子带来的信息衰减和交易费率都有关。以 10 个交易日的持仓周期为例，本地回测结果：</p><p><img src="/posts/d247b77c/8c12dc51-417c-4e78-bdeb-705cc163fb35.png" alt="最近月合约与主力合约组合回测结果"></p><p>夏普比率能够达到 1.17。</p><h4 id="其他合约组合"><a href="#其他合约组合" class="headerlink" title="其他合约组合"></a>其他合约组合</h4><p>然而若尝试其他合约组合则会出现各种问题。无论是使用近月合约与次近月合约的组合，还是近月合约与最远月合约的组合，用同样的方式计算因子并回测的结果却呈现完全相反的结果。以最近月合约与最远月合约为例：</p><p><img src="/posts/d247b77c/dd5a9f2c-c3fb-4f4c-936e-6d58c3fc86fb.png" alt="最近月合约与最远月合约回测结果"></p><h3 id="基差动量因子-1"><a href="#基差动量因子-1" class="headerlink" title="基差动量因子"></a>基差动量因子</h3><p>由于这一因子存在更多参数，因此可以通过网格寻参来寻找较优参数。接下来，我将持有周期设为左轴，滚动窗口设为上轴来展示寻参结果，并仅展示回测的夏普比率数值。</p><h4 id="最近月合约与主力合约组合-1"><a href="#最近月合约与主力合约组合-1" class="headerlink" title="最近月合约与主力合约组合"></a>最近月合约与主力合约组合</h4><p>使用这一组合时，在本地回测能够得到较好收益曲线。本地参数网格搜索结果如下：</p><p><img src="/posts/d247b77c/tmpAAD.png" alt="最近月合约与主力合约组合网格搜索结果"></p><p>以回测结果较好的参数组合 (20, 210) 为例，回测结果如下图：</p><p><img src="/posts/d247b77c/a16f02bb-3b57-472f-809a-cd88ac0d6936.png" alt="参数组合 (20, 210) 回测结果"></p><h4 id="其他合约组合-1"><a href="#其他合约组合-1" class="headerlink" title="其他合约组合"></a>其他合约组合</h4><p>对于最近月合约与次近月合约和次近月合约的组合，则在本地回测效果欠佳。比如，对于最近月合约与次近月合约组合，其因子效果对于参数更加敏感，且基本都带来负收益：</p><p><img src="/posts/d247b77c/tmp8B03.png" alt="最近月合约与次近月合约组合网格搜索结果"></p><p>尝试 (25, 210) 这一本地回测结果为正的参数组合，本地回测结果如下：</p><p><img src="/posts/d247b77c/62aeba5f-3dbb-4133-aee0-9a3c70636849.png" alt="参数组合 (25, 210) 回测结果"></p><p>绩效尚可。但是由于参数的敏感性，这一收益曲线存在过拟合嫌疑。而尝试其他参数组合时，基本回测结果都很差劲。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>根据以上结果，无论使用展期收益率因子还是基差动量因子，都只有采用<strong>最近月合约与主力合约组合</strong>才能获得最稳健的收益。此外，我还稍微测试了一下因子在不同板块中的表现，似乎黑色板块相对是拖后腿的家伙，去掉这一板块之后，因子绩效倾向于变得更好。</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a class="link-card" target="_blank" href="https://www.htsec.com/jfimg/colimg/upload/20170309/38441489040672863.pdf"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">FICC系列研究之二——基于动量和期限结构的商品期货策略</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://www.htsec.com/jfimg/colimg/upload/20170309/38441489040672863.pdf</span></span></span></a></p><p><a class="link-card" target="_blank" href="https://www.htsec.com/jfimg/colimg/upload/20170821/7561503296377058.pdf"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">FICC系列研究之五——商品期货因子挖掘与组合构建再探究 </span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://www.htsec.com/jfimg/colimg/upload/20170821/7561503296377058.pdf</span></span></span></a></p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 49：更高、更快、更强</title>
      <link href="/posts/c8d7bab9/"/>
      <url>/posts/c8d7bab9/</url>
      
        <content type="html"><![CDATA[<p>今天仍旧在处理期限结构因子，但是大部分时间在做另一件事儿：优化回测框架的 <code>Position</code> 类的性能。</p><p>起因是在研究策略的时候，发现用自己开发的回测框架运行常常耗费大量时间，一次回测甚至要 3 秒。究其原因，发现性能瓶颈主要出现在 <code>Position</code> 类生成持仓数据的过程。这个过程会在一个 <code>for</code> 循环中处理每一日的持仓，而且仅使用 <code>pandas</code> 的方法来处理数据，效率极低。</p><p>于是我决定将这一过程也向量化。首先，需要每日将因子值正反排序，并取其 rank。由于 <code>numpy</code> 中没有类似的方法，于是我刚开始的想法是诉诸于 <code>scipy</code>。但是测试之后发现，<code>scipy</code> 并没有为 rank 的计算带来很高的效率提升。对源代码层层拨茧抽丝，发现 <code>scipy</code> 实现时完全使用 <code>numpy</code> 进行计算，而 <code>pandas.DataFrame</code> 的 <code>rank()</code> 方法本来就是用 Cython 实现的，自然不会有很大的性能差异。因此，rank 的计算就交给 <code>pandas</code> 本身了。后续，我将数据由 <code>DataFrame</code> 转换成 <code>NDArray</code>，一通操作，又处理了一大堆 bug、warning 和计算结果不一致的问题，最后终于将函数改写成效果一样，但性能差异巨大的另一个函数。经过测试，新的函数计算效率能够达到原函数的几十上百倍。</p><p>有了快速回测的函数，终于可以愉快地对策略调参了。这个期限结构的策略真的很有意思，它带来的信息不会迅速衰减，因此即使按照 20 日的频率调仓都能够带来很好的正收益，而且曲线相当稳定，即使考虑了一定的交易费率。我仔细检查了因子逻辑，应当是没有使用到未来数据。而再用公司的回测框架测试，效果也十分可观。</p><p><img src="/posts/c8d7bab9/84ec4dd7-17af-4b1e-97a4-284cecfcca0b.png" alt="策略回测结果"></p><p>这件事相当神奇，因为一个这么简单的因子按道理不会有这么漂亮的收益。而这不是最令我费解的部分。诡异的事情在于，如果要得到这样好的收益，我必须要将因子值做成研报所展示的因子的相反数。也就是说，研报上的逻辑要做多时我应该做空，研报上的逻辑要做空时我则应该做多。这不太正常，尽管我对于这一因子的经济逻辑仍然理解得不是很清楚。但是应该不是我的回测框架的问题，因为我的因子值即使在公司的回测框架上也能得到很好的收益，乃至 2 以上的夏普比率。</p><p>明天要再好好检查一下因子逻辑是否有问题，不行就跟带教讨论一下好了。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 48：更神奇的期限结构因子</title>
      <link href="/posts/6a2aaf19/"/>
      <url>/posts/6a2aaf19/</url>
      
        <content type="html"><![CDATA[<p>上午向带教确认了一下，才搞明白我需要做的不是买近卖远或者卖近买远，而是根据远近合约的价差来交易主力合约。因此尽管因子的构造方式可能与近远月合约有关，但是交易和它们没有关系。</p><p>盯了半天数据，实在没有什么思路。于是决定上网找找研报，发挥一下我查找资料能力的比较优势。好不容易寻得海通证券的两篇量化研报，一篇来自 2014 年，一篇来自 2015 年，都相当古老了。</p><p>第一篇研报给出的相关因子很简单，就是给出一个展期收益率因子：</p><p>$$<br>R_t &#x3D; \left[\ln{P_{t,n} - \ln{P_{t,d}}} \right] \times {365\over N_{t,d} - N_{t,n}}<br>$$</p><p>其中 $P_{t,n}$ 和 $P_{t,d}$ 可以代表近月远月合约，也可以代表近月和次近月合约、近月和主力合约、甚至主力和次主力合约。</p><p>文章用 5 日、10 日等周期来截面交易，但是我编写的功能贫瘠的回测框架暂时只支持每日交易，因此我也就没管那么多，先拿来试一试。结果很神奇，上述不同的合约组合有的能赚钱，有的不赚钱，有的甚至要将因子值取相反数才赚钱。</p><p>下班前又试了试第二篇研报，这篇研报稍微认真了点儿，参考了一篇国外的论文，整了一个更复杂的因子：<br>$$<br>basis\ momentum&#x3D;\prod^t_{i&#x3D;t-R+1}\left(1+R^{T_1}_{fut,i}\right)-\prod^t_{i&#x3D;t-R+1}\left(1+R^{T_2}_{fut,i} \right)<br>$$<br>这里的 $R^{T_1}_{fut,i}$ 和 $R^{T_2}_{fut,i}$ 同样指的是不同期限的合约。这个因子多了一个参数，也就是用来滚动计算的窗口 $R$。为了寻参方便，我不得不将耗时过长的 <code>pandas.DataFrame.rolling()</code> 用向量化的方法重新实现，果然效率提高了几十倍。Pandas 原来这么垃圾。</p><p>研究尚未进行完全，等结论比较清晰了再详细写一下这类因子好了。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 47：月差？</title>
      <link href="/posts/41231dca/"/>
      <url>/posts/41231dca/</url>
      
        <content type="html"><![CDATA[<p>今日本想在有色金属的基本面研究上大展宏图，结果带教又甩出一份数据，是另一个实习生做的月差数据，用来做跨期套利策略。看了半天，感觉数据有点问题，而且网上也没有很多有用的资料，挠头。</p><p>至于有色金属的基本面，神奇的是，之前黑色板块的众多因子似乎大部分也还能一用，虽然效果好像也不是特别好。也许有色金属最终的策略可以多用一些指标，这样的结果可能会更加稳健。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 46：无所事事</title>
      <link href="/posts/29ae1c5c/"/>
      <url>/posts/29ae1c5c/</url>
      
        <content type="html"><![CDATA[<p>上午花时间补上了昨天的日记，结果今天就啥也不想干了，陷入一种奇怪的懒得工作的虚无中。</p><p>仓单因子做到这里，我感觉也没有啥非得做下去的内容了。尝试了一些不同的数据，发现能赚钱的只有有色金属和白银；探索一下其他的因子表达式，基本还是研报给的最有用；寻找一下最优参数，大概是 10，很快就找到了。</p><p>下周的任务应该围绕有色金属的基本面分析展开，这部分工作大概就跟黑色金属差不多了，希望顺利</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 45：神奇的仓单因子</title>
      <link href="/posts/1bbaf0dc/"/>
      <url>/posts/1bbaf0dc/</url>
      
        <content type="html"><![CDATA[<p>居然连续两天没有写日记了，至少补上昨天的吧。</p><p>这两天实际上在折腾一个新的小玩意，叫仓单因子。</p><h2 id="什么是仓单"><a href="#什么是仓单" class="headerlink" title="什么是仓单"></a>什么是仓单</h2><blockquote><p>  期货标准仓单是指现货商将手头上符合交易所交割标准的现货存放在交易所指定的交割仓库，并经检验合格后由交易所给现货商签发的一种实物提货凭证。</p><p>  当市场供给过剩，现货商认为期货价格比现货更有利时，会倾向于把现货注册成仓单，用于在期货市场中交割。反之当市场供不应求，现货价格更为有利时，现货商则会倾向于直接在现货市场中交易，从而减少仓单的注册，甚至注销已有仓单。</p></blockquote><p>因此，仓单因子实际上交易的是反转逻辑，反映的是市场供给的过剩或者不足。要应用仓单因子，就需要在仓单增加时做空，仓单减少时做多。</p><h2 id="仓单的适用性条件"><a href="#仓单的适用性条件" class="headerlink" title="仓单的适用性条件"></a>仓单的适用性条件</h2><p>仓单的增减若能反映市场供求关系，其首要条件是，仓单的注册或者注销必须完全是市场行为。但是这一条件并不能普遍被满足。根据<a href="https://www.founderfu.com/jiaogejicangdanguizejianbiao/426.html">交割及仓单规则简表 </a>，在所有商品期货中，除了 10 种期货以外，其他期货均设有有效期，这意味着仓单注册者必须在仓单到期前注销仓单，这是非市场行为，与产业方对商品供求的判断无关，因此无法反映市场状态。</p><p>上述的 10 种期货为：铜（cu）、铝（al）、锌（zn）、铅（pb）、镍（ni）、锡（sn）、白银（ag）、黄金（au）、原油（sc）和国际铜（bc）。而在其中，国际铜（bc）上市时间较短，以下不讨论。</p><p><img src="/posts/1bbaf0dc/image-20240628101305980.png" alt="不设有效期的仓单数据：以有色板块为例"></p><p>因此，从逻辑上，仅有这几种期货品种有可能适用于仓单因子交易。而从实践上看，以黑色板块品种为例，热轧板卷（hc）、螺纹钢（rb）、铁矿（i）等品种的仓单数据都会周期性地清零。</p><p><img src="/posts/1bbaf0dc/85d12307-bdc7-481d-821d-fae286c7ab5d.png" alt="周期性清零的仓单数据：以黑色板块为例"></p><h2 id="策略构造"><a href="#策略构造" class="headerlink" title="策略构造"></a>策略构造</h2><p>以下以这个简单的因子结构来对仓单因子进行讨论：<br>$$<br>factor_t &#x3D; -\left({warrant_t\over {1\over5}\sum^4_{i&#x3D;0}warrant_{t-i}}-1\right)<br>$$<br>其中 $warrant$ 表示各商品的仓单数量。这一因子的含义即仓单数量相对最近 5 日均值变化的相反数。因子值更大意味着更强的做多信号，相反则意味着更强的做空信号。</p><p>策略及回测分为两步进行：</p><ol><li>讨论仓单因子的择时能力。对于每个仓单因子可能适用的品种，当仓单因子数值为正时做多，数值为负时做空。</li><li>讨论仓单因子的截面择品种能力。对于每个交易日，选择仓单因子数值排名前 2 的品种做多，排名后 2 的品种做空。</li></ol><p>所有交易考虑 0.02% 的交易费用。</p><h2 id="回测结果"><a href="#回测结果" class="headerlink" title="回测结果"></a>回测结果</h2><p>以下若无特殊说明，均使用开盘价进行交易。</p><h3 id="单因子回测"><a href="#单因子回测" class="headerlink" title="单因子回测"></a>单因子回测</h3><p>对于单因子回测，其效果参差不齐，但是基本都能够得到正收益。</p><p><img src="/posts/1bbaf0dc/9e89c4f5-546e-473c-a83f-d21214324101.png" alt="较好的单品种回测结果：以铅（pb）为例"></p><p><img src="/posts/1bbaf0dc/c365ebe2-4954-4754-a453-05ae67986621.png" alt="较差的单品种回测结果：以铜（cu）为例"></p><h3 id="截面回测"><a href="#截面回测" class="headerlink" title="截面回测"></a>截面回测</h3><p>而截面回测的结果更加可观。为保证品种的可比性，以下截面回测在 6 种有色品种之间进行，即铜（cu）、铝（al）、锌（zn）、铅（pb）、镍（ni）、锡（sn）。</p><p><img src="/posts/1bbaf0dc/ceba5dd8-7f40-4e86-8419-821ae4b3f9e2.png" alt="有色品种截面回测结果"></p><h3 id="关于黄金（au）与原油（sc）的讨论"><a href="#关于黄金（au）与原油（sc）的讨论" class="headerlink" title="关于黄金（au）与原油（sc）的讨论"></a>关于黄金（au）与原油（sc）的讨论</h3><p>值得注意的是黄金（au）和原油（sc）仓单数据的特别性。这两个品种的仓单尽管不设期限，但是其仓单数据却常常连续几个月不发生任何变化，目前原因未知。</p><p><img src="/posts/1bbaf0dc/e2922a1c-d9eb-4853-b883-46e4a05779ca.png" alt="与白银（ag）不同，黄金（au）和原油（sc）仓单常常几个月保持不变"></p><p>而从回测结果来看，这两个品种基本不能应用仓单因子，而白银（ag）却能获得相当稳定的收益。</p><p><img src="/posts/1bbaf0dc/7131ddb2-6dfd-44ec-aed1-6da790b39025.png" alt="黄金（au）和原油（sc）基本不能通过仓单因子获得收益"></p><p><img src="/posts/1bbaf0dc/25488cc0-4491-4796-abca-b8d1a73c498d.png" alt="但是白银（ag）可以"></p><h3 id="关于价格数据的讨论"><a href="#关于价格数据的讨论" class="headerlink" title="关于价格数据的讨论"></a>关于价格数据的讨论</h3><p>仓单因子交易的是短期逻辑，其对交易时间十分敏感。同样是对有色板块的 6 个品种进行择品种交易，仅仅是将开盘价替换为收盘价，就会导致结果发生巨大差异。</p><p><img src="/posts/1bbaf0dc/cfe8068b-3343-4eb2-a0c4-bb64776ec869.png" alt="使用收盘价交易的绩效显著降低"></p><p>因此，仓单因子的交易要点是<strong>交易得越快越好</strong>。</p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a class="link-card" target="_blank" href="https://mp.weixin.qq.com/s/ns7TM4hWF3KAUDFfH9TiTw"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">再议仓单因子——测测截面策略的效果</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://mp.weixin.qq.com/s/ns7TM4hWF3KAUDFfH9TiTw</span></span></span></a></p><p><a class="link-card" target="_blank" href="https://mp.weixin.qq.com/s/EQcRkk6BPG3t28cHK78moQ"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">仓单因子的正确打开方式</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://mp.weixin.qq.com/s/EQcRkk6BPG3t28cHK78moQ</span></span></span></a></p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 43：错漏百出的代码</title>
      <link href="/posts/8ff6c948/"/>
      <url>/posts/8ff6c948/</url>
      
        <content type="html"><![CDATA[<p>今天读了一下带教给的处理期货数据的代码，完全被雷到了。</p><p>先说代码风格，其中一个文件 <code>TradeDay.py</code> 还是不错的，像模像样，但是另一个文件 <code>data_update_handler2.py</code> 就堪称乱七八糟，和前者肯定不是一个人写的。长得快要溢出 24 寸屏幕的语句、几十上百行的函数、30 个字符以上的变量名、冗余没啥用的逻辑充斥着整个文件，令人不忍直视。</p><p>利用一步一步 debug 的方式，总算是读完了所有代码。其实核心逻辑相当直白，就是把当前持仓量最大的合约当作主力合约。而在主力切换的时点，用新旧合约的 close 或者 vwap 价格来复权价格数据。但是其中的细节有两个重要的错误：</p><ol><li><p>一般而言，主力合约切换的原则是将连续几日持仓量都最大的合约作为新的主力合约，且主力合约切换都是向前切换，不可能再回退。而这段代码却简单将每日持仓量最大的合约作为主力合约，这不但可能导致主力合约提前切换，还可能导致主力合约发生回退（从实践上来看，确实会发生回退）。</p></li><li><p>这段代码会计算换月时产生的价差，并且将价格直接加上价差来成为复权后的价格。但是这样可能会导致收益计算不准确，比如，假设存在两个合约的价格序列：</p></li></ol>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">旧主力合约 A：[4, 6, 8, 10]</span><br><span class="line">新主力合约 B：[1, 2, 3, 4]</span><br></pre></td></tr></table></figure><p>  假设在第二日结束后换月，按照代码逻辑，直接将新合约价格加上价差，复权后价格序列应当是：</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">复权后价格 C：[4, 6, 7, 8]</span><br></pre></td></tr></table></figure><p>  但实际上，如果我在换月前持有 1 手合约 A，那么换月后我就持有 3 手合约 B，那么我的净值实际上应该是：</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">实际净值 D：[4, 6, 9, 12]</span><br></pre></td></tr></table></figure><p>  这会导致复权后的价格完全错误！</p><p>于是带教让我别看这份代码了，之前做啥继续做啥。也挺好的，阅读这样的代码确实是一种折磨。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 42：稍显混乱的工作进展</title>
      <link href="/posts/59f7f36f/"/>
      <url>/posts/59f7f36f/</url>
      
        <content type="html"><![CDATA[<p>上午又来了两位实习生，终于可以凑一桌麻将了。</p><p>一问带教才知道，原来有色数据还没开始弄😓，白等了两三天。不过既然没数据用不如自己捣鼓一下，复现了一下领导之前发在群里的<a href="https://mp.weixin.qq.com/s/EQcRkk6BPG3t28cHK78moQ">仓单因子研报</a>。</p><p>这篇研报非常神奇，它用的仓单数据是交易所每日公开发布的，用 WIND 或者 iFind 都很容易获取。而交易逻辑非常直白，仓单增加就做空，仓单减少就做多。实际测试一下，效果惊人。在没有引入未来数据的情况下，每个品种的收益基本都丝滑稳增，个别品种日频曲线收益竟然直逼 2000%，非常吓人。</p><p>趁兴用公司框架回测一下，立马被浇了一盆冷水。除了部分品种仍然能够保持不错的收益以外，另一部分品种的净值开始剧烈波动，甚至基本不能获得收益。更搞笑的是，为了达到和本地回测相似的效果，需要将因子值取相反数！</p><p>这一结果相当神秘，讲不清楚是公司回测框架的原因还是我自己的原因，恐怕还需要进一步研究。</p><p>这时带教又丢了个活，要我研究一下期货品种数据的处理。简单来说就是对主力品种换月这一情况作复权处理。近来工作进度有些混乱，有色弄到一半进度受阻，仓单因子研究了一个下午又没有后文（兴许也可以自己找时间做一做），现在又开始研究期货数据处理，好吧。离实习结束还有不到一个月，还会有什么成果产出吗？</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 41：回测框架逐步成型</title>
      <link href="/posts/10cdd80a/"/>
      <url>/posts/10cdd80a/</url>
      
        <content type="html"><![CDATA[<p>今天带教好像有点忙，似乎还没有处理完我的数据，而明天我又请了个假，也就是说我这周的工作就差不多是这样了。</p><p>在摸鱼的间隙还是决定继续构建一下回测框架。<code>Position</code> 这个类其实写起来挺麻烦的，我上次遗留的进度是将未赋权的持仓数据转换成赋权后的持仓数据。我预想了好几种权重计算方法，但是由于懒惰，仅实现了等权的计算函数，之后如果有其他需求再说。</p><p>接着，我又稍微写了一下因子基类 <code>FacBasic</code> 用来被将来可能编写的各个因子继承；一个 <code>FacData</code> 类，用于利用因子类来生成因子数据。这一部分我目前想法不多，因此仅实现了基本框架，之后有需要再细想好了。</p><p>放假！</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 40：间歇性摆烂</title>
      <link href="/posts/a06d820a/"/>
      <url>/posts/a06d820a/</url>
      
        <content type="html"><![CDATA[<p>上午提交了下载的数据，接下来就等待带教处理数据没啥事可干了。</p><p>下午打算继续开干回测框架，但是不知道为何动力熄火，看见代码就烦，写了二三十行就动不下去了，昏昏沉沉的，摸一会儿键盘就想看手机，真没意思。</p><p>有时候也挺怀疑自己对于这一行的热情是否足够支撑将来的事业，也许有一天会厌烦也说不定。下午想了想，自己天天做基本面数据的处理、按照自己的想法做策略，但是这样的工作方式也许并不具有普适性，如果未来去了别的公司或许也需要重新适应。而从面试的角度来看，数学、机器学习、算法、绿皮书等等方面其实都还挺欠缺的，但是又没有足够的动机去弥补。不知道下一次找实习的时候是否又会四处碰壁。</p><p>明天要好好恢复一下状态，记得周五要请假别忘了。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 39：数据矿工回归</title>
      <link href="/posts/92884c19/"/>
      <url>/posts/92884c19/</url>
      
        <content type="html"><![CDATA[<p>这周打算效率高一点，赶一赶进度，于是今天一直在整理数据，之前大概一周才完成的任务，今天一天就做得七七八八了。下班前，我下载好家用电器、电子、电力设备和交通运输四个行业的基本面数据，明天再整理成标准格式应该就可以提交了。</p><p>由于绝大部分指标都是在一个 PPT 里面找的，为了在下载数百条数据的过程中加快效率，我又写了一个 <a href="https://getquicker.net/">Quicker</a> 动作，将一列指标名称全部复制下来，并且利用用户选择窗口来简化指标名称选择过程，还是挺有意思的。</p><p>除此以外今天就没什么值得写的了，因为基本上都在重复“选择指标 → 搜索指标 → 添加指标 → 下载指标”这一过程，做得头昏脑胀。</p><p>感觉今天都不想健身了，回去骑骑车好了。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 38：绘制有色指数</title>
      <link href="/posts/4d666db2/"/>
      <url>/posts/4d666db2/</url>
      
        <content type="html"><![CDATA[<p>真糟糕，虽然今天在策略研究上主要做的事情是编制有色板块价格指数，但是好像大部分时间没有用在这一方面，而具体做了些啥又想不太起来了。</p><p>有色的研究实际上才开始没多久，我将找到的研报整理好放到印象笔记里带教共享的笔记本中，因为印象笔记自动将 pdf 文件直接展示而不是作为附件直接展示而折腾了一通。整理研究文件夹时，发现上次带教给的数据实在太细碎了，完全没有必要地将数据按交易日拆分为一个个单独的 <code>.csv</code> 文件，一下子多出几十万个小文件和文件夹，导致重命名一下压力都很大。无奈之下又花了好长时间删除不必要的数据，整理起来很费劲。</p><p>下午做了一下有色价格指数的编制，实际上挺简单的，只不过是将此前黑色价格指数编制的遗产重复利用一下。我编制价格指数的时候会采用两种方法，一种是直接对各个品种的价格进行加权，而另一种则是对各个品种的收益率进行加权，再用收益率序列生成价格序列。思来想去，感觉似乎后者更加合理一些，原因有二：一是在直接加权平均价格的情况下，若列入新的期货品种则可能发生指数价格的突变，这很可能导致回测结果不准确；二是回测时往往直接将资金等权来交易各个品种，在这种情况下期货价格的绝对数值实际上是不重要的，重要的只是收益率而已。</p><p>做完了这些，感觉脑袋晕乎乎的，有点困顿，撑着脑袋眯了一小会，又找了找电子书，用作以后阅读。最近想读一读关于全球宏观经济观察分析的书籍，包括美元信用体系或者中国全球化参与什么的，但是没有找到合适的来源，就算有也很少有 <code>.mobi</code> 格式的版本。罢了，周五大家都走得很快，我也先下班好了。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 37：勇闯有色世界</title>
      <link href="/posts/5c37f819/"/>
      <url>/posts/5c37f819/</url>
      
        <content type="html"><![CDATA[<p>上午本来想着最好别一直摸鱼，还是看看研报，结果这么一看就看到了下班。根据带教的说法，我可以仿照黑色的做法来刻画有色金属板块的景气度，然后再将其与黑色板块进行对冲。而就我的理解看来，实际上就是像之前那样把有色板块的择时因子做出来，然后配合黑色板块的择时因子来实现一个仅有两种资产的截面策略。而从带教的语气中，我察觉到做策略的过程不需要太遵守某些特定的规矩，可以比较自由地加入自己的想法。</p><p>于是我便开始上网搜寻资料。根据带教此前提供的一份配置，我将铝（al）、铜（cu）、镍（ni）、锌（zn）、铅（pb）、氧化铝（ao）和锡（sn）作为有色金属板块的组成成分。这其中，除了氧化铝是由铝加工而来以外，其他都由直接开采而来，没有上游材料。而氧化铝本身也只不过是电解铝的上游材料，基本上并非终端生产材料。除了氧化铝与铝以外，各种有色金属之间基本没有严格上下游关系，因此有色板块内部结构相较黑色板块而言更加松散。但从下游需求的角度来看，也并非毫不相干，因为大部分有色金属的行业需求都有所重叠，如电池、新能源汽车、电子产品等行业都会依赖其中的几种材料。</p><p>要想对有色板块的景气度进行建模，恐怕需要利用更加多元的基本面数据，涉及更大范围的行业和上下游关系。此外，似乎不一定要局限于大类行业，也可以从某一类电池、某一种机械产品的基本面资料等方面着手。这些方面能做的工作还有很多。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 36：基本上啥也没干的下午</title>
      <link href="/posts/bf7ac55a/"/>
      <url>/posts/bf7ac55a/</url>
      
        <content type="html"><![CDATA[<p>下午 13:00 准时来到办公室，坐下开始处理昨天 mentor 让我做的任务，也就是将策略整理成因子。这格式一看，好像跟之前舍友展示的因子框架差不多，都是对于每个因子设计一个类，然后在类中完成结构化的数据读取、策略逻辑实现和返回值。不同点可能在于，mentor 给的代码似乎需要直接返回持仓（而不是因子），从这个角度来看，也许 mentor 的这个因子系统没有对大量因子进行组合优化的环节，而是一个因子就对应一个最终的策略。不管怎样，这些框架的思路都给人以灵感。</p><p>下午提交了代码之后收到一个重要的任务：潜入楼上的下午茶区域，为办公室跑腿带回美味的甜点。谁知这次下午茶是交行专门为推销信用卡而准备的，我一上楼就被重重包围，不断被推销员的话术淹没。我逃出重围，拿出盘子开始装甜点，这时又被叫停，原来是嫌我拿得太多了。我晓之以理、动之以情，总算顺利将甜点带回了办公室。吃了两个有青提的糕点，味道还不错。</p><p>完事了继续开干回测框架，目前依然在 <code>Position</code> 类攻坚。由于我给这个类设置了相对灵活的参数，因此对于参数的处理方式变得十分复杂。为了以不同的方式通过输入的因子值来选择多空的品种，我设计了三个模式，包括：</p><ul><li><code>abs</code>：按照因子绝对数值多空</li><li><code>rank</code>：按因子值排序选择前后一定具体排名的品种多空</li><li><code>quantile</code>：按因子值排序选择前后一定比例的品种多空</li></ul><p>而对于每一模式，都可以通过直接输入数值或者文本来输入参数。比如，如果要按因子值排序，选择前 3-5 名的品种做多，后 5-8 名的品种做空，那么就可以输入 <code>&quot;l:3~5_s:5~8&quot;</code> 这样的参数来实现。</p><p>这样的灵活的参数输入方式为合法性检查和参数解析带来比较大的压力，以至于我到目前为止大部分时间仍旧在处理这一件事情，过程相当头大。</p><p>话说回来，虽然 mentor 让我先读一读有色与黑色对冲策略的研报，但是现在还一篇都没读。看来实习工作好像有点懈怠，必须警惕。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 33：成为部门代表</title>
      <link href="/posts/324391ef/"/>
      <url>/posts/324391ef/</url>
      
        <content type="html"><![CDATA[<p>下午三点半来开会了，估计今天的班就这么上完了。听讲座无聊顺便写写日记好了。标题所说的成为代表言过其实，真相是大家都没空所以派遣我来了。</p><p>其实今天没啥好写的，因为做的工作仍然是挖掘有用的基本面数据。昨天下班前的结果是 2023 年仍然有回撤，因此今天挖掘指标的过程主要关注指标在 2023 年的收益表现，当然也不会忽略其他年份的收益稳健性。数据做到现在，感觉能用的指标已经越来越少了，大部分尝试的指标绩效都很一般，但是好歹最后还是找到了一个机车产量的指标，回测的结果显示在 2019 年后每一年都赚钱。机车产量指标分为当月同比和累计同比两项指标，单独回回测表现都不错，但是当月同比数据在合成黑色板块因子之后收益反而下降了，因此最终选择了合成后效果更好的累计同比数据。</p><p><img src="/posts/324391ef/net_worth.png" alt="添加指标后的净值曲线"></p><p>结果还不错！先提交给 mentor 试试看。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 32：缝缝补补</title>
      <link href="/posts/fea25464/"/>
      <url>/posts/fea25464/</url>
      
        <content type="html"><![CDATA[<p>今天的状态并不是很好，没做很多事情。上午 mentor 反馈看一下策略在 2023 年的回撤有什么原因，然后我仔细一瞧发现大部分指标在 2023 年都亏钱，笑死。大部分回撤的指标都没法修复，只是其中一个基本面数据可以作作调整，也确实大幅减小了 2023 年的回撤幅度，但是过拟合的不安又隐隐升起。不过我现在学会拒绝内耗，过拟合就过拟合，反正做出来的图好看😀。</p><p><img src="/posts/fea25464/f72996da-5cbb-4886-8240-5730d2a71db9.png" alt="修复后的净值曲线"></p><p>回到刚才的话题，回撤幅度虽然减小了但毕竟那一年还是亏钱的，于是我主动问问 mentor 要不要再多找找几个基本面数据，看看能不能解决 2023 年收益不好的问题，得到了肯定的回复。明天的活又有了。</p><p>今天还被安排明天顶替正式员工去参加一个安全讲座，果然实习生的杂活虽迟但到✌。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 31：阶段性胜利（大概）</title>
      <link href="/posts/9744b4c5/"/>
      <url>/posts/9744b4c5/</url>
      
        <content type="html"><![CDATA[<p>上午照昨日弄完 hc 之后想了一下，发现其他品种没有办法按照同样的方式来进行。主要原因在于，我只有汽车、机械设备、房地产和建筑材料这四个行业的基本面数据，它们的直接需求是螺纹钢和热轧板卷，而对于铁矿、锰硅等等上有品种仅有间接需求。用行业数据再去一个个拟合上游品种收益，最后再合成黑色板块因子？感觉意义不大。于是我到 hc 为止，直接开始做黑色板块因子筛选。</p><p>公司的回测框架当然没有办法回测黑色板块指数，因为它就没有这一个数据。根据 mentor 的建议，我决定先在本地回测，后续再考虑在公司回测框架上回测的事宜。</p><p>折腾的思路和之前相差无几，因此效率还可以，一整天测试了十来个指标，大部分都没有什么用处。最后好歹选出来了六个指标，样本内回测效果非常好，一到样本外就开始回撤。无奈之下，我又仔细看了看各个指标在样本外的回测结果，毅然再次去除两个效果不好的指标，最终的结果终于算是能看了。</p><p><img src="/posts/9744b4c5/38763294-0601-47ed-a419-e2210a87bfad.png" alt="全样本回测结果"></p><p>提交给 mentor，并指出这个因子用的数据指标有点少。看不出来她的情绪，只是说数据少不是关键，只要有逻辑就行，另外把研究过程写成笔记发给她。于是我哼哧哼哧开始写笔记，晚上回家总算是写完了。</p><p>明天看看 mentor 什么反应，希望这能够算是一个成果。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 30：节奏加快</title>
      <link href="/posts/a6df465f/"/>
      <url>/posts/a6df465f/</url>
      
        <content type="html"><![CDATA[<p>今天不顺。中午 mentor 找我吃饭谈话，指出我进度太慢了，而且思路可能不对，折腾半天没能出活。不过我之前确实思路很不清晰，现在稍微有一些思路但是也不能确定到底有没有用。在量化实习这一方面，我似乎还没有得到什么正反馈，对于手头的工作能不能作出成果没有信心。</p><p>下午抓紧时间弄了弄黑色板块整体的择时，发现做不出来。于是还是先从 hc 着手，看看能不能先把一个个品种的择时实现，过程虽然好一点，但是同样困难重重。Mentor 说夏普为 1 就够了，这件事情本身就挺让我纠结的。说实话，直接一直持有夏普估计就超过 1 了，但是我无疑换手率不能太低。也许不需要很高的超额，只需要赚钱就行了？毕竟回测系统给的这个数据基本都没有啥趋势的变化，要做丰富的历史回测真的有点困难。</p><p>Mentor 还让我有问题勤提问，这一点我也总是感觉问不出口，一部分原因是思路本身都没理清楚，根本不知道先问哪一个比较好 😓。总之下午焦头烂额，状态很糟糕。</p><p>明天应当降低一下期待，管它曲线丝不丝滑，夏普高就行。记得多跟 mentor 反馈。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 29：慢工出细活</title>
      <link href="/posts/f67833d2/"/>
      <url>/posts/f67833d2/</url>
      
        <content type="html"><![CDATA[<p>上午继续昨天的工作，又跟那个数据指标死磕了一会，<a href="https://en.wikipedia.org/wiki/Moving_average#:~:text=smoothing%20the%20data.-,Simple%20moving%20average,-%5Bedit%5D">简单移动平均线（SMA）</a>对最近的极端趋势反映能力较弱，因此我将其替换成了<a href="https://en.wikipedia.org/wiki/Moving_average#:~:text=average%20which%20follows.-,Exponential%20moving%20average,-%5Bedit%5D">指数移动平均线（EMA）</a>，再取一次时序滚动排序值，以此作为最终的因子。测试了一下，效果不算很好；替换了几组不同的参数，发现收益对参数比较敏感。于是，我以 5 为步长，对 EMA 的 $\alpha$ 和时序滚动排序值的窗口参数网格寻优，发现收益较好的参数大致集中在某一个区域，于是我取这块区域中心位置，作为最终的参数。查看了一下这组参数下的净值曲线，确实还算不错。出于谨慎，我直接测试了这组参数在测试集中的表现，好像真的还可以！这意味着，这样的挖掘方式应该是能够出活的。</p><p><img src="/posts/f67833d2/tmp3209.png" alt="我最终选择的参数组合是 (25, 60)"></p><p><img src="/posts/f67833d2/bd74661d-6433-4394-b7da-779e1f53fb71.png" alt="样本内回测净值"></p><p>今天接下来的时间，我又测试了另外两个基本面数据。数据的处理方式各有差异，但是挖掘方式基本相同——盯数据，找规律，并尝试对数据进行处理来反映这一规律，最后再参数寻优。</p><p>事实上，由于基本面数据样本量较少，参数太多存在很高的过拟合风险。因此，在模型只有两个参数的情况下，若效果好的参数集中在某一范围之内，才能有勇气去尝试这样的参数组合。</p><p>到目前为止，我所处理的都是需求数据。需求当然是价格的重要作用因素，但如果仅考虑需求则难免偏颇。根据我的理解，最基础的价格形成因素就是需求和供给，因此至少还需要考虑供给因素。当然，政策、预期、突发事件、情绪也是重要的因素，但我目前的想法是先把需求和供给，或者供给与需求之差给做好。</p><p>时至周五，周末的氛围已经洋溢在办公室的空间。恰逢季度生日会，办公室的同事们都没有心思工作了，我也收到怂恿去现场蹭吃蹭喝。房间的甜点琳琅满目，还有参加飞叠杯游戏赢奖品的环节，但是我还是决定以食物为主。吃了点水果、蛋糕和肯德基的鸡翅，味道都还不错，心满意足地带上书包下班，白嫖的感觉真好。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 28：果然不对劲</title>
      <link href="/posts/848778d/"/>
      <url>/posts/848778d/</url>
      
        <content type="html"><![CDATA[<p>果然不对劲，空头的持仓就应该是负数不是正数。这个回测框架要求 <code>nShortRatio</code> 必须是正数，否则不会做空。也就是说我昨天的回测结果是错的，这个策略真实性能不行。此外，<code>weight</code> 参数不能设置成 <code>False</code> 也是一个 bug，跟我的数据没关系。跟负责这个回测框架的同事掰扯半天，他终于认真去改框架了。</p><p>一想到接下来还是必须使用这个回测框架就令人抓耳挠腮。</p><p>既然策略不行就继续改。下午苦思冥想，决定还是应该对基本面数据精挑细选，作精细化的处理。我决定先对螺纹钢下手，因为它的下游需求很明确，基本就是房地产和基础建设。接着查看它所对应的基本面数据，我选出了“100大中城市地产交易规划建筑面积”这一指标，因为它看上去和螺纹钢的需求最直接相关。</p><p>仔细检查了一下数据，这是一个周频数据，波动很剧烈，但是周期变化比较明确。因此，我先对其计算 50 日移动平均线以平滑化处理，再计算同比数据，来作为最终的因子。</p><p>回测了一下（还是自己的回测框架好用啊！），虽然总体收益是正的，而且 2020 年后也有正收益，但是整体波动很剧烈，应该不太行。再瞧一瞧数据，感觉这个指标和螺纹钢的合约价格确实没有特别强的相关性。明天如果还是想不到办法，也许就应该淘汰掉，再继续尝试下一个。</p><p>Mentor 叫我多看看研报和书籍，明天也一并找找看好了。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>阅读笔记丨《海边的卡夫卡》——少年乌鸦的奇幻漂流</title>
      <link href="/posts/b8cc98c5/"/>
      <url>/posts/b8cc98c5/</url>
      
        <content type="html"><![CDATA[<p><img src="/posts/b8cc98c5/s33607563.jpg" alt="海边的卡夫卡"></p><p>故事的开头就像只是普通写实的小说，除了“叫乌鸦的少年”令人联想到多重人格以外，似乎就是一本普通的少年离家出走的故事。而野游的孩童们集体晕倒又失去记忆，也似乎会在后文给出什么科学的解释。</p><p>然而故事情节自第 15 章左右后开始了逐渐离谱的展开。收集猫的灵魂来制作笛子的神秘人、从天而降的竹䇲鱼和蚂蟥、拉皮条的肯德基老爷爷、性别模糊的大岛、无法逃离的预言式诅咒……场景愈加光怪陆离，作者仿佛在对读者说：如果你要用脑子来读这本书，那你就错了。</p><p>事实上，想象力相比于逻辑性更适用于这篇小说的阅读。村上春树的描写功底十分了得，情节中的场景氛围一直在发生变化。许多画面让人不禁联想：如果这一幕被拍成电影会是什么样子。尤其是在卡夫卡不顾一切朝深林迈去的一章里，幽暗危险的丛林与赤手空拳的十五岁少年之间形成鲜明张力，回忆和杂念汹涌铺陈开来，仿佛影片中的蒙太奇和闪回手法。作者在这一部分完全以意识流的方式写作，浓烈的个人情绪得到淋漓尽致的展现。</p><p>也许这就是日本对于灵异鬼怪的理解：超出逻辑的事情不一定意味着恐怖和惊悚，也可以只是对现实逻辑的一点点改动，比如能够与猫对话的老人，亦或是从天而降的鱼蛭。这样的灵异发生在每一个人身上，渗透进社会里、生活里，成为情节展开的底色。</p><p>故事里涉及的人物很多，而几乎每一个都有着不同寻常的人生际遇。相同点是，每个人都在寻求自身的圆满，或是等待补偿过去人生的缺口。小说的结尾，星野君成为了下一个中田，而卡夫卡回到了东京开始上学，看似仅仅是回到开头，但是每个人都重新找到了人生的目的。</p><p>一些喜欢的语句：</p><blockquote><p>那里有一切，但没有部分。没有部分，也就没必要将什么和什么换来换去。无须卸掉或安上什么。不必冥思苦索，委身于一切即可。对中田来说，那是比什么都值得庆幸的。</p></blockquote><blockquote><p>一切都是想像力的问题。我们的责任从想像力中开始。叶芝写道：In dreams begin the responsibilities。诚哉斯言。反言之，没有想像力，责任也就无从产生，或许。</p></blockquote><blockquote><p>田村卡夫卡君，我们的人生有个至此再后退不得的临界点，另外虽然情况十分少见，但至此再前进不得的点也是有的。那个点到来的时候，好也罢坏也罢，我们都只能默默接受。我们便是这样活着。</p></blockquote><blockquote><p>缺乏想像力的狭隘、苛刻、自以为是的命题、空洞的术语、被篡夺的理想、僵化的思想体系——对我来说，真正可怕是这些东西。我从心底畏惧和憎恶这些东西。何为正确何为不正确——这当然是十分重要的问题。但这种个别判断失误，在很多情况下事后不是不可以纠正。只要有主动承认错误的勇气，一般都可以挽回。然而缺乏想像力的狭隘和苛刻却同寄生虫无异，它们改变赖以寄生的主体、改变自身形状而无限繁衍下去。这里没有获救希望。作为我，不愿意让那类东西进入这里。</p></blockquote><blockquote><p>不是人选择命运，而是命运选择人。这是希腊悲剧根本的世界观。这种悲剧性——亚里士多德是这样下的定义——令人哭笑不得的是，与其说是起因于当事者的缺点，毋宁说是以其优点为杠杆产生的。我的意思你可明白？人不是因其缺点、而是因其优点而被拖入更大的悲剧之中的。索福克勒斯的《俄狄浦斯王》即是显例。俄狄浦斯王不是因其怠惰和愚钝、而恰恰是因其勇敢和正直才给他带来了悲剧。</p></blockquote><blockquote><p>“记住，哪里也不存在旨在结束战争的战争。”叫乌鸦的少年说，“战争在战争本身中成长，它吮吸因暴力而流出的血、咬噬因暴力而受伤的肉发育长大。战争是一种完完全全的活物。这点你必须了解。”</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 赏阅纪 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 阅读笔记 </tag>
            
            <tag> 海边的卡夫卡 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 27：公司的回测框架令人自闭</title>
      <link href="/posts/26e2d3bf/"/>
      <url>/posts/26e2d3bf/</url>
      
        <content type="html"><![CDATA[<p>被迫使用公司的回测框架之后，折腾却一点没少。这个回测框架结构混乱，却又没有文档，其中有一两个组件还是 <code>.pyd</code> 文件，debug 都 de 不进去，完全是个黑箱。</p><p>因此，今天的一整天，我都在对这个回测框架进行代码适配。好不容易跑通了，并且对于好几个品种进行了回测，得到了很棒的效果，结果下班前一看持仓，发现全都是正的。但是按照我的因子生成的持仓怎么可能全是正的？</p><p>明天再检查下好了。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 回测框架 </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>开发日志丨关于回测框架搭建的一些进展，以及接下来的想法</title>
      <link href="/posts/a72ac82e/"/>
      <url>/posts/a72ac82e/</url>
      
        <content type="html"><![CDATA[<p>工作需要，决定自己从头搭建一个系统的回测框架。开发至今，先暂停一会，思考下这个回测框架应该如何编写。</p><p>目前开发完全使用 Python 语言，已经完成了<code>StratPerf</code> 类和 <code>NetWorthMaker</code> 类，分别可以对净值序列生成绩效数据和对持仓数据生成净值。接下来，应该就是要对因子数据生成持仓。</p><p>由于量化策略的复杂性，一个显而易见的问题是，这些类是否能用于不同类型的策略？</p><p>目前根据我的观察，策略主要分为三类：择时策略、截面策略和规则型策略。当然，可能还有什么无法归结到这三个类别的策略。这套框架开发应当尽可能适用于这三类策略。首先，<code>StratPerf</code> 没有问题，因为这个最少只需要输入一个净值数据，而这一点对于所有策略是通用的；<code>NetWorthMaker</code> 应当也没有问题，因为这个类通过持仓生成净值，而任何策略当然都可以生成一个持仓表。</p><p>那么可能存在问题的环节就是生成持仓的类的编写了。首先讨论，一个类是否能够统一择时和截面因子？一般而言，我们参考截面因子来做多因子值偏高的品种，做空因子值偏低的品种；而对于择时因子，我们做多因子值为正的品种，做空因子值为负的品种。当然，我们也完全可能做一些变化，比如对于截面因子，我们也可以做多因子值为正的品种，做空因子值为负的品种；而对于择时因子，当然没有截面的相对大小可以比较，但是我们也可以控制当因子值大于某个非零值时做多，小于某个非零值时做空……</p><p>这样的问题可以通过增加一个参数解决，比如，可以在 <code>__init__()</code> 函数中增加一个 <code>mode</code> 参数，用于指定是根据相对值来多空还是根据绝对值来多空。而对于这两种模式，我们又可以设计更多的参数，比如是否只多不空，亦或只空不多；再如截面多空是选择几只品种还是选择排名前后多少占比的品种？如果是根据绝对值来多空，那么多和空的阈值又是多少？我在考虑用一串字符串来表示以上提到的所有参数。比如根据相对值来持仓、分别多空前后 10%-30% 的品种，就可以表示为<code>r_l:10%-30%_s:70%-90%</code>。嗯，看上去不错。</p><p>假设上面这个方法可以兼容择时和截面因子，那么如何兼容规则型策略呢？规则策略一般意味着达到某些条件就触发买入或者卖出的信号，看上去似乎和因子型策略形式大为不同，然而实际上，任何规则型策略都可以转换成因子型策略，只需将买卖信号作为因子，然后用绝对数值来生成持仓就可以了。基于这个思路，我们只需要在程序中根据我们的规则型策略生成买卖信号表，那么同样可以利用上述的类来生成持仓，剩下的流程就和普通因子型策略一样了。</p><p>当然，这样的方式也许有点为难使用者，因此也可以考虑再写一个类，用来根据规则来生成买卖信号。设想这个类可以接受一系列数据和一个函数，这个函数则可以根据这些数据来生成买卖信号。那么，这个类应当可以根据这个函数和这些数据来生成信号表或者因子表，不过这是后话。</p><p>除了上述考虑以外，受到舍友的启发，对于因子型的策略（其实规则型策略也一样），完全可以开发出一个标准化的开发流程，将因子编写集中到一个小小的函数中，然后利用整个系统来对这个因子进行测试、结合进入因子库。具体来说，可以实现一个人因子基类，然后令所有因子先继承这个类、指定需要读取的数据、根据数据给出生成因子值的逻辑。这样，策略的研究就可以大体上回归到对一个个因子本身的研究。也许大多数因子工厂就是这样的模式。</p><p>以上就是我目前对于回测框架的想法。</p>]]></content>
      
      
      <categories>
          
          <category> Coding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 回测框架 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 26：尝试拨茧抽丝</title>
      <link href="/posts/a140e57c/"/>
      <url>/posts/a140e57c/</url>
      
        <content type="html"><![CDATA[<p>上午将周报提交到印象笔记之后，mentor 提出了很多意见，可能是因为对于进度稍有点急。mentor 说，如果数据挖掘的方式很难出活的话也可以考虑手搓因子或者复现一些研报，因此这些将成为我接下来的主线。</p><p>于是我决定先整理一下思路。由于之前研究的时候整理的习惯不好，文件一多就十分混乱，因此我重新整理了一遍文件（但是感觉之后还会变乱）。接着，我编写了一个小脚本，用来快速记录工作过程，存储在一个 <code>.log</code> 文件里。</p><p>下午，我按照 mentor 的建议，将择时因子转换成截面因子，并输入到公司的回测框架里面回测，谁知回测结果中，2018 年 6 月 28 日之后的净值全都是 <code>nan</code>，终端打印的 日志也表明存在问题。于是一个下午就在定位问题的尝试中过去了。咨询了一下同事，是 FU 这一品种的问题。由于 FU 在 2018 年挂牌闭市了，因此此后便不能再交易。但是我似乎没有尝试交易 FU？</p><p>……</p><p>想得脑袋疼。先下班，明天再说。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 24：道阻且长</title>
      <link href="/posts/322f621b/"/>
      <url>/posts/322f621b/</url>
      
        <content type="html"><![CDATA[<p>今天回到宿舍才想起来日记没写，简单写一写吧。</p><p>由于最近实际上在埋头开发回测框架，因此和 mentor 都没有什么交流，而实际上我这边在策略研发上也没有什么进度，正好不想被知道这一点。关于策略，我现在的想法主要有两点：一是把数据再做细一点，比如全部做成当月同比或累计同比这种数据；二是根据数据来做因子的方式上，可以采用数值在过去一年中的分位数的方法来尝试，看看能不能有什么效果。</p><p>上午大致完成了 <code>StratPerf</code> 类的编写，跑出来还是挺赏心悦目的。顺便又写了一个绘图的函数，看上去像点样子。下午开始写 <code>NetWorthMaker</code> 类，用于根据持仓数据和价格数据来生成净值数据。这就是今天的工作内容。</p><p>晚上老板在群里放出炸弹：</p><blockquote><p>开盘忙着调仓，刚得空，我简单说下重点。确实，今晚开盘第一件事就是买PVC，我下午复盘看了一圈，这个是最确定的，持仓量巨大，然后现货库存高，产业觉得库存高，于是不服，疯狂做空并注册仓单，但是其实仔细看，价格在底部，周线看刚启动而已～这个和当时7000以下的锰硅简直如出一辙，今年都是这个套路干的～而且也是盘面升水，现在还不到6月，基差这个时候是不重要的～并不是每个做空的都有足够的现货和资金去补保证金，最后大部分空头除了砍掉之外，没有其他选择～那么多头的逻辑是什么呢？供应的减少，检修，甚至部分化工企业因财务造假后续面临停产，产业长期低利润带来的影响就是供应出了大问题，然后需求端，又有边际转好预期。即使几个月内需求没有快速转好，在这种价格多头哪怕直接全部接货，也亏不了多少钱，拿着货下半年慢慢出，只要需求边际是变好的，一样有的赚。PVC，极有可能是下一个锰硅～😀</p></blockquote><p>反复研读、刻烟吸肺、立即加仓。能跟这个老板学到的还有很多。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 23：不破不立</title>
      <link href="/posts/14656626/"/>
      <url>/posts/14656626/</url>
      
        <content type="html"><![CDATA[<p>昨晚我写的数据库写入函数被提出了一些新要求，因此我整个上午和下午的前半段都在重新编写这个数据库写入函数。过程还是挺顺利的，也学到了一些用 Python 的 <a href="https://www.sqlalchemy.org/">SQLAlchemy</a> 来读写数据库的方法。或许以后我也可以将数据保存在 <a href="https://www.sqlite.org/">SQLite</a> 中，并且用 Python 来读写，避免数据量太大而混乱的问题。</p><p>完成这个工作之后，我再次对着此前的回测结果陷入了沉思，并意识到我仍然没有非常清晰的想法。更重要的是，我一看到回测结果就感到心烦意乱。</p><p>最终，我决定开始自行开发一个回测框架。</p><p>我的初步想法很简单。由于量化策略往往五花八门，没有统一标准，因此这个回测框架应该尽可能输入结构工整易处理的数据，也就是标的持仓和价格数据。有了这两样数据，回测并生成一个净值序列应当不会很麻烦。而在此基础上，我打算实现一个 <code>Performance</code> 类，用以根据输入的净值和持仓数据来返回策略的绩效。这个绩效应当包含每一年的回测指标，如天数、胜率、收益率等等。此外，应该还要有一个 <code>.py</code> 文件，用来存放各种回测能够使用的计算函数。从工程角度考虑，也许这次我应该使用 git 来作版本控制。</p><p>当然，这些想法也许会随着开发过程的推进而发生变化。目前，我正在编写 <code>Performance</code> 类，希望能够早点实现出来。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 22：如何提升策略性能？</title>
      <link href="/posts/a9664f0/"/>
      <url>/posts/a9664f0/</url>
      
        <content type="html"><![CDATA[<p>上午和老板开了个小会。老板提到了各个行业可以考虑的数据来源和基本面分析方向，还是有不少收获的。也许我最终筛选出来的因子有点太多，而且过于集中在少数的角度。比如，一个品种的基本面景气度本质上就是由供给和需求来决定，那么不妨将因子分成供给和需求两个方面，而需求又可以归纳为库存和下游产业对于品种的需求。通过这样的方式将基本面的分析分解为几个部分，且每个部分精选最重要的几个因子，也许就会有更好的效果。</p><p>其实现在策略开发中最令我头疼的环节就是回测。诚如 mentor 所言，不同的回测框架在细节的处理上有所不同，因此所返回的结果也会有所不同。可能正是因为这个原因，在我这里表现很差的因子在 mentor 的框架里却跑出了相对稳健的收益。而目前为止所有择时策略都没法在公司的回测系统当中使用，这使得标准实际上无法统一。而我手里又没有现成好用的回测框架，因此只能一遍又一遍地修改回测函数，试图将结果调整得与 mentor 的更像一点。我想这真的是挺大的一个问题，需要花费时间去解决。</p><p>下班前冷静下来仔细观察了一下因子，意识到我的回测生成持仓逻辑似乎是有问题的。按照我的逻辑，对于这些月频数据，只要数值大于上一期就做多，小于上一期就做空；而按照 mentor 的逻辑，只要标准化后的数值大于 0 就做多，小于0 就做空。无论是哪一个，我想都并不完善：</p><ul><li>我的方法：换手率相对较高，但是由于仅评价临近的两月数值差异，可能过于敏感——这些因子可能在反映大趋势上的能力大于反映短期波动的能力。</li><li>mentor 的方法：不能真正响应趋势或者短期波动，仅能反映当前因子值在全区间内的相对位置（而且实际上使用了未来数据）。另一个问题是，这样的方法可能带来非常低的换手率。</li></ul><p>为了折中这两种方法，我考虑尝试此前实习所使用的方法，即观察当前数值与过去一段时间内（比如一年）的平均值相对大小，用来作为当前的因子值。</p><p>我想，除了这一点以外，也许还有很多细节需要留意，比如当月值可以处理成当月同比和累计同比、如何筛选有效的基本面数据等等。真是路漫漫其修远兮。</p><p>今天的状态挺一般的，注意力很难集中，也有点烦躁，看着上周写的代码不知道改如何修改。也许还不如摈弃此前的代码，重新写一份，不然越看越恼火。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 20：心情像坐过山车</title>
      <link href="/posts/581f79aa/"/>
      <url>/posts/581f79aa/</url>
      
        <content type="html"><![CDATA[<p>上午简单合成了一下因子，方法是简单的标准化后等权平均，结果回测结果好得不得了，每个品种的收益曲线都昂首冲上天，超额收益率高得吓人。我当然知道这样的收益率不太现实，因此还是忍不住先按照品种回测了一下全样本数据，结果果然浇了我一盆冷水。</p><p>只见收益曲线以训练集和测试集的分界为中心，仿佛一座险峭的巨峰，左侧直上云霄，右侧则直挺挺坠落山崖，几年之内巨额收益一口气全亏完。忙活一上午就这，到午饭的时候心情有点自闭。于是跟 mentor 汇报了一下，下午花时间写了一份策略文档，把过程中产生的数据文件都提交了一下。</p><p>于是 mentor 拿我的数据用自己的回测框架一跑，发现收益很稳健，赚了不少钱呐。为啥两个人的回测结果相差那么大？原来是因为 mentor 回测的时候用的是 <code>open</code> 数据而不是 <code>open777</code> 数据。</p><p>我再次尝试拿新的数据回测，发现结果没有什么变化，该亏的还是亏。所以问题出在哪？我没有头绪。或许是因为回测函数有什么错误，也有可能与回测逻辑的差异有关。但不管怎么样，下班前是解决不了这个问题了。</p><p>五点前，大老板又问了问进度，稍微 push 了一下 mentor，说下周一或周二开个小会，让我也有点慌张。毕竟，现在的成果从我的视角来看和什么都没做出来差不太多。问了问 mentor 咋整，她说如实汇报就行。</p><p>😵。</p><p>下班后还接到一个电话，正式对接数据库更新的工作任务。看来要做的事情还不少。</p><p>就这样吧。下周再见。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 19：几无进展的上午</title>
      <link href="/posts/1e1130fb/"/>
      <url>/posts/1e1130fb/</url>
      
        <content type="html"><![CDATA[<p>由于下午有一门期末考试，今天再次只坐了半天工位就走了。上午好像除了划分测试集重新测了一遍因子以外啥都没干。</p><p>回想起来好像常常这样，虽然上班时偶尔也会摸鱼，毕竟大部分时间还是在认真工作。然而下班时盘算一下好像基本上没做些什么，不禁怀疑自己效率原来这么低么？再仔细回想一下，似乎是在一些小细节方面耗费了不少时间。这些细节可能是一个程序 bug、一段代码的优化、一段逻辑的调整，和我的任务目标没有直接关系，但是不解决就无法推进。</p><p>我开始一段实习前往往会产生一些微小的恐惧，因为自己的时间不再自由了。当你是一名大学生，尽管要上课，但是一天中的大部分时间仍然是自己支配的，何况实践上很多课不上也没什么大碍；而如果开始上班，过上朝九晚五的日子，那么这相当于着你的生活路线被固定了，你失去了生活中大部分的上午和下午，以自己无法控制的方式。</p><p>在这个岗位上做了一段时间，我发现，尽管五点的下班时间不算太晚，但是经过一个半小时的通勤后，回到学校时往往已近天黑。这意味着我基本上失去了日间，仅剩下了夜晚和少量的清晨。但是日间难道不是生活所必需的组成部分么？</p><p>我对待这样工作时间的态度是矛盾的。我嫌时间太长，以至于我直到夜晚才能开始一天的生活；我又嫌它太短，使我的工作进展每天仅能推进一点点。说到底，一天的 24 小时何其短暂。</p><p>下午回到学校，做完了这学期最后一张试卷，写的乱七八糟，但是无所谓，又结束了一个学期。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 18：大道至简</title>
      <link href="/posts/a0252c1e/"/>
      <url>/posts/a0252c1e/</url>
      
        <content type="html"><![CDATA[<p>今天效率不高，上午又修补了一下回测函数，让它可以仅更改一个参数就分别输出多头、空头和多空的回测净值。由于回测跑得很慢，尝试使用 <a href="https://openai.com/index/hello-gpt-4o/">GPT-4o</a> 修改一下函数，让它跑得更快。哪知这个模型信心满满地分析了一大通，“使用 Numpy 运算”“矢量化运算”云云，结果给出来的函数跑完结果差了十万八千里。遂放弃，耐心等待 10000 多条回测任务结束。</p><p>紧接着，尝试分析一下回测结果，发现少数因子效果好得超出意料，个别能达到下图这样的高收益。难道仅仅是罗列一大堆数据然后挨个回测就真的能找到好的因子？</p><p><img src="/posts/a0252c1e/image-20240515172523881.png" alt="某因子回测收益曲线"></p><p>下一步的计划是合成因子，然而对于这一件事情还没有什么思路，于是下班前找 mentor 交流了一下，得到了一些点拨。明天再尝试尝试。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 17：回测初见成效</title>
      <link href="/posts/6b47bfb9/"/>
      <url>/posts/6b47bfb9/</url>
      
        <content type="html"><![CDATA[<p>今天有点着急回学校考试，差点把写日记的事儿忘了。</p><p>其实今天没有太多值得记录的。现在的实习工作似乎进入一种更加连续的状态：用更长的时间来做同一件事情，而不是常常在不同的任务之间切换。</p><p>上午调整了一下回测代码再跑了一次，发现有些回测结果竟然无法计算年化收益率。仔细一看，发现某些行情数据不对劲，其间有数据缺失。反馈给 mentor 后，收到再次回到此前所用的 <code>open777</code> 数据的指示。于是又折腾了一通，根据换源后的数据适配了一下，又回测了一次。</p><p>应该说这一次回测的结果还行，找到了一些效果很好而又比较有说服力的指标，比如“乘用车出口金额”“二手房挂牌价”等等。明天可以继续分析一下，看看能不能整理一些有效的数据作为因子，来构建策略。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 16：无头苍蝇</title>
      <link href="/posts/ce533368/"/>
      <url>/posts/ce533368/</url>
      
        <content type="html"><![CDATA[<p>接着上周的工作，我继续尝试寻找有用的因子。但是和上周一样，想不出来有什么办法可以用下游行业基本面数据来预测上游期货品种的价格。</p><p>中午跟 mentor 吃饭的时候提出了这个问题，她表示我不用想太多，可以直接先用下游行业基本面数据来回测期货（指数）价格，来寻找比较有效的因子；后续也可以读读其他的量化研报，来用更复杂的方式来寻找因子。</p><p>于是，我打算直接将所有期货品种和所有基本面数据之间做一次回测，并将回测结果全部保存下来。整个下午，我就在做这件事情。</p><p>这篇日记写到一半，几千条记录终于跑完了。一看结果，有些单因子的表现好得出奇，但是一看这些因子叫啥名字，发现实际上非常可疑……明天再核对核对。</p><p>刚刚突然想起来上周的周报没写，服了。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 15：终于开始做因子了（吗？）</title>
      <link href="/posts/8b872ce1/"/>
      <url>/posts/8b872ce1/</url>
      
        <content type="html"><![CDATA[<p>今天感冒还是有点头晕，不想说太多了。</p><p>上午一到公司，mentor 跟我说可以先用我之前整理的数据做一些因子，大致介绍了一下我的因子要整理成什么格式就让我走了。</p><p>这是我一直所期待的，但是真正到来时却不知如何下手了。拿这些指标怎么合成因子？是先读读相关研报找找灵感吗？还是先把各个指标都回测一下看看？要不要先算一算 IC 或者 IR 等指标？每个因子的频率、发布时间都不同，是不是要先作统一处理？这么多方法要不要封装起来？用公司的回测系统吗？那个系统似乎并不好用。那要不要自己开发一个因子评价系统？该如何架构？我还没有自己写过这样一个复杂的模块……一整天就在擤鼻涕和理不清的思路中这样过去了。</p><p>下班前，好歹对因子评价系统稍微开了个头。这时 mentor 又问我：“你会不会 SQL？”于是在懵逼中，我似乎又被赋予了和另一个同事对接数据库搭建的任务，尽管目前还不知道要做些啥。</p><p>接近五点半，我成为了除了老板之外最后一个离开办公室的人。希望明天的状态能够好一点。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 14：满头大汗的社死现场</title>
      <link href="/posts/2f29d78c/"/>
      <url>/posts/2f29d78c/</url>
      
        <content type="html"><![CDATA[<p>由于此前已经请好了假，今天仅上了半天班就走了。上午的主要工作是利用新的数据重新生成两份商品价格指数。这一次使用收益率和价格分别生成的价格指数居然比较相近，和昨天的情况完全不同。下班时一张指数图片发给 mentor，就踏上了回学校的 11 号线。</p><p>下午回学校上课。其实这门课我平时是不上的，之所以今天请假半天来教室，有两个原因：第一，今天要展示小组大作业，必须要有一个人在现场；第二，我们小组只有我一个人在深圳……于是这个展示的重任就撂到了我的肩上。</p><p>其实我本来没啥所谓的，因为只不过是将 PPT 过一遍，但是上课之后才发现没有这么简单。老师特意请来了两个业界嘉宾，其中一个戴着黑框眼镜，一双挑剔的眼睛紧紧盯着 PPT，时不时还要在纸上写点什么。</p><p>我感到大事不妙。</p><p>果然，前面的每个小组展示结束后，他都要清清嗓子开始提问，角度之犀利，基本上是判断你没有做这方面的工作才问的。我抓紧时间在小组群里问了问一些细节，企图抱佛脚，但是深知这一个我完全没有参与过的作业，很多细节我一问就倒。</p><p>轮到我时，我保持冷静，清楚地将材料过了一遍。紧接着，这位嘉宾手肘撑在桌子上，开始问我：“你这个策略换手率大概多少？”</p><p>我不知道。我压根没看到这个数字。我在讲台上翻了翻幻灯片，发现没有哪张图标注了换手率数据。于是我只好顾左右而言它，说我们这个策略考虑在组合优化的时候加入换手率限制云云。</p><p>于是他推了推眼镜，又问了几个问题，基本都问在要害。还好我心理素质过硬，基本上都面不改色胡说八道。但走下讲台的时候，还是能明显感觉到额头在冒汗。</p><p>其实我能察觉到他对我们这一组的工作是比较认可的，因为他接下来演讲时不时 cue 一下我们组的策略，说这是一个基本标准的业界产品开发流程。但是不得不承认，这几乎不是我的功劳。</p><p>也许叙述得有点夸张，因为我实际上没怎么紧张，早已做好了胡言乱语的准备。无论如何，经此一日，还是了结了麻烦事一件。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 13：令人一头雾水的商品指数</title>
      <link href="/posts/558ce3d2/"/>
      <url>/posts/558ce3d2/</url>
      
        <content type="html"><![CDATA[<p>Mentor 似乎下班了，来写写日记吧。</p><p>今天做的工作令人十分头大，主要是延续昨天的工作，编制一份黑色板块商品价格指数。</p><p>国际主要商品指数权重确定依据主要有四种：</p><ul><li><p>等权重</p></li><li><p>依据主要经济指标设置权重</p></li><li><p>依据市场流动性指标设置权重</p></li><li><p>依据主要经济指标和市场流动性指标共同设置综合权重。</p></li></ul><p>其中流动性指标包括成交量、持仓量等。</p><p>我这里一时半会没法利用足够好的经济指标，因此仅能使用流动性指标；而根据 mentor 的要求，我又考虑了品种的短期波动率，也将其纳入权重计算当中。</p><p>数据处理什么的都很常规，除了偶尔数据会出一点问题以外。计算了两个指标分别的权重之后，我对两个权重进行了合成和多样化处理。</p><p>到了最后的指数计算一步，我却遇到了点麻烦。主要纠结的环节在于，究竟用权重来直接加权平均各品种的价格，还是用权重对收益率进行加权平均，再利用平均收益率来生成价格指数。</p><p>在 mentor 的建议下，我两种方法都尝试了，结果如下图中黄色曲线所示。</p><p><img src="/posts/558ce3d2/04a384b24c45e5d224dad5d34d9bb5f.png" alt="对价格直接加权的价格指数"></p><p><img src="/posts/558ce3d2/876f0f1af38cf8e1a45a88083af4ee3.png" alt="对收益率加权并生成的价格指数"></p><p>从结果来看，两种方法在大部分时期的趋势大体相同，但是在个别品种（尤其是价格较高的品种）出现大幅波动时，两条曲线的走势会出现很大的差异。究其原因，我认为，当直接对价格进行加权时，“价格”实际上也成为了第三个权重指标，会很大程度上影响指数的权重构成。</p><p>还有另一个发现。如果将短期品种收益波动作为一个重要的权重，那么指数也会产生剧烈的短期波动。这是因为品种的收益波动常常发生大幅变化，从而在短期内反复影响其所生成的权重结构。对于这一问题，可以考虑将收益波动计算窗口延长或者降低这一指标的权重等方法，但是有一个问题是始终无法解决的，那就是权重的调整频率问题。为了做这一课题，我阅读了几份指数编制细则和研究，这些指数的权重调整频率往往很低，比如每年仅调整一次，这样的思路与我做指数的思路差异很大。</p><p>明天打算用新的数据再做一下这个过程，看看是否能优化其中一些部分。至于这个课题最终走向什么方向，恐怕只有 mentor 知道了。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 12：节后综合征</title>
      <link href="/posts/59427cf3/"/>
      <url>/posts/59427cf3/</url>
      
        <content type="html"><![CDATA[<p>节后第一天上班，上午出门时想起来忘记买早餐，于是匆匆扫了个自动售货机，随便吃了点肉松面包。学校虽然开了往返大运的校巴，但是由于发车间隔长达半小时，而我出发的时间刚好卡在两次发车之间，因此也只能望洋兴叹，最后照常打车去坳背了。</p><p>上午处理了一些此前没有完成的工作内容，比如给 mentor 提交一份工作周报、修改一下此前提交的数据、下载新的数据集等等。下午开始集中精力处理一个新的任务：编制一份黑色板块商品指数。</p><p>之所以要自己写这么一个指数，与目前的策略方向有关。我当前负责的部分是商品基本面分析，后续可能从基本面的角度对品种或者板块开发轮动策略。那么，就有必要编制一个板块指数，用来作为回测和购买的对象。而之所以要自己编制而不是直接使用<a href="https://www.nanhua.net/nhzc/varietytrend.html">南华期货指数</a>，是因为这一指数仅有收盘价的日频指数，而我们更可能用开盘价来作为回测和交易的价格。</p><p>为了完成这一任务，我直接参考了南华期货的<a href="https://www.nanhua.net/cmsbigfile/2022/11/76b2ec32-618d-44b7-89a4-97d22ed2f3c1/%E5%8D%97%E5%8D%8E%E5%95%86%E5%93%81%E6%8C%87%E6%95%B0%E7%BC%96%E5%88%B6%E7%BB%86%E5%88%99%EF%BC%882022%EF%BC%89%E5%8F%91%E5%B8%83%E5%85%AC%E5%91%8A.pdf">指数编制细则</a>，试图利用其方法进行品种权重的复现。但是由于部分宏观数据无法利用，因此仅使用交易额和波动率来作为调整权重的标准。最初，我选择计算每个品种近 3 年成交额均值的比重和近 5 日价格标准差比重，并将这两个指标按照 2:1 的比例进行权重配置。折腾了一大通，发现若给波动率更大的权重会使得指数波动更加剧烈，因此不得不选择将波动率的计算窗口放宽到 10 日，而权重降低至 1&#x2F;5。这样的参数下，指数的波动尚能接受，且能够一定程度上反映各品种的趋势和短期内的波动。</p><p>也许代码还是有一些问题，但是快下班时已经晕乎乎地没法思考了，明天再继续吧💨。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 11：愉快的摸鱼日</title>
      <link href="/posts/fee2c102/"/>
      <url>/posts/fee2c102/</url>
      
        <content type="html"><![CDATA[<p>上周最后一天的日记居然忘记写了，惭愧惭愧，以后尽量不落了。</p><p>上午带了另一个电脑来上班，然后意识到回测框架的环境并没有在这个电脑上配置好，于是又重复造了一次轮子。不知道现在 <code>pip</code> 出了什么问题，为什么梯子一开就安装不了三方库？上一个电脑通过设置 <code>pip</code> 的代理方式解决了，但是这台电脑始终没法解决这个问题。无奈之下，我只好通过每次安装库时都关闭梯子来作为临时解决办法。</p><p>时近五一，办公室里洋溢着假期临近的氛围，我也决定下午先摸摸鱼。找到了上一份实习时读到的一份很不错的研报，下载研究一下，发现用到的因子很简单但是效果奇好，实在忍不住想复现一下。需要用到的股票行情在 iFind 上获取总是出 bug，因此决定使用 <code>AKShare</code> 来自动爬取所有股票行情数据。谁知道跑了半天报错，真服了。正好五点到了，下班度假先。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 9：初识截面回测框架</title>
      <link href="/posts/3e26f975/"/>
      <url>/posts/3e26f975/</url>
      
        <content type="html"><![CDATA[<p>由于四个行业的基本面数据已经整理得差不多了，因此我今天主要做了两件事：</p><ol><li>将黑色板块上下游数据用思维导图的形式整理下来。这部分我直接使用 <a href="https://mermaid.js.org/">Mermaid</a> 来绘制。由于这个工具会自动调整布局，因此熟练之后效率比较高且省心。偶有布局不合理之处，通过调整语句顺序也可以修正。值得注意的是我发现这个工具还有一个官方的<a href="https://www.mermaidchart.com/">在线编辑平台</a>，可以保存绘制过的项目，还可以调整主题之类的设置，挺方便的。</li><li>整理各个品种的成本端构成，即整理每个品种的生产存在哪些成本，以及这些成本所占的比例。老样子，我开始 Google 各个品种相关的研报，从中搜罗各种我需要的信息。然而这个过程不太顺利。尽管大部分品种都能找到成本大致有哪些类别，但是它们的比重却难以衡量，部分原因是这些比重随时间的变化十分明显。在这样的情况下，整理下来的数据也许仅能作为参考，不能作为精确参数使用。</li></ol><p>下午三点多，关于回测框架的培训终于开始了。我又下载了一个新应用 <a href="https://www.todesk.com/">ToDesk</a>——这是上班之后安装的第几个 APP 了？</p><p>乍一看这个截面回测框架还蛮酷的，调用相对比较简洁，输出结果也很详细，回头下载下来琢磨一下。</p><h2 id="黑色板块上下游产业"><a href="#黑色板块上下游产业" class="headerlink" title="黑色板块上下游产业"></a>黑色板块上下游产业</h2><p>附赠今日整理的黑色板块上下游梳理图：</p><pre class="mermaid">graph LR    jiaomei((焦煤)) --100%--> jiaotan((焦炭))    jiaotan --7%----> huaxuezhipin(化学制品)    jiaotan --3%----> tongyongshebei(通用设备)    jiaotan --2%----> yousejinshu(有色金属)    jiaotan --3%----> qita1(其他)    jiaotan --85%--> gangtie(钢铁)    tiekuang((铁矿)) --100%---> gangtie    guimeng((锰硅)) --85%--> gangtie    guimeng ---->|15%| qita2(其他)    guitie((硅铁)) --70%--> gangtie    guitie --20%----> mei(镁)    guitie --5%----> zhuzao(铸造)    guitie --5%----> chukou(出口)    gangtie --> rejuan((热轧板卷))    gangtie --> luowengang((螺纹钢))    rejuan --26%--> qiche(汽车)    rejuan --26%--> hanguan(焊管)    rejuan --12%--> jixie(机械)    rejuan --9%--> jiadian(家电)    rejuan --9%--> zhizaoye(制造业)    rejuan --18%--> qita3(其他)    luowengang --68%--> fangdichan(房地产)    luowengang --25%--> jichujianshe(基础建设)    luowengang --7%--> qita4(其他)    jiaotan1(焦炭) --> guimeng    mengkuangshi(锰矿石) --> guimeng    guikuangshi(硅矿石) --> guimeng    guikuangshi --> guitie    gangxie(钢屑) --> guitie    lantan(兰炭) --> guitie    jiaotan1 --> guitie    shiying(石英) --> guitie</pre>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
            <tag> 行业基本面 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 8：回炉重造</title>
      <link href="/posts/7b1a2f20/"/>
      <url>/posts/7b1a2f20/</url>
      
        <content type="html"><![CDATA[<p>脚还没踏进公司的大门，mentor 的消息已经抵达我的手机：我的数据导出方式有误，因此需要重新导出一次数据。正常来说，这应当是比较大的工作量，因为我需要将 300 多条指标一一复制代码，然后在数据终端上提取数据，最后再统一导出。当然，这难不倒我。利用自动化开发工具 <a href="https://getquicker.net/">Quicker</a>，我迅速开发了一个键鼠自动化小程序，然后美美躺在椅子上欣赏电脑辛勤地提取一个个数据。当然，这么简单的程序肯定没那么稳定，因此我监督着程序的执行，并在执行结束后微调一下个别出错的部分。总体来说，这一过程应该还是节省了一些时间。</p><p>下午睡醒后，我开始将所有指标汇总到一张 Excel 表格中，用以标准化入库。由于指标数量众多且某些部分手动操作不便，因此我还是决定将大部分工作交给 Python 完成。然而最后一部分确实最麻烦且不敢由程序来完成的，那就是根据每条数据的更新时间和最新数据时间，推断每条数据的发布规则，比如“次月中旬发布”“当日发布”等等。对于几百条数据，一一从日历上寻找对应数据发布时间，再计算数据发布规则，这一过程相当令人头疼。奋战了一个下午搞定，今日的工作也就走到了尾声。</p><p>今天发现这位大领导好像还挺厉害的，昨天预测今日硅锰会涨，结果今日近乎涨停，大赚了一笔。他又预测明天菜油会大涨，刚准备追随买入，一看菜油一手价格 8000 多，买不起。看来有些钱确实不是我能赚的。</p><p>下班！</p><p>PS：菜油晚上仅一小时就涨了 1 个点，这大领导真是深不可测。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 7：黑云压城城欲摧</title>
      <link href="/posts/f94efd13/"/>
      <url>/posts/f94efd13/</url>
      
        <content type="html"><![CDATA[<p><img src="/posts/f94efd13/b496e71280da57dacd44e5e518e5007.jpg"></p><p>雷暴在今年首次光临这座沿海城市，轰轰烈烈、来者不善。乌云近得像要压住人们的头顶，侵蚀入云的高楼。这番景象于我也是第一次在 CBD 看到，场面还是颇具视觉冲击力的。幸运的是，下班的时候再次云开日出，看来这气象也并非不近人情。</p><p>今日的工作除了继续整理新的数据之外，还将过往的数据整理成一个更加符合入库标准的格式，尽管我个人认为这一形式并不合理，公司应该学习我的数据整理方式（瞎说的）。</p><p>房地产的数据大都频率很低，因此为了找到周频乃至日频的数据，我翻遍了同花顺的数据库，还做了一些将地市级层面数据合成为宏观数据之类的操作。实际上，高频数据往往来自各种行业业务平台网站，因此往往是二手房成交价、二手房挂牌价等等指标。好在房地产行业很多指标都与螺纹钢的相关性较大，现有的数据应该可以作一些文章。</p><p>在相关性方面，值得担忧的事情有三：</p><ol><li><p>数据的前瞻性。仅计算了即期数据相关性，而这样的相关性本质上是无用的，因为若要参考基本面数据来配置资产，那么基本面的数据必须要领先于资产价格数据。然而，这些基本面数据对于价格数据的前瞻性并没有得到研究。</p></li><li><p>数据的频度问题。用于计算相关性的两两指标往往具有不同的频率或者发布时间，我的做法是将所有数据都利用 quadratic 差值升级到日频数据，然后再计算近三年的数据相关性，但是不知道这一方法是否合适。此外，频度不同也意味着对齐频率后波动率有很大差异，这一特点也可能导致计算出来的相关性存在偏差。</p></li><li><p>数据的发布时间。仅考虑数据所对应的时间是不全面的，因为大部分基本面数据都不能做到及时发布，而个别极端数据甚至过了两三年才发布月频数据，因此在计算因子时可得的最新数据是一个需要小心的问题。实际上，iFind 和 WIND 都不能像钢联那样提供数据的发布规则，因此目前来看，可能的解决方案只有利用目前的最新数据对应时间和数据更新时间，来推算数据发布方式。</p></li></ol><p>面对单纯的数据始终是一种枯燥的体验，回测框架的培训时间又改到了周四。看来实操练上手的时刻还需要耐心等等。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 6：开始造火箭</title>
      <link href="/posts/5c84bde/"/>
      <url>/posts/5c84bde/</url>
      
        <content type="html"><![CDATA[<p>随着第二个实习生也到了（好像还会来一个），大领导决定给我们开个小会，讲讲接下来要做些什么工作。尽管他洋洋洒洒讲了一大通，但是总结下来就是一句话：我负责中微观因子，另一个实习生负责宏观因子，我们这三个月要搞出来一个宏观期货轮动框架。</p><p>讲道理，这个目标还是让我有些吃惊，因为在我的概念中完整地做出一个框架并不是实习生能够在两三个月之内搞定的事情，即使有一个 mentor 带。但不管怎么说，这样的实习经历在下一次求职的时候应该是拿得出手的。</p><p>今天仍旧是做了一些数据，主要是房地产行业和基建行业，但是没想到比之前做过的两份数据更加让人伤脑筋，主要原因在于我之前参考的研报里面将房地产作为“金融地产”下的二级行业，只提供了寥寥几个基本面指标，因此我不得不到各种犄角旮旯发掘一些合适的指标来加入指标库。而基础建设就更麻烦了，这根本不算是一个行业。我只好看看基础建设主要包括哪些部分，然后对于各个部分都找一些指标来凑一下，总算是凑到了二三十个指标。做数据的日子就是这么的枯燥。</p><p>明天还要接受一个关于公司内部回测框架的培训，终于有现成的框架了！只是希望不要太难用。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 5：搞定机械制造</title>
      <link href="/posts/bbdb65e1/"/>
      <url>/posts/bbdb65e1/</url>
      
        <content type="html"><![CDATA[<p>中午跟 mentor 交流了一下最近工作，我提出现在做的数据整理工作相当耗时，因为从昨天下班前开始到今天一整天，我才仅仅整理完机械制造这一个行业的基本面数据。我想这部分由于机械制造的基本面数据指标数量远远多于汽车的相应数量——足足是它的三倍有余。</p><p>然而，如果继续做下去，剩下的十个左右的行业仍然需要耗费大量时间。mentor表示理解，表示我可以先做一些因子的工作，并在快下班时发给了我两篇研报。也许我下周可以正式开始做策略？</p><p>经过大领导和 mentor 的传染，整个办公室开始出现一种玄学的氛围，开始通过交易员的八字来测算下周净值会不会涨。也许金融和算命就是没什么两样吧。</p><p>雨季的空气已经掠过南方的陆地，连续两天都阴沉沉的，但是总会在下班时分云销雨霁，也许这预示着下周的好运气。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 4：在数据的海洋里扑腾</title>
      <link href="/posts/2aaa0509/"/>
      <url>/posts/2aaa0509/</url>
      
        <content type="html"><![CDATA[<p>今天早起的时候没有昨天那么困了，到公司的路程也总算是顺利一些。</p><p>继续昨天的工作，我对照兴证的研报，将各个行业的基本面数据名称复制下来，到<a href="https://www.51ifind.com/">同花顺</a>或者 <a href="https://www.wind.com.cn/">WIND</a> 上面去查，然后将数据加入到候选池，查完之后将所有数据下载下来，用 Python 分别计算一下各个指标和行业指数的相关性，最后将所有数据整理好。期间，也常常发生某些数据找不到，需要尝试拿其他数据来替代的情况，总之就是没什么技术含量但是很费时的过程。也许我应该把这个流程也稍微自动化一下。</p><p>可以肯定的是这不是我想做的东西，但是似乎也是量化研究员不得不做的事情——毕竟数据永远不会凭空出现的。但还是不得不吐槽一下，为什么市面上的所有商业数据库都这么难用？现在总算知道像 <a href="https://github.com/akfamily/akshare">AKShare</a> 这种项目有多么可贵了，人家虽然数据没那么全，但是接口多么方便，起码比点来点去的要好多了。</p><p>下班前听到老师们聊天，提到现在的金融 AI 分析工具都快要取代研究所了，不得不说这个时代的 AI 冲击真是让未来捉摸不透。</p><p>今天就写到这里。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 3：逐渐开始理解一切</title>
      <link href="/posts/d5784e7a/"/>
      <url>/posts/d5784e7a/</url>
      
        <content type="html"><![CDATA[<p>标题开玩笑的，不可能理解一切，但是确实开始理解黑色板块的产业逻辑。</p><p>上一篇日记提到，我整理的黑色板块主要包括 7 个品种：热轧板卷、螺纹钢、焦煤、铁矿、焦炭、硅锰和硅铁。而之所以将这些品种归入黑色板块，是因为这些品种都与钢铁直接相关。</p><p>从上游开始梳理，其中的焦煤和铁矿都是直接开采的原材料。铁矿当然是钢铁最重要的原料，而焦煤则是冶铁过程中的重要辅助原料。在我国，焦煤几乎全部被用于制造焦炭，而焦炭的 85% 则被用来制造钢铁。</p><p>除了焦炭以外，硅锰和硅铁也是铁合金中的重要组成部分，产生硅锰合金与硅铁合金。其中，硅铁的上游材料主要包括锰矿石、硅矿石和焦炭，而硅铁的上游材料除了硅矿石和钢屑以外，还有兰炭、焦炭、石英等等。这两种材料被用于制造钢铁的比重分别都达到了 85% 和 70%，因此都是钢铁的重要原材料。</p><p>粗钢被制作好之后，会被打造成不同的钢制产品，其中有两个重要的期货品种：热轧板卷和螺纹钢。螺纹钢就是所谓“钢筋水泥”中的钢筋，却大多数都流向建筑之用，主要可以分成房地产和基础建设两个下游产业，用钢大概是 7:3 的比例。而热轧板卷则是一卷一卷的钢板，用处范围更加广泛：汽车、焊管、机械、家电、制造业，等等等等。</p><p>因此，黑色板块从上到下实际上是一条完整的产业链一环套一环，互相关联。</p><pre class="mermaid">graph TD    A(焦煤) --> B(焦炭)    B --> C(钢铁)    D(铁矿) --> C    E(锰硅) --> C    F(硅铁) --> C    C --> G(热轧板卷)    C --> H(螺纹钢)</pre><p>下午完成了所有板块的下游产业整理，于是 mentor 开始让我寻找各个下游产业相关的基本面数据，筛选从而对各下游产业基本面进行建模，最终对期货品种基本面进行建模。这方面的工作我现在还没完全理清楚头绪，而且存在一个疑惑：mentor 叫我寻找指标之后计算一下和行业指数的相关性，但问题在于，行业指数和品种价格并不直接相关；由于下游产业是上游材料的需求端，因此应当更加关注下游产业的产量，因为这直接代表了对上游材料的需求量，从而能够直接影响品种价格。关于这一点也许明天应该跟 mentor 交流一下。</p><p>今天工作的状态实际上并不好，部分由于上午打工时困得快要睡着，部分也由于在工位上十分社恐不敢说话。果然不善社交这个人设是要立住了🤦🏻‍♂️。明天继续加油。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 2：小小数据搬运工</title>
      <link href="/posts/a8931f06/"/>
      <url>/posts/a8931f06/</url>
      
        <content type="html"><![CDATA[<p>第二天仍然在整理数据，看样子现在这个情况至少会持续到下周。老实讲数据整理的工作相当枯燥重复，做到下午令人昏昏欲睡，但也先坚持一下好了。</p><p>今天的任务主要是详细整理昨天的数据。为了将数据一个个从数据库上转移到我的 Excel 表上（不能导出），我不得不忍受小小屏幕上一个丑陋而臃肿的操作界面、缓慢的响应速度、繁琐的操作流程。由于错过了一两项要求，我甚至返工了一两次。不过好在我深谙自动化之道，写了一个快速执行重复操作的脚本。虽然不能完全代替人工，但是确实节省了不少时间。</p><p>我整理了 7 种黑色金属品种的基本面数据。这些数据主要以品种价格、现货价格、供给、需求、库存、利润为类别划分，这大致也是分析期货基本面行情的主要因素集合。指标按照 mentor 的要求，主要总结自各方研报，但是未经实践尚不知是否有用。随后我又开始整理各品种上下游的产业类别，但是这一部分不太容易，因为尽管少数研报中存在相关的资料，但是都没有给出各产业所占需求的比重。这一部分的工作明天再继续。</p><p>总的来说，今天感觉办公室的氛围还是比较轻松的，聊天吹水没什么压力，我也开始认识越来越多的同事和领导。当然，要是接下来的时间能够提升量化水平和做一些扎实的量化项目就更好了，这也是我的首要目的。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习 v2丨Day 1：新的开始</title>
      <link href="/posts/95670052/"/>
      <url>/posts/95670052/</url>
      
        <content type="html"><![CDATA[<p>没啥事干来写写日记吧。这是我第二份量化实习的第一天。</p><p>先讲讲这份量化实习是怎么来的。和上一份实习相同之处在于，这一份实习的获得顺利得超出预料——一个电话面试，不到 30 分钟，offer 发放。但是我个人觉得这份实习不会像上次那样无疾而终，主要有两方面的原因：一是这个岗位的工资开得不高；二是面试官兼 mentor 和我本硕同校同院同专业。</p><p>然而上班第一天就让我领悟这份工资开得多么没有性价比：打车从学校到地铁站就花了 20 块，而地铁又坐了 50 分钟，挤得像是沙丁鱼罐头。这样算下来，尽管我的住宿没有额外开销，但仅仅是日常通勤费就要倒贴。相比上一段实习，这一点确实劣势很大。目前我的计划是实习 3 个月，然后继续寻找其他量化实习机会。</p><p>今天似乎没有很多事情要做，安装了两个数据库，其中一个是以前用过的。大领导说我实习前期先做数据处理的工作，后面再做因子策略这些，3 个月很长慢慢来。然而我觉得 3 个月一点也不长，不知道能学到什么技术、增长什么经验、参与什么项目。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>工具资源丨本站建站 &amp; SEO 中所使用或参考的资源整理</title>
      <link href="/posts/967bf2a8/"/>
      <url>/posts/967bf2a8/</url>
      
        <content type="html"><![CDATA[<p>建立一个博客并维护其实是一件挺麻烦的事儿，过程中所用到的工具繁多，很容易忘记，不便于后期维护。而某些源代码修改也比较隐蔽，因此有必要记录下来，不仅是作为自己的整理，也能给大家一个参考。</p><h2 id="建站平台"><a href="#建站平台" class="headerlink" title="建站平台"></a>建站平台</h2><p>本博客所使用的搭建平台包括：Hexo、Github Pages、GitLab Pages（已弃用）、Vercel、聚名网。</p><p><a class="link-card" target="_blank" href="https://hexo.io"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">Hexo</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://hexo.io</span></span></span></a></p><p><a class="link-card" target="_blank" href="https://pages.github.com/"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">GitHub Pages | Websites for you and your projects, hosted directly from your GitHub repository. Just edit, push, and your changes are live.</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://pages.github.com/</span></span></span></a></p><p><a class="link-card" target="_blank" href="https://docs.gitlab.com/ee/user/project/pages/"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">GitLab Pages | GitLab</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://docs.gitlab.com/ee/user/project/pages/</span></span></span></a></p><p><a class="link-card" target="_blank" href="https://vercel.com"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">Vercel – Vercel</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://vercel.com</span></span></span></a></p><p><a class="link-card" target="_blank" href="https://www.juming.com"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">聚名网-到期域名查询抢注-域名注册-老域名买卖交易平台</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://www.juming.com</span></span></span></a></p><p>我的大体框架是，用 Hexo 生成静态站点，利用 Github Pages、Vercel 和 GitLab Pages 部署博客，再利用聚名网注册和管理域名。</p><p>为什么要用这么多部署平台？主要是由于百度被 Github 禁止而不被允许爬取 Github Pages。因此我最初采用 Github Pages 和 GitLab Pages 同步部署来解决这个问题（GitLab Pages 可以被百度收录）。但是这样太麻烦，而且两者网址不统一。因此我最终放弃了 GitLab Pages 的方案，选择在聚名网购买了一个域名，再用 Vercel 镜像了 Github 项目，并将域名解析到 Vercel 中，从而解决了这一问题，见：</p><p><a class="link-card" target="_blank" href="https://www.cnblogs.com/chainsR/p/14391751.html"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">利用vercel让百度收录GitHub Pages 个人博客- chainsR</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://www.cnblogs.com/chainsR/p/14391751.html</span></span></span></a></p><h2 id="评论管理"><a href="#评论管理" class="headerlink" title="评论管理"></a>评论管理</h2><p>评论系统我选用了 Waline，原因是它的部署相对简单，且评论者无需登录。</p><p><a class="link-card" target="_blank" href="https://waline.js.org"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">Waline | Waline</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://waline.js.org</span></span></span></a></p><p>注意这一评论系统还需要部署后台数据库和服务器，我选择的方案是 LeanCloud+Vercel。</p><p><a class="link-card" target="_blank" href="https://www.leancloud.cn"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">LeanCloud</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://www.leancloud.cn</span></span></span></a></p><p><a class="link-card" target="_blank" href="https://vercel.com"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">Vercel – Vercel</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://vercel.com</span></span></span></a></p><p>这一评论系统每次打开时都会从 <a href="https://unpkg.com/">UNPKG</a> 拉取包，但是速度很慢（而且好像不稳定），因此我更换成了国内的 CDN 镜像 <a href="https://www.bootcdn.cn/">BootCDN</a>。更多 CDN 镜像可以参考如下网页：</p><p><a class="link-card" target="_blank" href="https://sarakale.top/blog/posts/8fda44f8/"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">CDN 镜像节点整理 | SaraKale’s blog</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://sarakale.top/blog/posts/8fda44f8/</span></span></span></a></p><p>为了实现自动新评论通知，我申请了个人域名邮箱（不想使用私人邮箱来发送通知）。综合考虑可用性和价格因素后，我决定暂时使用阿里云企业邮箱来实现这一点。值得注意的是，注册好的邮箱发送邮件可能容易被拒收，因此最好配置一系列安全协议，比如 <a href="https://www.alibabacloud.com/help/zh/alibaba-mail/latest/spfcheckfailed">SPF</a>、<a href="https://www.alibabacloud.com/help/zh/alibaba-mail/latest/what-is-dkim-how-do-i-add-them">DKIM</a> 和 <a href="https://www.alibabacloud.com/help/zh/alibaba-mail/latest/what-is-dmarc-how-do-i-set-it-up">DMARC</a>。</p><p><a class="link-card" target="_blank" href="https://wanwang.aliyun.com/mail"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">阿里邮箱_阿里企业邮箱_阿里邮箱企业版_企业服务-阿里云</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://wanwang.aliyun.com/mail</span></span></span></a></p><h2 id="博客主题"><a href="#博客主题" class="headerlink" title="博客主题"></a>博客主题</h2><p>我个人喜欢比较节约而朴素的画风，因此最终挑选了 <code>maupassant</code> 这一主题。</p><p><img src="/posts/967bf2a8/68747470733a2f2f6f6f6f2e306f302e6f6f6f2f323031352f31302f32342f353632623562653132313737652e6a7067.jpg" alt="maupassant 主题"></p><p><a class="link-card" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">tufu9441&#x2F;maupassant-hexo: A simple Hexo theme forked from icylogic.</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://github.com/tufu9441/maupassant-hexo</span></span></span></a></p><p>当然，我并非对这一主题所有部分都完全满意，因此个别细节也会按照自己的喜好进行魔改。比如注意到 <code>mathjax</code> 生成的公式太长会溢出屏幕，因此按照下方文章的方式修改了 <code>style.css</code> 文件：</p><p><a class="link-card" target="_blank" href="https://blog.csdn.net/daily886/article/details/106660880"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">mathjax 数学公式的使用_使用mathjax.js-CSDN博客</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://blog.csdn.net/daily886/article/details/106660880</span></span></span></a></p><p>我的很多博客内容都包含数学公式，然而 <code>mathjax v1</code> 渲染效率很低，因此我将 <code>mathjax</code> 迁移到了 <code>v3</code>。</p><p><a class="link-card" target="_blank" href="https://adaning.github.io/posts/33457.html"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">MathJax常见问题 | DaNing的博客</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://adaning.github.io/posts/33457.html</span></span></span></a></p><p>对于侧栏的 <code>tags</code> 样式，我参考了 Hux Blog 的代码：</p><p><a class="link-card" target="_blank" href="https://huangxuan.me/"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">黄玄的博客 | Hux Blog</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://huangxuan.me/</span></span></span></a></p><p>为了提供更好的页面打印体验，我参考下方文章优化了网页打印样式：</p><p><a class="link-card" target="_blank" href="https://blog.baoshuo.ren/post/printer-friendly-webpage/"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">如何创建一个打印友好型的网页 - 宝硕博客</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://blog.baoshuo.ren/post/printer-friendly-webpage/</span></span></span></a></p><p>打印时会自动生成 <code>&lt;a&gt;</code> 元素链接文本，但是由于很多链接都是相对路径的形式，因此参照如下回答，将所有相对路径全部转换为绝对路径：</p><p><a class="link-card" target="_blank" href="https://stackoverflow.com/questions/14780350/convert-relative-path-to-absolute-using-javascript/44547904#44547904"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">html - Convert relative path to absolute using JavaScript - Stack Overflow</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://stackoverflow.com/questions/14780350/convert-relative-path-to-absolute-using-javascript/44547904#44547904</span></span></span></a></p><p>为了给创作内容进行版权保护，我在页面底部添加了 Creative Commons 知识共享协议。创作者可以在 <a href="https://chooser-beta.creativecommons.org/">Chooser</a> 上选择一个协议类型，我最终选择用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/?ref=chooser-v1">CC BY-NC-SA 4.0</a> 来保护个站中的所有内容，尽管这一协议在国内的效力存疑。</p><p><a class="link-card" target="_blank" href="https://creativecommons.org/"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">Homepage - Creative Commons</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://creativecommons.org/</span></span></span></a></p><h2 id="SEO-优化"><a href="#SEO-优化" class="headerlink" title="SEO 优化"></a>SEO 优化</h2><p>这部分是重头戏，对我来说非常伤脑筋。首先是四个主要搜索引擎的站长平台：</p><ul><li>百度：</li></ul><p><a class="link-card" target="_blank" href="https://ziyuan.baidu.com/dashboard"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">站点信息_站点重要数据概览_站长工具_网站支持_百度搜索资源平台</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://ziyuan.baidu.com/dashboard</span></span></span></a></p><ul><li>Bing：</li></ul><p><a class="link-card" target="_blank" href="https://www.bing.com/webmasters"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">Home - Bing Webmaster Tools</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://www.bing.com/webmasters</span></span></span></a></p><ul><li>Google：</li></ul><p><a class="link-card" target="_blank" href="https://search.google.com/search-console/about"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">Google Search Console Tools</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://search.google.com/search-console/about</span></span></span></a></p><ul><li>Yandex：</li></ul><p><a class="link-card" target="_blank" href="https://webmaster.yandex.com"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">Yandex Webmaster - search engine optimization service</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://webmaster.yandex.com</span></span></span></a></p><p>若要让搜索引擎知道需要爬取哪些网站，就需要提交 sitemap。我利用以下两个插件来生成适用于百度、bing 和 Google 的 sitemap：</p><p><a class="link-card" target="_blank" href="https://github.com/hexojs/hexo-generator-sitemap"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">hexojs&#x2F;hexo-generator-sitemap: Sitemap generator for Hexo.</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://github.com/hexojs/hexo-generator-sitemap</span></span></span></a></p><p><a class="link-card" target="_blank" href="https://github.com/coneycode/hexo-generator-baidu-sitemap"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">coneycode&#x2F;hexo-generator-baidu-sitemap: Baidu Sitemap generator plugin for Hexo</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://github.com/coneycode/hexo-generator-baidu-sitemap</span></span></span></a></p><p>由于使用 sitemap 的方式提交网站收录比较慢，因此最好采用主动推送链接的方式来加快网站内容的收录，我使用了 <code>hexo-submit-urls-to-search-engine</code> 这一插件。</p><p><a class="link-card" target="_blank" href="https://github.com/cjh0613/hexo-submit-urls-to-search-engine"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">cjh0613&#x2F;hexo-submit-urls-to-search-engine: Hexo plugin to submit URLs of new posts to Google, Bing, Baidu search engine , that make search engines index your pages earlier. Hexo插件：主动推送Hexo博客新链接至谷歌必应百度搜索引擎，提升网站收录质量和速度。</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://github.com/cjh0613/hexo-submit-urls-to-search-engine</span></span></span></a></p><p>按照文档说明即可自动提交到百度和 Bing，但是 Google 的处理流程似乎有些变化，因此我还参考了如下博客：</p><p><a class="link-card" target="_blank" href="https://coo.st/How-to-submit-website-to-google-use-google-index-api/"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">如何使用Google Index Api提交网址到Google</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://coo.st/How-to-submit-website-to-google-use-google-index-api/</span></span></span></a></p><p>编写 <code>robots.txt</code> 有助于搜索引擎节约爬虫资源，从而提高 SEO 性能。我参考如下指南编写了网站 <code>robots.txt</code> 文件。</p><p><a class="link-card" target="_blank" href="https://developers.google.com/search/docs/crawling-indexing/robots/create-robots-txt?hl=zh-cn"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">创建并提交 robots.txt 文件 | Google 搜索中心  |  文档  |  Google for Developers</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://developers.google.com/search/docs/crawling-indexing/robots/create-robots-txt?hl=zh-cn</span></span></span></a></p><p>SEO 还有很多花样，下面这个网站里可以获得一些学习资料和工具：</p><p><a class="link-card" target="_blank" href="https://ahrefs.com/zh"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">Ahrefs-SEO工具和增加搜索流量的资源</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://ahrefs.com/zh</span></span></span></a></p><h2 id="其他插件"><a href="#其他插件" class="headerlink" title="其他插件"></a>其他插件</h2><p>Hexo 官网上提供了很多可用的<a href="https://hexo.io/plugins/">插件</a>。我除了上述介绍的插件以外，主要还安装了如下几个：</p><ul><li><code>hexo-abbrlink</code>。Hexo 自动将文章标题作为文章链接，在浏览器搜索栏显示效果比较丑陋，而且据说不利于 SEO 优化。因此我安装了这一插件，用于为每篇文章生成一个固定编号，并生成对应的文章链接。</li></ul><p><a class="link-card" target="_blank" href="https://github.com/rozbo/hexo-abbrlink"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">rozbo&#x2F;hexo-abbrlink: create one and only link for every post for hexo</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://github.com/rozbo/hexo-abbrlink</span></span></span></a></p><ul><li><code>hexo-link-card</code>。这是一个能够在博客显示卡片链接的插件，显示效果前文已经大量展示过了。</li></ul><p><a class="link-card" target="_blank" href="https://github.com/OrangeX4/hexo-link-card"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">OrangeX4&#x2F;hexo-link-card: Convert a link to a link card via existing markdown grammar. 使用现有 Markdown 语法将链接转换为卡片式链接.</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://github.com/OrangeX4/hexo-link-card</span></span></span></a></p><ul><li><code>hexo-all-minifier</code>。页面元素多了会导致文件比较大，网页加载起来效率变慢。为此安装这个插件，来压缩页面源文件，提高页面使用体验。</li></ul><p><a class="link-card" target="_blank" href="https://github.com/chenzhutian/hexo-all-minifier"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">chenzhutian&#x2F;hexo-all-minifier: A plugin for Hexo that optimizes HTML, CSS, JS and imagages, and it can optionally deploys your blog.</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://github.com/chenzhutian/hexo-all-minifier</span></span></span></a></p><ul><li><code>hexo-filter-mermaid-diagrams</code>。这一插件能够渲染 Markdown 文档中的 <a href="https://mermaid.js.org/">Mermaid</a> 流程图。</li></ul><p><a class="link-card" target="_blank" href="https://github.com/webappdevelp/hexo-filter-mermaid-diagrams"><span class="LinkCard-contents"><span style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; max-height: 40px; line-height: 1.25; color: #121212;">webappdevelp&#x2F;hexo-filter-mermaid-diagrams: mermaid diagrams for hexo</span><span style="display: -webkit-box; font-size: 13px; height: 18px; line-height: 18px; color: #999; word-break: break-all; text-overflow: ellipsis; overflow: hidden; -webkit-line-clamp: 1; -webkit-box-orient: vertical;"><span style="display: inline-flex; align-items: center;"><svg class="Zi Zi--InsertLink" fill="currentColor" viewbox="0 0 24 24" width="14" height="14"><path d="M13.414 4.222a4.5 4.5 0 1 1 6.364 6.364l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005a2.5 2.5 0 1 0-3.536-3.536l-3.005 3.005a.5.5 0 0 1-.707 0l-.707-.707a.5.5 0 0 1 0-.707l3.005-3.005zm-6.187 6.187a.5.5 0 0 1 .638-.058l.07.058.706.707a.5.5 0 0 1 .058.638l-.058.07-3.005 3.004a2.5 2.5 0 0 0 3.405 3.658l.13-.122 3.006-3.005a.5.5 0 0 1 .638-.058l.069.058.707.707a.5.5 0 0 1 .058.638l-.058.069-3.005 3.005a4.5 4.5 0 0 1-6.524-6.196l.16-.168 3.005-3.005zm8.132-3.182a.25.25 0 0 1 .353 0l1.061 1.06a.25.25 0 0 1 0 .354l-8.132 8.132a.25.25 0 0 1-.353 0l-1.061-1.06a.25.25 0 0 1 0-.354l8.132-8.132z"/></svg></span><span>https://github.com/webappdevelp/hexo-filter-mermaid-diagrams</span></span></span></a></p>]]></content>
      
      
      <categories>
          
          <category> 建站 &amp; SEO </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具 </tag>
            
            <tag> 建站 </tag>
            
            <tag> SEO </tag>
            
            <tag> 资源 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>阅读笔记丨《悉达多》——凡人不能领悟的诗</title>
      <link href="/posts/e9def67/"/>
      <url>/posts/e9def67/</url>
      
        <content type="html"><![CDATA[<p><a href="https://book.douban.com/subject/26980487/">《悉达多——一首印度的诗》</a>，作者却是德国人<a href="https://zh.wikipedia.org/wiki/%E8%B5%AB%E5%B0%94%E6%9B%BC%C2%B7%E9%BB%91%E5%A1%9E">黑塞</a>，这是我读完全书才发现的事实。然而书中的文字充满佛教的神谕，朴实的语句仿佛真的出自一位得道僧人之手。 </p><p>读书的时候我常常在想，一个凡人执笔如何能够描述圣人的思想？实际上所谓圣人的思想不过是作者的思想，然而这个思想是否完全贯彻于作者的一言一行当中？我觉得难说。 </p><p>实际上我没有办法评判这本书中所涉及的思想，实在地讲，我的资历尚浅，对这些超脱的感受和观念没有办法产生共鸣。其次，在可预见的未来，我也无法体验悉达多所经历的人生故事——自幼便打坐禅定、数十年的林中苦行、二十多年的纵欲沉沦、数十年的河边摆渡。如果人要经历这么多的折磨苦难才能抵达彼岸，我觉得我没有意愿尝试。</p><p> 倒是书中对于一些凡人生活的描述令我印象深刻。当悉达多挚爱的迦摩罗奄奄一息地抵达河岸，此前腰缠万贯的男人和城中名妓再次相会时，都已经是白发苍苍的老人，此前寥寥几笔带过的数十年如此深刻地刻画在这次重逢当中。如同书中所言，“难道不是时间令人痛苦？难道不是时间折磨人，令人恐惧？”迦摩罗临终前意外与旧情人相逢，这一刻的恐惧、痛惜、喜悦、解脱相互交织，让人无法不动容。 </p><blockquote><p>悉达多不语，他安静地望着她的眼睛。</p><p> “你实现目标了吗？”她问，“你找到你的安宁了吗？” </p><p>他笑了，手抚在她的手上。</p><p> “我懂。”她道，“我懂得。我也会找到我的安宁。”</p><p> “你已经找到了。”悉达多轻声道。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 赏阅纪 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 阅读笔记 </tag>
            
            <tag> 悉达多 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>漫省随笔丨明天就要笔试，而我仍在焦虑</title>
      <link href="/posts/a480d2dc/"/>
      <url>/posts/a480d2dc/</url>
      
        <content type="html"><![CDATA[<p>就像舍友所描述他经历的那样，我此时此刻正在面临一个挥之不去的问题：量化这条道路究竟是否走得通？</p><p>自从上一份实习 9 天被辞退以来，尽管我投递了几十家公司，也在准备笔面试，但是今天拿到第一份笔试时，焦虑再次弥漫出来。究其原因，我没有信心，而且我失败太多次了。</p><p>我现在习惯于为某一份笔面试做更多的准备。除了平时的积累以外，我会对这个公司的背景、策略类型、收益情况做更细致的调查；对于笔面试，我会习惯性地上网翻个底朝天，看看能不能挖掘出一两份笔面试真题。</p><p>这家公司的笔试真题还真被我挖出来了一份，但不是我这个岗位，是一个量化开发岗位的实习笔试。而从 HR 向我透露的考察方向来看，很有可能我做的笔试题将会与这一份笔试题不同。而即使是这一份笔试题，大部分题目我同样写不出来，需要一道一道地上网去查。这真的会让我觉得自己没有办法通过这份笔试。</p><p>在我看来，这类笔面试实际上无法检验我的真实水平。首先，笔面试中涉及的绝大部分问题都与实际业务无关——量化研究根本用不上 brain teasers、稀奇古怪的概率题。其次，我明白我的优劣势在哪里：我擅长于整合信息并快速学习，但是非常不擅长于记忆，而这对于量化笔面试来说是一个很大的劣势。量化机构的笔面试在我看来考察的内容范围是非常广泛的。从脑筋急转弯、概率论与统计学、微积分与线性代数，到数据结构与算法、机器学习或深度学习算法、计算机语言基础，再到衍生品定价、宏观基本面分析能力，你完全无法预测面试官会从哪个犄角旮旯挖出一个知识点来考察你。即便问的问题相对比较基础，也需要一个庞大的知识面来覆盖。而对于我而言，尽管这些知识的大部分我都涉及过，但是无法形成长期记忆，经过一段时间就会变得生疏，我不知道该如何克服这一阻碍。</p><p>然而笔面试这一关始终没有办法绕过去的，我必须面对这一份笔试题，尽管我对于是否能够通过笔试没有什么自信。即便通过了笔试，后面一两轮的面试就更加没有把握了。</p><p>也许我应该试试一些券商资管、小机构？似乎是时候学会降低预期。</p><p>又或许像舍友那样，经历无措之后走通了这条路？然而并不是每个人都能开出彩票。</p><p>是时候睡觉了，就算是为了健康，也要好好生活。</p>]]></content>
      
      
      <categories>
          
          <category> 对话录 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 职业发展 </tag>
            
            <tag> 随笔 </tag>
            
            <tag> 心情 </tag>
            
            <tag> 实习 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>绿皮书刷题记录_03</title>
      <link href="/posts/79411b62/"/>
      <url>/posts/79411b62/</url>
      
        <content type="html"><![CDATA[<p>这是<a href="/tags/%E9%87%8F%E5%8C%96%E9%9D%A2%E8%AF%95%E7%BB%BF%E7%9A%AE%E4%B9%A6">绿皮书刷题记录系列</a>的第 2 篇。</p><p>今天涉及的是我很久没有复习过的微积分与线性代数，因此稍微吃力一点。我们先将书中涉及到的所有数学知识点整理一下。</p><h2 id="数学知识整理"><a href="#数学知识整理" class="headerlink" title="数学知识整理"></a>数学知识整理</h2><h3 id="极限与导数"><a href="#极限与导数" class="headerlink" title="极限与导数"></a>极限与导数</h3><ul><li><p><strong>Derivative</strong>: Let $ y&#x3D;f(x) $，then<br>$$<br>f^{\prime}(x)&#x3D;\frac{d y}{d x}&#x3D;\lim _{\Delta x \rightarrow 0} \frac{\Delta y}{\Delta x}&#x3D;\lim _{\Delta x \rightarrow 0} \frac{f(x+\Delta x)-f(x)}{\Delta x}<br>$$</p></li><li><p><strong>The product rule</strong>: If $ u&#x3D;u(x) $ and $ v&#x3D;v(x) $ and their respective derivatives exist,<br>$$<br>\frac{d(u v)}{d x}&#x3D;u \frac{d v}{d x}+v \frac{d u}{d x}, \quad(u v)^{\prime}&#x3D;u^{\prime} v+u v^{\prime}<br>$$</p></li><li><p><strong>The quotient rule</strong>:<br>$$<br>\frac{d}{d x}\left(\frac{u}{v}\right)&#x3D;{v \frac{d u}{d x}-u \frac{d v}{d x} \over v^{2}},\quad\left(\frac{u}{v}\right)^{\prime}&#x3D;\frac{u^{\prime} v-u v^{\prime}}{v^{2}}<br>$$</p></li><li><p><strong>The chain rule</strong>: If $ y&#x3D;f(u(x)) $ and $ u&#x3D;u(x) $，then $ \frac{d y}{d x}&#x3D;\frac{d y}{d u} \frac{d u}{d x} $</p></li><li><p><strong>The generalized power rule</strong>: $ \frac{d y^{n}}{d x}&#x3D;n y^{n-1} \frac{d y}{d x} $ for $ \forall n \neq 0 $</p></li><li><p>Some useful equations:</p><ul><li><p>$$<br> a^{x}&#x3D;e^{x \ln a} \quad \ln (a b)&#x3D;\ln a+\ln b \quad e^{x}&#x3D;\lim _{n \rightarrow \infty}\left(1+\frac{x}{n}\right)^{n}<br>$$</p></li><li><p>For any $k$,<br>$$<br>\lim _{x \rightarrow 0} \frac{\sin x}{x}&#x3D;1 \quad \lim _{x \rightarrow 0}(1+x)^{k}&#x3D;1+k x<br>$$</p></li><li><p>$ \lim _{x \rightarrow \infty}\left(\ln x &#x2F; x^{r}\right)&#x3D;0 $ for any $ r&gt;0 $</p></li><li><p>$ \lim _{x \rightarrow \infty} x^{r} e^{-x}&#x3D;0 $ for any $ r $</p></li><li><p>$$<br>\frac{d}{d x} e^{u}&#x3D;e^{u} \frac{d u}{d x} \quad \frac{d a^{u}}{d x}&#x3D;\left(a^{u} \ln a\right) \frac{d u}{d x} \quad \frac{d}{d x} \ln u&#x3D;\frac{1}{u} \frac{d u}{d x}&#x3D;\frac{u^{\prime}}{u}<br>$$</p></li><li><p>$$<br>\frac{d}{d x} \sin x&#x3D;\cos x, \frac{d}{d x} \cos x&#x3D;-\sin x, \frac{d}{d x} \tan x&#x3D;\sec ^{2} x<br>$$</p></li></ul></li><li><p><strong>Local maximum or minimum</strong>: suppose that $ f(x) $ is differentiable at $ c $ and is defined on an open interval containing $ c $. If $ f(c) $ is either a local maximum value or a local minimum value of $ f(x) $，then $ f^{\prime}(c)&#x3D;0 $.</p></li><li><p>Second Derivative test: Suppose the secondary derivative of $ f(x), f^{\prime \prime}(x) $, is continuous near $ c $. If $ f^{\prime}(c)&#x3D;0 $ and $ f^{\prime \prime}(c)&gt;0 $，then $ f(x) $ has a local minimum at $ c $; if $ f^{\prime}(c)&#x3D;0 $ and $ f^{\prime \prime}(c)&lt;0 $，then $ f(x) $ has a local maximum at $ c $.</p></li><li><p><strong>L’Hospital’s rule</strong>: Suppose that functions $ f(x) $ and $ g(x) $ are differentiable at $ x \rightarrow a $ and that $ \lim _{x \rightarrow a} g^{\prime}(a) \neq 0 $. Further suppose that $ \lim _{x \rightarrow a} f(a)&#x3D;0 $ and $ \lim _{x \rightarrow a} g(a)&#x3D;0 $ or that $ \lim _{x \rightarrow a} f(a) \rightarrow \pm \infty $ and $ \lim _{x \rightarrow a} g(a) \rightarrow \pm \infty $，then $ \lim _{x \rightarrow a} \frac{f(x)}{g(x)}&#x3D;\lim _{x \rightarrow a} \frac{f^{\prime}(x)}{g^{\prime}(x)} $. L’Hospital’s rule converts the limit from an indeterminate form to a determinate form.</p></li></ul><h3 id="积分"><a href="#积分" class="headerlink" title="积分"></a>积分</h3><ul><li><p>If $ f(x)&#x3D;F^{\prime}(x)$,<br>$$<br>\int_{a}^{b} f(x)&#x3D;\int_{a}^{b} F^{\prime}(x) d x&#x3D;[F(x)]_{a}^{b}&#x3D;F(b)-F(a)<br>$$</p><p>$$<br>\frac{d F(x)}{d x}&#x3D;f(x)<br>$$</p><p>$$<br>F(a)&#x3D;y_{a} \Rightarrow F(x)&#x3D;y_{a}+\int_{a}^{x} f(t) d t<br>$$</p></li><li><p><strong>The generalized power rule in reverse</strong>:<br>$$<br> \int u^{k} d u&#x3D;\frac{u^{k+1}}{k+1}+c \quad(k \neq 1)<br>$$</p><p>where $ c $ is any constant.</p></li><li><p><strong>Integration by substitution</strong>:<br>$$<br>\int f(g(x)) \cdot g^{\prime}(x) d x&#x3D;\int f(u) d u $ with $ u&#x3D;g(x), \quad d u&#x3D;g^{\prime}(x) d x<br>$$</p></li><li><p><strong>Substitution in definite integrals</strong>:<br>$$<br>\int_{a}^{b} f(g(x)) \cdot g^{\prime}(x) d x&#x3D;\int_{g(a)}^{p(b)} f(u) d u<br>$$</p></li><li><p><strong>Integration by parts</strong>: $ \int u d v&#x3D;u v-\int v d u $</p></li></ul><h3 id="偏导数与多重积分"><a href="#偏导数与多重积分" class="headerlink" title="偏导数与多重积分"></a>偏导数与多重积分</h3><ul><li><strong>Partial derivative</strong>:<br>$$<br>w&#x3D;f(x, y) \Rightarrow \frac{\partial f}{\partial x}\left(x_{0}, y_{0}\right)&#x3D;\lim_{\Delta x \rightarrow 0} \frac{f\left(x_{0}+\Delta x, y_{0}\right)-f\left(x_{0}, y_{0}\right)}{\Delta x}&#x3D;f_{x}<br>$$</li><li><strong>Second order partial derivatives</strong>:<br>$$<br>\frac{\partial^{2} f}{\partial x^{2}}&#x3D;\frac{\partial}{\partial x}\left(\frac{\partial f}{\partial x}\right), \quad \frac{\partial^{2} f}{\partial x \partial y}&#x3D;\frac{\partial}{\partial x}\left(\frac{\partial f}{\partial y}\right)&#x3D;\frac{\partial}{\partial y}\left(\frac{\partial f}{\partial x}\right)<br>$$</li><li><strong>The general chain rule</strong>: Suppose that $ w&#x3D;f\left(x_{1}, x_{2}, \cdots, x_{m}\right) $ and that each of variables $ x_{1}, x_{2}, \cdots, x_{m} $ is a function of the variables $ t_{1}, t_{2}, \cdots, t_{n} $. If all these functions have continuous first-order partial derivatives, then<br>$$<br>\frac{\partial w}{\partial t_{i}}&#x3D;\frac{\partial w}{\partial x_{1}} \frac{\partial x_{1}}{\partial t_{i}}+\frac{\partial w}{\partial x_{2}} \frac{\partial x_{2}}{\partial t_{i}}+\cdots+\frac{\partial w}{\partial x_{m}} \frac{\partial x_{m}}{\partial t_{i}}<br>$$<br>for each $ i, 1 \leq i \leq n $.</li><li><strong>Changing Cartesian integrals into polar integrals</strong>: The variables in two-dimension plane can be mapped into polar coordinates: $ x&#x3D;r \cos \theta$, $y&#x3D;r \sin \theta $. The integration in a continuous polar region $ R $ is converted to<br>$$<br>\iint_{R} f(x, y) d x d y&#x3D;\iint_{R} f(r \cos \theta, r \sin \theta) r d r d \theta<br>$$</li></ul><h3 id="重要的微积分方法"><a href="#重要的微积分方法" class="headerlink" title="重要的微积分方法"></a>重要的微积分方法</h3><ul><li><p><strong>Taylor’s series</strong>: One-dimensional Taylor’s series expands function $ f(x) $ as the sum of a series using the derivatives at a point $ x&#x3D;x_{0} $ :<br>$$<br>f(x)&#x3D;f\left(x_{0}\right)+f^{\prime}\left(x_{0}\right)\left(x-x_{0}\right)+\frac{f^{\prime \prime}\left(x_{0}\right)}{2 !}\left(x-x_{0}\right)^{2}+\cdots+\frac{f^{(n)}\left(x_{0}\right)}{n !}\left(x-x_{0}\right)^{n}+\cdots<br>$$<br>If $ x_{0}&#x3D;0$,<br>$$<br>f(x)&#x3D;f(0)+f^{\prime}(0) x+\frac{f^{\prime \prime}(0)}{2 !} x^{2}+\cdots+\frac{f^{(n)}(0)}{n !} x^{n}+\cdots<br>$$<br>Taylor’s series are often used to represent functions in power series terms. For example, Taylor’s series for three common transcendental functions, $ e^{x}, \sin x $ and $ \cos x $，at $ x_{0}&#x3D;0 $ are<br>$$<br>\begin{array}{l}<br>e^{x}&#x3D;\sum_{n&#x3D;0}^{\infty} \frac{1}{n !}&#x3D;1+\frac{x}{1 !}+\frac{x^{2}}{2 !}+\frac{x^{3}}{3 !}+\cdots, \<br>\sin x&#x3D;\sum_{n&#x3D;0}^{\infty} \frac{(-1)^{n} x^{2 n+1}}{(2 n+1) !}&#x3D;x-\frac{x^{3}}{3 !}+\frac{x^{5}}{5 !}-\frac{x^{7}}{7 !}+\cdots, \<br>\cos x&#x3D;\sum_{n&#x3D;0}^{\infty} \frac{(-1)^{n} x^{2 n}}{(2 n) !}&#x3D;1-\frac{x^{2}}{2 !}+\frac{x^{4}}{4 !}-\frac{x^{6}}{6 !}+\cdots<br>\end{array}<br>$$<br>The Taylor’s series can also be expressed as the sum of the $ n $ th-degree Taylor polynomial<br>$$<br>T_{n}(x)&#x3D;f\left(x_{0}\right)+f^{\prime}\left(x_{0}\right)\left(x-x_{0}\right)+\frac{f^{\prime \prime}\left(x_{0}\right)}{2 !}\left(x-x_{0}\right)^{2}+\cdots+\frac{f^{(n)}\left(x_{0}\right)}{n !}\left(x-x_{0}\right)^{n}<br>$$<br>and a remainder<br>$$<br>R_{n}(x): f(x)&#x3D;T_{n}(x)+R_{n}(x)<br>$$<br>For some $ \tilde{x} $ between $ x_{0} $ and $ x, R_{n}(x)&#x3D;\frac{f^{(n+1)}(\tilde{x})}{(n+1) !}\left|x-x_{0}\right|^{n+1} $. Let $ M $ be the maximum of $ \left|f^{(n+1)}(\tilde{x})\right| $ for all $ \tilde{x} $ between $ x_{0} $ and $ x $，we get constraint $ \left|R_{n}(x)\right| \leq \frac{M \times\left|x-x_{0}\right|^{n+1}}{(n+1) !} $.</p></li><li><p><strong>Newton’s method</strong>: Newton’s method, also known as the Newton-Raphson method or the Newton-Fourier method, is an iterative process for solving the equation $ f(x)&#x3D;0 $. It begins with an initial value $ x_{0} $ and applies the iterative step $ x_{n+1}&#x3D;x_{n}-\frac{f\left(x_{n}\right)}{f^{\prime}\left(x_{n}\right)} $ to solve $ f(x)&#x3D;0 $ if $ x_{1}, x_{2}, \cdots $ converge.</p><p>Convergence of Newton’s method is not guaranteed, especially when the starting point is far away from the correct solution. For Newton’s method to converge, it is often necessary that the initial point is sufficiently close to the root; $ f(x) $ must be differentiable around the root. When it does converge, the convergence rate is quadratic, which means $ \frac{\left|x_{n+1}-x_{f}\right|}{\left(x_{n}-x_{f}\right)^{2}} \leq \delta&lt;1 $，where $ x_{f} $ is the solution to $ f(x)&#x3D;0 $.</p></li><li><p><strong>Bisection method</strong>: is an intuitive root-finding algorithm. It starts with two initial values $ a_{0} $ and $ b_{0} $ such that $ f\left(a_{0}\right)&lt;0 $ and $ f\left(b_{0}\right)&gt;0 $. Since $ f(x) $ is differentiable, there must be an $ x $ between $ a_{0} $ and $ b_{0} $ that makes $ f(x)&#x3D;0 $. At each step, we check the sign of $ f\left(\left(a_{n}+b_{n}\right) &#x2F; 2\right) $. If $ f\left(\left(a_{n}+b_{n}\right) &#x2F; 2\right)&lt;0 $，we set $ b_{n+1}&#x3D;b_{n} $ and $ a_{n+1}&#x3D;\left(a_{n}+b_{n}\right) &#x2F; 2 $; If $ f\left(\left(a_{n}+b_{n}\right) &#x2F; 2\right)&gt;0 $，we set $ a_{n+1}&#x3D;a_{n} $ and $ b_{n+1}&#x3D;\left(a_{n}+b_{n}\right) &#x2F; 2 $; If $ f\left(\left(a_{n}+b_{n}\right) &#x2F; 2\right)&#x3D;0 $，or its absolute value is within allowable error, the iteration stops and $ x&#x3D;\left(a_{n}+b_{n}\right) &#x2F; 2 $. The bisection method converges linearly, $ \frac{x_{n+1}-x_{f}}{x_{n}-x_{f}} \leq \delta&lt;1 $，which means it is slower than Newton’s method. But once you find an $ a_{0} &#x2F; b_{0} $ pair, convergence is guaranteed.</p></li><li><p><strong>Secant method</strong>: It starts with two initial values $ x_{0}, x_{1} $ and applies the iterative step<br>$$<br>x_{n+1}&#x3D;x_{n}-\frac{x_{n}-x_{n-1}}{f\left(x_{n}\right)-f\left(x_{n-1}\right)} f\left(x_{n}\right)<br>$$<br>It replaces the $ f^{\prime}\left(x_{n}\right) $ in Newton’s method with a linear approximation $ \frac{f\left(x_{n}\right)-f\left(x_{n-1}\right)}{x_{n}-x_{n-1}} $. Compared with Newton’s method, it does not require the calculation of derivative $ f^{\prime}\left(x_{n}\right) $，which makes it valuable if $ f^{\prime}(x) $ is difficult to calculate. Its convergence rate is $ (1+\sqrt{5}) &#x2F; 2 $，which makes it faster than the bisection method but slower than Newton’s method. Similar to Newton’s method, convergence is not guaranteed if initial values are not close to the root.</p></li><li><p><strong>Lagrange multipliers</strong>: The method of Lagrange multipliers is a common technique used to find local maximums&#x2F;minimums of a multivariate function with one or more constraints.</p><p>Let $ f\left(x_{1}, x_{2}, \cdots, x_{n}\right) $ be a function of $ n $ variables $ x&#x3D;\left(x_{1}, x_{2}, \cdots, x_{n}\right) $ with gradient vector $ \nabla f(x)&#x3D;\left\langle\frac{\partial f}{\partial x_{1}}, \frac{\partial f}{\partial x_{2}}, \cdots, \frac{\partial f}{\partial x_{n}}\right\rangle $. The necessary condition for maximizing or minimizing $ f(x) $ subject to a set of $ k $ constraints<br>$$<br>g_{1}\left(x_{1}, x_{2}, \cdots, x_{n}\right)&#x3D;0, \quad g_{2}\left(x_{1}, x_{2}, \cdots, x_{n}\right)&#x3D;0, \cdots, \quad g_{k}\left(x_{1}, x_{2}, \cdots, x_{n}\right)&#x3D;0<br>$$<br>is that $ \nabla f(x)+\lambda_{1} \nabla g_{1}(x)+\lambda_{2} \nabla g_{2}(x)+\cdots+\lambda_{k} \nabla g_{k}(x)&#x3D;0 $，where $ \lambda_{1}, \cdots, \lambda_{k} $ are called the Lagrange multipliers.</p></li></ul><h3 id="常微分方程"><a href="#常微分方程" class="headerlink" title="常微分方程"></a>常微分方程</h3><ul><li><p>Separable differential equations: A separable differential equation has the form $ \frac{d y}{d x}&#x3D;g(x) h(y) $. Since it is separable, we can express the original equation as $ \frac{d y}{h(y)}&#x3D;g(x) d x $. Integrating both sides, we have the solution $ \int \frac{d y}{h(y)}&#x3D;\int g(x) d x $.</p></li><li><p>First-order linear differential equations: A first-order differential linear equation has the form $ \frac{d y}{d x}+P(x) y&#x3D;Q(x) $. The standard approach to solving a first-order differential equation is to identify a suitable function $ I(x) $, called an integrating factor, such that<br>$$<br>I(x)\left(y^{\prime}+P(x) y\right)&#x3D;I(x) y^{\prime}+I(x) P(x) y&#x3D;\left(I(x)y \right)^{\prime}<br>$$</p></li><li></li></ul>]]></content>
      
      
      <categories>
          
          <category> 量化笔面试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 量化面试绿皮书 </tag>
            
            <tag> Quant-Interview </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>绿皮书刷题记录_02</title>
      <link href="/posts/e462bf4/"/>
      <url>/posts/e462bf4/</url>
      
        <content type="html"><![CDATA[<p>这是<a href="/tags/%E9%87%8F%E5%8C%96%E9%9D%A2%E8%AF%95%E7%BB%BF%E7%9A%AE%E4%B9%A6">绿皮书刷题记录系列</a>的第 2 篇。</p><h2 id="Trailing-Zeros"><a href="#Trailing-Zeros" class="headerlink" title="Trailing Zeros"></a>Trailing Zeros</h2><p>How many trailing zeros are there in 100! (factorial of 100)?</p><p>首先，1 到 100 已经存在 11 个 0。</p><p>其次，$2\times5&#x3D;10$，因此所有尾数为 2 和 5 的组合可以组成一个 0，因此又有 10 个 0。</p><p>再次，由于 $4\times25&#x3D;100$，因此所有 25 的倍数可以再多组成一个 0，即 25、50、75。注意虽然 $4\times100&#x3D;400$，但是相比 100 本来就有的两个 0，没有带来新的 0。因此又有 3 个 0。</p><p>还有没有更多的？有，但那是 $8\times128&#x3D;1000$，而100以内没有 125 的倍数，因此到此为止。</p><p>0 的数量：$11+10+3&#x3D;24$。</p><h2 id="Wise-Men"><a href="#Wise-Men" class="headerlink" title="Wise Men"></a>Wise Men</h2><p>A sultan has captured 50 wise men. He has a glass currently standing bottom down. Every minute he calls one of the wise men who can choose either to turn it over (set it upside down or bottom down) or to do nothing. The wise men will be called randomly, possibly for an infinite number of times. When someone called to the sultan correctly states that all wise men have already been called to the sultan at least once, everyone goes free. But if his statement is wrong, the sultan puts everyone to death. The wise men are allowed to communicate only once before they get imprisoned into separate rooms (one per room). Design a strategy that lets the wise men go free.</p><p>这道题的关键在于，要选出一个特定的“spokesman”，由这个人来判断是否所有人都已经被叫到过了。</p><p>既然已经选出了这么一个人，那么剩下的人要保证：</p><ul><li>每次被叫出来，必须传递“自己被叫出来了”这一信息；</li><li>如果被叫出来时上一个人的信息还没有被“spokesman”接收到，那么不可以破坏这一信息；</li><li>如果已经传递过一次信息了，那么接下来不能再次传递这一信息；</li><li>对于“spokesman”，如果接收到了信息，要通知下一个未传递信息的人传递信息。</li></ul><p>那么解法就比较明确了：</p><ul><li>对于“spokesman”，每次被叫出来都查看<strong>杯口是否朝下</strong>，朝下则说明有一个人传递过了信息。回去时，要保证<strong>杯口朝上</strong>；</li><li>对于其他人，如果未传递过信息且<strong>杯口朝上</strong>，则翻转杯子（传递信息）；如果已经传递过信息或者<strong>杯口朝下</strong>，则什么也不做。</li></ul><p>那么当“spokesman”数到第 49 次杯口朝下，则可以判断所有人都至少被叫出来过一次了。</p><h2 id="Missing-Integers"><a href="#Missing-Integers" class="headerlink" title="Missing Integers"></a>Missing Integers</h2><p>Suppose we have 98 distinct integers from 1 to 100. What is a good way to find out the two missing integers (within [1, 100])?</p><p>利用两个连续整数数列求和性质：<br>$$<br>\displaylines{\sum_{n&#x3D;1}^{N} n&#x3D;\frac{N(N+1)}{2}&#x3D;{N^2\over2}+{N\over2}\\<br>\sum_{n&#x3D;1}^{N} n^{2}&#x3D;\frac{N(N+1)(2 N+1)}{6}&#x3D;\frac{N^{3}}{3}+\frac{N^{2}}{2}+\frac{N}{6}}<br>$$<br>假设丢失的两个数为 $x$ 和 $y$，其他数为 $z_1,\dots,z_{98}$，那么我们可以列出两个关于 $x$ 和 $y$ 的式子：<br>$$<br>\begin{aligned}<br>&amp;\sum_{n&#x3D;1}^{100} n&#x3D;x+y+\sum_{i&#x3D;1}^{98} z_{i}\\ \Rightarrow &amp; x+y&#x3D;\frac{100 \times 101}{2}-\sum_{i&#x3D;1}^{98} z_{i}<br>\end{aligned}<br>$$</p><p>$$<br>\begin{aligned}<br>&amp;\sum_{n&#x3D;1}^{100} n^{2}&#x3D;x^{2}+y^{2}+\sum_{i&#x3D;1}^{98} z_{i}^{2}\\ \Rightarrow &amp; x^{2}+y^{2}&#x3D;\frac{100^{3}}{3}+\frac{100^{2}}{2}+\frac{100}{6}-\sum_{i&#x3D;1}^{98} z_{i}^{2}<br>\end{aligned}<br>$$</p><p>从而联立方程求解。</p><h2 id="Prisoner-Problem"><a href="#Prisoner-Problem" class="headerlink" title="Prisoner Problem"></a>Prisoner Problem</h2><p>One hundred prisoners are given the chance to be set free tomorrow. They are all told that each will be given a red or blue hat to wear. Each prisoner can see everyone else’s hat but not his own. The hat colors are assigned randomly and once the hats are placed on top of each prisoner’s head they cannot communicate with one another in any form, or else they are immediately executed. The prisoners will be called out in random order and the prisoner called out will guess the color of his hat. Each prisoner declares the color of his hat so that everyone else can hear it. If a prisoner guesses correctly the color of his hat, he is set free immediately, otherwise he is executed.</p><p>They are given the night to come up with a strategy among themselves to save as many prisoners as possible. What is the best strategy they can adopt and how many prisoners can they guarantee to save?</p><p>The two-color case is easy, isn’t it? What if there are 3 possible hat colors: red, blue, and white? What is the best strategy they can adopt and how many prisoners can they guarantee to save?</p><p>这道题被划分在“Modular Arithmetic”这一节里，但在我眼里依然是一个信息编码的问题。假设有 $n$ 种不同颜色的帽子由于每个人都知道其他人帽子是什么颜色，而自己帽子只有 $n$ 种可能，恰好第一个出去的人又能传递 $n$ 种信息，因此理论上是足以让剩下所有人知晓自己帽子颜色的。</p><p>题目的解法是，给各种颜色编码为 $0,1,\dots,n$，然后第一个人将剩下的人帽子颜色编码相加成为 $x$，如果 $x%n&#x3D;0$ 就报第一种颜色，以此类推。而剩下的人根据其所报出的颜色，就知道他们帽子颜色编码总和对 $n$ 的模是多少，每个不同的模都对应一种他们帽子的颜色。举例而言，如果一个人是第 2 种颜色，那么他将剩下的帽子编码加起来的和对 $x$ 取模就会得到 $n-1$，那么他自然知道自己帽子颜色的编码是 1，也就意味着他帽子属于第二种颜色。</p><h2 id="Division"><a href="#Division" class="headerlink" title="Division"></a>Division</h2><p>Given an arbitrary integer, come up with a rule to decide whether it is divisible by 9 and prove it.</p><p>首先，令<br>$$<br>a&#x3D;10^na_n+10^{n-1}a_{n-1}+\cdots+a_0<br>$$<br>又令 $x&#x3D;a_n+a_{n-1}+\cdots+a_0$，则<br>$$<br>a-x&#x3D;a_n(10^n-1)+a_{n-1}(10^{n-1}-1)+\cdots+a_1(10-1)<br>$$<br>注意，这里结果中的每一项都可被 9 整除，因此 $a-x$ 也可被 9 整除。</p><p>那么，如果 $x$ 可被 9 整除，也就能推出 $a$ 能被 9 整除。</p><p>类似地，下面讨论一个数能否被 11 整除的判断方法。</p><p>令<br>$$<br>y&#x3D; (-1)^{n} a_{n}+(-1)^{n-1} a_{n-1}+\cdots+a_{0}<br>$$<br>则<br>$$<br>a-y&#x3D;a_n\left(10^n-(-1)^n\right)+a_{n-1}\left(10^{n-1}-(-1)^{n-1}\right)+\cdots+a_1(10+1)<br>$$<br>注意，当 $n$ 为奇数时，我们有<br>$$<br>\left(10^n-(-1)^n\right)&#x3D;10^n+1&#x3D;(10+1)(10^n-10^{n-1}+\cdots+1)<br>$$<br>因而此时 $\left(10^n-(-1)^n\right)$ 可以被 11 整除。</p><p>而当 $n$ 为偶数时，我们有<br>$$<br>\left(10^n-(-1)^n\right)&#x3D;99(10^{n-1}+10^{n-2}+\cdots+1)<br>$$<br>因而此时 $\left(10^n-(-1)^n\right)$ 同样可以被 11 整除。</p><p>根据以上两个条件，我们可以证明 $a-y$ 可以被 11 整除。从而，如果 $y$ 可以被 11 整除则证明 $a$ 可以被 11 整除。</p><h2 id="Chameleon-Colors"><a href="#Chameleon-Colors" class="headerlink" title="Chameleon Colors"></a>Chameleon Colors</h2><p>A remote island has three types of chameleons with the following population: 13 red chameleons, 15 green chameleons and 17 blue chameleons. Each time two chameleons with different colors meet, they would change their color to the third color. For example, if a green chameleon meets a red chameleon, they both change their color to blue. Is it ever possible for all chameleons to become the same color? Why or why not?</p><p>这道题最简便的思路如下。</p><p>如果最后一个状态是只剩下一种颜色，那么倒数第二个状态必然是，某两个颜色都只剩下一个变色龙。那么在这个过程中，必然存在至少一个状态，使得某两种颜色的变色龙数量相等。</p><p>现在我们注意到，在变化过程中，两两颜色相对数量要么保持不变，要么相对数量变化为 3。那么 13、15 和 17 三个数字，两两不可能变化到相等的状态。因此不可能最后仅剩下一个颜色。</p><h2 id="Rainbow-Hats"><a href="#Rainbow-Hats" class="headerlink" title="Rainbow Hats"></a>Rainbow Hats</h2><p>Seven prisoners are given the chance to be set free tomorrow. An executioner will put a hat on each prisoner’s head. Each hat can be one of the seven colors of the rainbow and the hat colors are assigned completely at the executioner’s discretion. Every prisoner can see the hat colors of the other six prisoners, but not his own. They cannot communicate with others in any form, or else they are immediately executed. Then each prisoner writes down his guess of his own hat color. If at least one prisoner correctly guesses the color of his hat, they all will be set free immediately; otherwise they will be executed.</p><p>They are given the night to come up with a strategy. Is there a strategy that they can guarantee that they will be set free?</p><p>这道题的的思路仍然用到取模运算。将帽子颜色编码为 $0,1,\dots6$，那么约定好，从第 1 个人到第 7 个人，其猜测的自己的帽子颜色所对应的编码，和其他颜色编码加起来，对 7 取模的结果分别为 $0,1,\dots6$。</p><p>举例而言，如果第 1 个人看到其他人的颜色编码总和对 7 取模结果为 5，那么他就猜自己是第 3 种颜色；如果看到这个结果的是第 2 个人，那么他猜自己是第 4 种颜色，以此类推。</p><p>以这种方式，很巧妙地，虽然每个人猜的颜色都不一样，但是由于取模覆盖了所有结果，因此刚好覆盖了所有可能性。</p>]]></content>
      
      
      <categories>
          
          <category> 量化笔面试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 量化面试绿皮书 </tag>
            
            <tag> Quant-Interview </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>绿皮书刷题记录_01</title>
      <link href="/posts/974f7a4e/"/>
      <url>/posts/974f7a4e/</url>
      
        <content type="html"><![CDATA[<p><a href="https://books.google.com.hk/books/about/A_Practical_Guide_to_Quantitative_Financ.html?id=RosxmAYFFosC&redir_esc=y">《A Practical Guide to Quantitative Finance Interviews》</a>（俗称绿皮书）是一本经典的量化笔面试指南，内含大量量化笔面试中的真题。尽管这一本书在2008年即出版，但如今国内很多量化私募笔面试中仍包含与书内相同或相似的题目。因此若要准备量化笔面，这本书必不可少。</p><p>互联网上关于这本书的整理已经很丰富了，因此这一系列文章并不会对书中问题进行全盘整理，而是挑出部分题目进行整理。挑选标准大致如下：</p><ol><li>书中对题目解答不够完善的；</li><li>有自己额外思考探索的；</li><li>解法不易记忆，需要记录下来复习的。</li></ol><p>那么，让我们开始吧！</p><h2 id="River-Crossing"><a href="#River-Crossing" class="headerlink" title="River Crossing"></a>River Crossing</h2><p>Four people, A, B, C and D need to get across a river. The only way to cross the river is by an old bridge, which holds at most 2 people at a time. Being dark, they can’t cross the bridge without a torch, of which they only have one. So each pair can only walk at the speed of the slower person. They need to get all of them across to the other side as quickly as possible. A is the slowest and takes 10 minutes to cross; B takes 5 minutes; C takes 2 minutes; and D takes 1 minute.</p><p>What is the minimum time to get all of them across to the other side?</p><p>首先考虑一共需要多少次过桥。很显然，由于有 4 个人，而除了第一次过桥以外，每次都需要有一个人折返回来送火把，因此总共需要三次过桥，中间穿插两次折返。</p><p>由于 D 的过河速度最快，因此很容易想到的思路是全程让 D 左右运送 A、B 和 C 过桥。然而这意味着 A 和 B——两位最慢的人的过桥时间将叠加，无法达到最优。因此，要尽量令 A 和 B 同时过桥。</p><p>然而在这种策略下，不可能让 B 先过桥，再单独回来，再接上 A 过桥——这样实际上 B 要过三次桥，没有达到我们的目的。因此最好的策略下，应该完成 A 和 B 一次性过桥的目的。</p><p>继续考虑：A 和 B 这一组合应该什么时候过桥呢？如果 A 和 B 是第一组过桥，那么 A 或者 B 还是需要回来一趟，显然不可取。那么如果 A 和 B 作为第三组过桥，那么第二次折返时由谁折返传递火把？显然也不现实。那么唯一的解就在于，A 和 B 作为第二组过桥。那么显然，第一组和第三组都只能是 C 和 D（尽可能减少 A 和 B 的行动）。</p><p>现在考虑折返的情况。显然 C 和 D 都需要折返一次。那么对于两次折返，二者的顺序无关紧要，因为并不会影响总时间。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">A, B, C, D Left ---------------- Right</span><br><span class="line">A, B       Left ------C, D-----&gt; Right</span><br><span class="line">A, B       Left ---------------- Right C, D</span><br><span class="line">A, B       Left &lt;------D-------- Right C</span><br><span class="line">A, B, D    Left ---------------- Right C</span><br><span class="line">D          Left ------A, B-----&gt; Right C</span><br><span class="line">D          Left ---------------- Right A, B, C</span><br><span class="line">D          Left &lt;------C-------- Right A, B</span><br><span class="line">C, D       Left ---------------- Right A, B</span><br><span class="line">           Left ------C, D-----&gt; Right A, B, C, D</span><br></pre></td></tr></table></figure><p>总时长：$2+1+10+2+2&#x3D;17$。</p><h2 id="Burning-Ropes"><a href="#Burning-Ropes" class="headerlink" title="Burning Ropes"></a>Burning Ropes</h2><p>You have two ropes,each of which takes 1 hour to burn. But either rope has different densities at different points,so there’s no guarantee of consistency in the time it takes different sections within the rope to burn. How do you use these two ropes to measure 45minutes?</p><p>这类题目非常经典也烂大街，但是每次都忘记怎么解。</p><p>关键问题在于，在一根绳子的总燃烧时间是一小时的情况下，如何同一根绳子刻画其他的时间长度？</p><p>答案是，<strong>从绳子两边同时开始燃烧</strong>，这样可以保证绳子烧完时用时刚好半小时。</p><p>这道题的解答需要用到两次这一性质。一开始先将绳子 A 从一端开始燃烧，绳子 B 从两端同时开始燃烧。当绳子 B 燃烧结束时，绳子 A 还剩半小时。此时从另一端开始燃烧绳子 A，则剩下的时间刚好 15 分钟。</p><p>稍微扩展一下：两根这样的绳子，可以衡量哪些时长的时间？答案是 15 分钟、30 分钟、45 分钟、1 小时、1 小时  30 分钟、2 小时。</p><h2 id="Defective-Ball"><a href="#Defective-Ball" class="headerlink" title="Defective Ball"></a>Defective Ball</h2><p>You have 12 identical balls. One of the balls is heavier OR lighter than the rest (you don’t know which). Using just a balance that can only show you which side of the tray is heavier, how can you determine which ball is the defective one with 3 measurements?</p><p>从信息论的角度来看，这道题意味着：每一次测量都给出三种状态：大于、小于和等于。而若要用这三种状态来进行编码，能够覆盖的可能性数量为 $3^3&#x3D;27$ 种。由于这道题中只有 12 颗球，且不一致的那颗球要么轻了要么重了，因此一共存在 $12\times2&#x3D;24$ 种情况，因此理论上 3 次测量是有可能找出不同的那颗球，并判断其是轻是重的。</p><p>那么从这个角度来看，每次测量都应当尽可能使得可能的情况数量坍缩到原来的 $1&#x2F;3$。譬如说刚开始我们平均分为三组 A、B、C，则存在6种等可能的情况：A 重、A 轻、B 重、B 轻、C 重、C 轻。假设第一次比较 A 和 B 的重量，无论结果如何，都只会剩下两种等可能的情况：</p><table><thead><tr><th>结果</th><th>剩余的可能情况</th></tr></thead><tbody><tr><td>$A&#x3D;B$</td><td>C 重、C 轻</td></tr><tr><td>$A&gt;B$</td><td>A 重、B 轻</td></tr><tr><td>$A &lt; B$</td><td>A 轻、B 重</td></tr></tbody></table><p>考虑 $A&#x3D;B$ 的情况，此时特殊的球必然在 C 中，存在 8 种情况。如果将 C 分为两组比较？那么情况将坍缩为原来的 $1&#x2F;2$，究其原因在于“相等”这一结果先验不可能发生。这种情况下，仍然剩下 4 种情况，不可能找出答案。那么需要效仿第一次测量的方式，留下一颗球（如果留下两颗球，仍然可能剩余 4 种情况），剩下的 3 颗球其中两颗分为一组，另一颗与 A 或 B 组中的一颗球分为一组（注意此时已经知道 A 和 B 中都是正常球）。无论这一测量结果如何，都只剩下不到 3 种情况，剩下过程这里不展开。</p><p>接下来，考虑 $A&gt;B$ 的情况（$A&lt;B$ 的情况类似）。下一步我们选取球来测量的原则是，必须要同时拥有产生三种结果（即大于、小于和相等）的可能，且无论我们得到什么什么结果，都必须使得可能情况坍缩至不多于 3 样（这意味着，也不能少于 2 样）。因此我们很容易排除以下策略：</p><table><thead><tr><th>在剩下的球中选取测量的球数</th><th>排除原因</th></tr></thead><tbody><tr><td>8</td><td>不可能产生“相等”这一情况</td></tr><tr><td>7</td><td>若相等，则仅剩下 1 种情况</td></tr><tr><td>小于或等于 4</td><td>若相等，则剩下多于 3 种情况</td></tr></tbody></table><p>这样看来，我们要么选 5 个球来比较，要么选 6 个球来比较。从实践的角度来看，我们是没有被禁止在比较过程中加入 C 组正常球的，下文具体分析。</p><p>若选择 6 个球来比较，无外乎 6 种方法，其它方法都与其中一种等价或类似：</p><table><thead><tr><th>选取方式</th><th>分析</th></tr></thead><tbody><tr><td>（A1、A2、A3）vs（B1、B2、B3）</td><td>不存在“相等”的可能性，排除</td></tr><tr><td>（A1、A2、B3）vs（B1、B2、A3）</td><td>如果 $A&gt;B$，则剩下 4 种情况，排除</td></tr><tr><td>（A1、A2、B1）vs（A3、A4、B2）</td><td>无论什么结果，仅剩下不到 3 种可能，可行！</td></tr><tr><td>（A1、A2、A3）vs（A4、B1、B2）</td><td>若 $A&gt;B$，则剩下 5 种情况，排除</td></tr><tr><td>（A1、A2、A3、A4）vs（B1、B2、C1、C2）</td><td>不存在“小于”的可能性，排除</td></tr><tr><td>（A1、A2、A3、B1）vs（A4、B2、C1、C2）</td><td>若 $A&gt;B$，则剩下 4 种情况，排除</td></tr></tbody></table><p>现在我们找到了第一个可行的策略，即（A1、A2、B1）vs（A3、A4、B2）。以这一策略为基础，剩下的步骤不展开。</p><p>若选择 5 个球来比较，无外乎 6 种方法，其它方法都与其中一种等价或类似：</p><table><thead><tr><th>选取方式</th><th>分析</th></tr></thead><tbody><tr><td>（A1、A2、A3、A4）vs（B1、C1、C2、C3）</td><td>不存在“小于”的可能性，排除</td></tr><tr><td>（A1、A2、A3、B1）vs（A4、C1、C2、C3）</td><td>不存在“大于”的可能性，排除</td></tr><tr><td>（A1、A2、A3）vs（B1、B2、C1）</td><td>不存在“小于”的可能性，排除</td></tr><tr><td>（A1、A2、B1）vs（A3、B2、C1）</td><td>无论什么结果，仅剩下不到三种可能，可行！</td></tr></tbody></table><p>现在我们找到了另一个可行的策略，即（A1、A2、B1）vs（A3、B2、C1）。以这一策略为基础，剩下的步骤不展开。</p><p>解答已经完成。可以看到，即使已经具备解题思路，由于可能性比较复杂，要解释清楚整个策略依然不是一件轻松的任务。这个思路的关键在于测量作为一次信息编码的作用。理解这一点，才能够系统性地解答这个问题。</p>]]></content>
      
      
      <categories>
          
          <category> 量化笔面试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 量化面试绿皮书 </tag>
            
            <tag> Quant-Interview </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习Day9（大结局）</title>
      <link href="/posts/f9ae7c0f/"/>
      <url>/posts/f9ae7c0f/</url>
      
        <content type="html"><![CDATA[<p>今天早上mentor的一记电话直接宣告了我长达9日实习生涯的终结。电话上mentor直言我的基本面研究经验和能力没有达到她的预期（她本来以为可以开箱即用），而且效率比较低（28篇研报用一周才读完，正常应该两天），正好这段时间各家机构都在开暑期，我可以去寻求其他机会。</p><p>让我自己意外的是，这没有带给我很大的情绪波动——毕竟上一次我终面被拒之后郁闷地跑到神仙胡走了一圈。猜想有几个原因：</p><ul><li><p>过往的求职经验表明，尽管量化的实习很难找，但并不是完全找不到。而舍友和学长也都表示不用太着急。</p></li><li><p>我对我的研究能力比较了解，目前确实达不到她的预期（我需要从0开始慢慢成长）。但是另一方面，我通过这几天的工作同样学到很多，并认识到看上去很神秘的量化行业同样是由草台班子组成。简而言之，我认为我仍可以继续尝试这个行业，并且相信自己可以快速成长。</p></li><li><p>我同样不喜欢这家公司。</p></li></ul><p>既然情绪上没有问题，那就摆正心态继续投递别的量化岗位，并趁此机会复盘一下这次实习。</p><h2 id="实习复盘"><a href="#实习复盘" class="headerlink" title="实习复盘"></a>实习复盘</h2><h3 id="投递"><a href="#投递" class="headerlink" title="投递"></a>投递</h3><p>与实习内容上不断碰壁不同，我进入这家公司的过程反而格外轻松。一般私募都起码要一笔一面，有的还有二面三面；但是这家公司在我下午投简历后立马约了第二天上午的电话面试，面了半小时就直接在电话中发了offer……这个招聘流程甚至让我产生怀疑，因此我在向学长确认过后才接受了这个offer。</p><p>一天300、远程实习、朝九晚五、百亿私募的title，这些条件其实令我非常满意。因此我后面的笔面基本上都以体验为主，打定主意要在这家公司实习一段时间，甚至留用。</p><h3 id="首个项目"><a href="#首个项目" class="headerlink" title="首个项目"></a>首个项目</h3><p>按照mentor的说法，对我的考核分为三步：</p><ol><li>检验我此前做过的项目成色如何；</li><li>让我阅读研报并总结，检查我的insight如何；</li><li>忘记了。我没有通过第2步。</li></ol><p>因此我实习的第一个任务，就是将之前做过的某个项目写成报告提交给她。</p><p>本来这个任务并不算麻烦，我也认真组织了一篇报告，但是她一通电话直接指出我做的很粗糙，也没有遵循一些基本的标准。我寻思不知道我就学呗，这些也不至于多难。这个项目就这么结束了，除了报告以外什么都没有提交。</p><h3 id="研报阅读"><a href="#研报阅读" class="headerlink" title="研报阅读"></a>研报阅读</h3><p>第一个项目完成后，mentor直接甩给我28篇研报，并让我阅读后总结，重点是判断哪些值得复现，哪些应该忽略。这件事不难，但是需要时间。由于我基本没读过几篇研报（5篇以下），可能需要先慢慢来熟悉，因此我提出大概需要一周时间。</p><p>mentor回复：😂😂😂😂</p><p>然后没有了下文。</p><p>从这时我就感觉不太对劲，但是秉持着我自己不能内耗的原则，我也就没有回复，而是开始按照一周完成的标准来分配每日任务。</p><p>其实就是一天五篇研报，虽然一开始读的比较慢，甚至需要加一会班才能完成，但是从第3天开始基本都能提前一两个小时读完。我以为这个任务会顺利地持续到周五我将总结报告提交给老板……</p><p>周五上午，mentor先是要走了我目前整理的内容，然后又一通电话打进来，于是发生了本文开头的那一段发言。</p><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>由于突然的解聘对我的心态并没有造成很大的影响，因此我在中午吃饭前就投出了30多份简历，并决定下午去图书馆刷刷面试题。</p><p>总的来说，这是一份钱还可以（很久没有赚钱过了），但是经历很不愉快的一场实习，至少对我来说没有什么遗憾。但是在这几天里学到的知识，以及对量化这个行业更加深刻的认识，对于我而言同样是一次可贵的丰富。</p><p>用李白的这句诗作结：</p><center>仰天大笑出门去，我辈岂是蓬蒿人。</center>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习Day8</title>
      <link href="/posts/45f2a69a/"/>
      <url>/posts/45f2a69a/</url>
      
        <content type="html"><![CDATA[<p>今天顺利提前完成5篇研报，并四点跑到罗湖去自提了一个二手显示器（没有包装，提得我的手臂都要崩溃了）。总的来看现在阅读研报比之前要更快，也更容易提取关键信息。继续总结一下今天的思考与收获吧。</p><h2 id="研报的可信度"><a href="#研报的可信度" class="headerlink" title="研报的可信度"></a>研报的可信度</h2><p>这几天越来越强烈的一种感受是，对于阅读的这些研报中的结论没有信心。一方面是因为这些研报肯定有一定夸大成分，只挑好的数据展示；另一方面，很多研报对因子及其参数都采用搜索方式寻找，而回测的时候又都用的是相同的时间区间，可能会有过拟合的问题，样本外收益能不能达到回测结果都难说。因此我特别关注研报在测试的时候有没有划分训练集和测试集（绝大部分都没有），以及因子是否有经济解释（这样一般参数比较少，而且更令人信服）。</p><p>偶然发现有的研报并不是提供新的策略，而是跟踪此前的策略并发布新的收益情况，这种研报应该多加关注。比如今天读到两篇这样的研报，其中一篇很显然在样本外超额非常拉跨，而另一篇则继续保持了稳健的超额收益，这样的策略会让我非常感兴趣。</p><h2 id="因子的超额收益"><a href="#因子的超额收益" class="headerlink" title="因子的超额收益"></a>因子的超额收益</h2><p>另一个思考关于“超额收益”这一指标。超额收益是用于检验因子是否能够带来比直接投资基准大盘更好的收益，通常的计算方法是直接将净值曲线减去基准曲线得到超额曲线，如果超额的符号为正则意味着因子带来了额外的收益。</p><p>但是我认为这样的做法存在一些隐患。超额收益实际上应该叫做“累计超额收益”，因为它涵盖了过去的回测信息。这个指标的问题在于，很多研报把正的累计超额收益当作是好因子的评价标准，但问题是，你的累计超额收益虽然在前面一直增长，但是最后两年却在下降，只不过没有下降到0以下。你的因子实际上已经失效了，只不过这不能反映在累计超额收益的符号上。基于这个想法，应该将“累计超额收益”转化回真正的“超额收益”，即每一期相对于基准多赚了多少钱。</p><p>这可能还不够。打个比方，假设存在一个10年的回测期，因子在第一年将资产扩大到基准的两倍，此后将所有资金直接用于配置基准大盘。那么如果大盘在今后9年里一直保持上升态势，那么超额收益就会一直扩大——因为超额收益的算法是净值减去资产，而资产上升的幅度一定大于基准上升的幅度。那么后面9年的超额收益完全不是因子的功劳，但在图像上看却像是因子在不断创造收益。</p><p>因此，考虑将净值与基准之比作为衡量标准。当这个比值扩大时，意味着因子继续带来额外的收益；当这个比值保持不变时，无论此时超额是扩大还是缩小，都不意味着因子继续带来任何额外的收益或者损失；当这个比值缩小时，则因子恐怕面临失效的风险。</p><p>这一类指标目前似乎没有看到什么研报在使用。量化本来就是极致的工程艺术，今后若要分析因子的好坏，需要以更加细致的标准进行评估。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习Day7</title>
      <link href="/posts/d54dbb0b/"/>
      <url>/posts/d54dbb0b/</url>
      
        <content type="html"><![CDATA[<p>今天鼓起勇气向mentor问了一个问题。毕竟她之前电话似乎不满意我与她交流的频率，而我这几天读研报又没有啥很想问的问题😓。</p><p>今天的研报收获不多，分享一下对于一个因子好坏的判断方式。</p><h2 id="好因子or坏因子？"><a href="#好因子or坏因子？" class="headerlink" title="好因子or坏因子？"></a>好因子or坏因子？</h2><p>挖因子是为了丰富策略，策略是为了赚钱。因此我们挖因子最终的目的还是为了赚钱。那么只有能赚钱的才是好因子吗？</p><p>因子的作用在于选出那些比较好的股票，或者在某一股票里选择一个好的时间买卖。然而众所周知，近年来大A指数行情很不好。在这种情况下，市场大部分的股票表现都相对糟糕。考虑一个因子的胜率在60%，假如市场处于震荡行情，那么我们可以预期这一因子选股带来的效果是稳定而缓慢的上升；而如果市场处于趋势上升行情，那么预期这一因子会带来相对更高的收益；而如果市场的趋势是掉头向下的，那么这个因子的效果可能是跌得比基准更少——但依然是下跌的！</p><p>同样的因子，在不同的市场行情中带来的收益也不同。从赚钱的角度来考虑，我们当然只想要正收益。但是在不理想的行情下，如果能少亏一点也能接受。这就是为什么因子的评估应该更加关注超额这一指标。即使总体收益不好，但是如果这一因子能够产生稳定的超额，那么当市场行情好转时，就可以预期这一因子会带来高收益。</p><h2 id="因子评价标准"><a href="#因子评价标准" class="headerlink" title="因子评价标准"></a>因子评价标准</h2><p>这部分根据我目前为止读到的研报，整理一系列用于评价因子好坏的标准（指标含义解释来自ChatGPT）。</p><h3 id="IC类："><a href="#IC类：" class="headerlink" title="IC类："></a>IC类：</h3><ul><li>IC (Information Coefficient)：信息系数，衡量模型预测值与实际值之间的相关性。取值范围为[-1,1]，越接近1表示模型预测与实际值越相关。</li><li>IC均值 (Mean IC)：信息系数的平均值，用于评估模型整体预测准确性。</li><li>IC的t-统计量 (IC t-statistic)：信息系数的t统计量，用于判断信息系数是否显著不同于0，通常t统计量的绝对值大于2表示显著性。</li><li>累计IC (Cumulative IC)：信息系数的累积值，表示在一段时间内模型预测与实际值的累积相关性。</li><li>IC_IR：信息系数的IR值，即IC均值除以IC的标准差，用于衡量预测的一致性和准确性。</li></ul><h3 id="回测类："><a href="#回测类：" class="headerlink" title="回测类："></a>回测类：</h3><ul><li>收益率 (Return)：资产价格或投资组合价值的变化率，通常以百分比表示。</li><li>年化收益率 (Annualized Return)：投资组合的年化收益率，通常用于比较不同时间跨度的投资表现。</li><li>超额收益率 (Excess Return)：投资组合或资产的收益率减去某个基准收益率后的差值。</li><li>最大回撤 (Maximum Drawdown)：投资组合或资产价值从最高点下降到最低点的最大幅度，用于衡量投资风险。</li><li>夏普比率 (Sharpe Ratio)：投资组合或资产的平均超额收益率与风险（通常以标准差衡量）之比，用于衡量单位风险所获得的超额收益。</li><li>波动率 (Volatility)：资产价格或投资组合价值的变动程度，通常用标准差表示。</li><li>年化波动率 (Annualized Volatility)：波动率的年化值，用于比较不同时间跨度的波动性。</li><li>信息比率 (Information Ratio)：投资组合或资产的超额收益率与基准超额收益率之比，用于衡量主动管理的有效性。</li><li>收益风险比 (Return&#x2F;Risk Ratio)：投资组合或资产的年化收益率与年化波动率之比，用于衡量风险调整后的收益。</li><li>胜率 (Winning Rate)：投资组合或交易策略的获胜次数与总交易次数之比。</li><li>换手率 (Turnover Rate)：投资组合中资产的交易频率与总资产的比率，用于衡量资产的交易活跃度。</li><li>盈亏比 (Profit&#x2F;Loss Ratio)：盈利交易的平均盈利额与亏损交易的平均亏损额之比。</li><li>Calmar比率 (Calmar Ratio)：投资组合或资产的年化收益率与最大回撤之比，用于衡量风险调整后的收益与风险之间的关系。</li><li>因子分组单调性 (Monotonicity of Factor Grouping)：因子分组的单调性，指随着因子值增加（或减少），分组收益率的单调性，用于评估因子分组的有效性。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习Day6</title>
      <link href="/posts/a24a8b9d/"/>
      <url>/posts/a24a8b9d/</url>
      
        <content type="html"><![CDATA[<p>今日再次看完5篇研报，距离完成28篇的任务还剩14篇。预计周五全部完成，再接再厉。</p><p>今天读到两个比较有趣的观点。</p><h2 id="为什么因子会失效？"><a href="#为什么因子会失效？" class="headerlink" title="为什么因子会失效？"></a>为什么因子会失效？</h2><p>众所周知，大部分量化研究无非不停地挖掘因子。这些因子被使用当然是因为在回测中表现了不错的效果，换言之在历史数据上“有效”。但是目前量化行业的现状是挖掘出的因子往往很快就会失效，不再能带来收益。为了保证持续不断的收益，就必须不停地挖掘新的因子。</p><p>因子失效的原因有很多，最容易想到的原因来自于<a href="https://zh.wikipedia.org/zh-cn/效率市場假說">市场有效假说</a>。一个因子如果有效，就会被大家都不断地挖出来，而如果大家都使用这个因子，那么就大家都赚不到钱。</p><p>而今天研报的观点认为，因子会随着市场风格的变化而变得有效或者失效。这也是很好理解的，比如如果市场行为更倾向于价值投资，那么估值因子就会倾向于有效。那么今天的例子是什么呢？对于行业轮动的因子来说，其是否有效，与行业轮动的速度有关，即与赚钱的行业的更替迭代速率有关。</p><p>当然，行业轮动速度并不是一个常常变化的量，但是从2019年起到2023年中，A股的行业轮动速度确实在不断加快。相应的，某些仅在慢轮动时期成立的因子，现在变得不成立了。</p><p>这些因子具体是什么并不是最重要的。重要的是，认识到因子会随市场风格变化而效果发生变化的事实。一个因子失效了不代表它未来不会重新有效，反之亦然。</p><h2 id="行业动量和个股动量的不同特征"><a href="#行业动量和个股动量的不同特征" class="headerlink" title="行业动量和个股动量的不同特征"></a>行业动量和个股动量的不同特征</h2><p>动量效应在外股有效，在A股却变得无效了，为什么？有文章认为是因为A股的散户交易规模较大，导致A股动量因子失效。</p><p>今天的文章认为，动量在个股上失效乃至表现为反转，但是在行业上仍是成立的。那么为什么两个层次会表现出相反的特征？</p><p>我们将价格变动拆解为盈利变动和估值变动两部分：<br>$$<br>\displaylines{<br>{Price_{T+1}\over Price_T}&#x3D;{PE_{T+1}\over PE_T}\times{Earning_{T+1} \over Earning_T}\\<br>\Updownarrow<br>\\<br>1+r_{index}&#x3D;1+g+r_{pe}+g\times r_{pe}<br>}<br>$$<br>盈利变动相关动量因子在个股上是有效的，但是估值却不会。这是由于市场投资者局部的交易习惯， 局部错误定价导致短期个股估值呈现较强负相关。</p><p>那么，如果要构造能够在个股上有效的动量因子，就可以考虑剔除其中的估值因素。具体方式这里不展开。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一种新的因子组合方式设想</title>
      <link href="/posts/4a366572/"/>
      <url>/posts/4a366572/</url>
      
        <content type="html"><![CDATA[<p>传统的多因子组合方式，我目前见到过两种：</p><ul><li>因子打分。若现有多个因子，当因子值大于零意味着预测价格上涨，因子值小于零意味着价格下跌，那么可以将这些因子对资产一一打分，若某一因子对某一资产的值为正，则+1分，否则-1分。那么择股的时候，可以选取分数较高的股票。</li><li>因子合成。这是一种将多个因子合成为一个因子的做法，比如简单求均值、加权求均值等。</li></ul><p>这两种方法都有一定程度上的问题。因子打分可以很好地让所有因子都参与到选股中，但是如果因子数量不多，很容易造成存在很多股票的分数相同的情况，不好选股。而因子合成则难以确定权重，特别是在不同因子的数量级差别很大的情况下。</p><p>因此，构想一种新的因子组合方法，尽管还没有实现：将所有股票按照所有因子的值从小到大排序，并将这些排序值相加，选取排序值总和最大的股票。如果要剔除相关性较大的股票，只需要剔除排序值总和较小的那一只股票，并继续向下搜索即可。这样的方式可以保证每个因子都具有相同的决策权重，且最后总分相同的情况应当不多。</p><p>设想一个问题，假如两只股票在某个因子的数值相同呢？对于这样的场景，可以考虑将两只股票的排名平均一下，比如如果有4支股票在某一因子下并列第一，那么其排名都等于 ${1+2+3+4\over4}&#x3D;2.5$。</p><p>当然，这一因子组合方式也存在弊端，比如无法对因子进行加权，所有因子都具有相同的权重。为了规避这个问题，可以考虑给因子排序后的排名加权，比如某一因子的排名都除以2；也可以考虑将某一因子的值都减少0.5，使得因子排序值相同时，优先考虑另一因子。</p>]]></content>
      
      
      <categories>
          
          <category> 量化交易 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习Day5</title>
      <link href="/posts/3b43da27/"/>
      <url>/posts/3b43da27/</url>
      
        <content type="html"><![CDATA[<p>今日5篇研报读毕，感觉学到不少。</p><p>首先是认识到，大部分金工研报都很一般。仅仅是拿几个因子出来测一下IC并组合回测一下，就能够凑成一篇文章，然而这样的文章往往参考价值不大。因为这样的内容中缺少了分析过程，使得这些因子即使表现良好，也无法令人信服。更遑论大部分研报对于因子的测试并不完整，存在大量过拟合问题。因此作为一名阅读者，挖掘好的研报犹如沙里淘金。</p><p>其次是对于因子测试的批判性思考。即使一个因子没有很强的经济学解释，如果它的测试结果成立，我们仍然可以短期内（趁这个因子还没有失效）使用这一因子进行交易。但这对于测试过程提出了更高的要求。举例而言，如果是利用诸如遗传规划的方法来批量生成的因子，那么不但要划分出训练集来生成因子、划分出验证集来筛选因子，还需要划分出测试集来最终测试模型是否成立。当然，如果连训练集都没有划分出来，这样的结果可信度自然大打折扣。</p><p>以上是今日的大致收获。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习Day4</title>
      <link href="/posts/4c44eab1/"/>
      <url>/posts/4c44eab1/</url>
      
        <content type="html"><![CDATA[<p>今天本来挺正常的，mentor给了29篇研报，让我读完并写成总结报告。这算是一个比较大的工程，我一天也没读完两篇，到下班的时候才大概给研报分了类别，并确定了报告的结构。</p><p>但是今早mentor的一通电话直接让我压力升高。根据她的意思，对我目前的成果并不满意：她招我是因为看中了我的基本面和行业轮动项目经历，但是这两天经过考察我之前的项目，发现做的很粗糙，并没有达到她的预期。同时，她发现我存在一些不该存在的问题，比如说交易没有滞后、分位回测没有等权等等。她目前的实习生做的工作以高频为主，我可能是唯一一个做这方面工作的实习生，而我的这个方向更加简单。总之，就是简单而做的不好。但是她对我的期望和要求又很高，因为这个岗位是奔着留用去的，所以我应该好好干。</p><p>好好干我没问题，但是万一干得不好怎么办……再加上我五一前还想请几天假，这样看来都不知道有没有戏😟。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习Day3</title>
      <link href="/posts/d2207f12/"/>
      <url>/posts/d2207f12/</url>
      
        <content type="html"><![CDATA[<p>最简单的一天，早上mentor发现我的选股不是等权的，稍微修改了一下提交，然后请了下午的考试假，结果一个早上都没有再找我🤣。直接美美下班。值得注意的是不细心再次体现了出来，感觉这种缺点在量化策略中是比较危险的，改正改正。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习Day2</title>
      <link href="/posts/a5274f84/"/>
      <url>/posts/a5274f84/</url>
      
        <content type="html"><![CDATA[<p><img src="/posts/a5274f84/weekly_normal.svg"></p><p>今天同样是朝九晚五的一天（对这个节奏还算满意）。按照mentor的要求，将原本实现的策略中包含的两个因子分别提取出来，并对其在日频和周频的条件下分别进行分层的测试。</p><p>这个过程的工作量令人意外，因为如果我的代码框架合理，因该很容易将两个因子分别拿出来做测试，但是由于代码结构比较混乱，错综复杂，因此这个过程也显得相当痛苦。最后我决定顺带稍微优化一下，将部分过程写成函数并塞到一个module里，再从notebook里面引入。但是由于加入了一些新的参数，某些逻辑被大大复杂化了，导致我的代码变得更加屎山……但由于仅仅是用来测试，应该结果不会太严重，大不了之后再优化好了。</p><p>我的回测系统混乱不堪，为了实现日频和周频两种回测频率，我甚至需要对这两种情况分别写一个函数，且每一个函数都很长，其中还有八九个参数的嵌套函数。总而言之，我的这套代码是相当臃肿丑陋的。也许我应该重新学一下一些现成的回测系统，比如<code>backtrader</code>。</p><p>今天还学到一个之前一直忽略但实际上不该忽略的小细节。我的因子根据当天的收盘价和份额来计算得出，那么我不可能用当天的收盘价来进行交易。对于一个以这样方式形成的因子，我最快也只能在第二天开盘的时候进行交易。在修正这一问题后，我的收益曲线果然变得没有那么好了，看来因子对于收益率的贡献衰减可能会很快。</p><p>现在依然不清楚我常态化工作的方式是如何。如果一直像这样复现研报——测试——提交代码的话，也许会有一天感到枯燥。让我们拭目以待。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>量化实习Day1</title>
      <link href="/posts/3c2e1e3e/"/>
      <url>/posts/3c2e1e3e/</url>
      
        <content type="html"><![CDATA[<p>今日正式入职某量化私募，感觉总算是正儿八经开始实习了，有些许激动，也期待挑战。唯一不满的就是mentor不说啥时候上下班，虽然招聘简介上写的是8:30-17:00，那我是不是可以理解为五点可以直接消失？毕竟我是远程实习。</p><p>看得出来mentor确实对我之前的实习内容感兴趣，上来就让我更新数据+额外跑周频数据+写报告。没想到这个去年的策略现在依然能够有超额，但是没好意思告诉mentor这里面严格来讲使用了未来数据……Anyway，我估计这一问题应该不难规避，就先放着没管。</p><p>干中学还是能够学到不少技巧，比如发现SMA有很多种实现方式。按照网上的说法，用<code>numpy</code>或者<code>numba</code>应该能够取得比<code>Pandas</code>的<code>rolling()</code>方法更高的效率，但是实践中发现好像区别不大。</p><p>最后，发现自己写的代码也越来越屎山了。如果真的要用这个策略的话也许应该重构一下。</p>]]></content>
      
      
      <categories>
          
          <category> 量化实习日记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 实习 </tag>
            
            <tag> 日记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Quant求职知识技能经历补全计划</title>
      <link href="/posts/7f1863a0/"/>
      <url>/posts/7f1863a0/</url>
      
        <content type="html"><![CDATA[<p>前段时间投递了一些量化私募实习，发现量化这个行业确实要求候选人知识面非常广泛，且不同的企业重点考察的方向也不同。因此根据自身经历和身边的信息，总结了一下量化笔面所大致涵盖的知识技能，以便于准备笔面时参考复习。</p><table><thead><tr><th align="center">数学</th><th align="center">计算机</th><th align="center">金融</th><th align="center">经历</th></tr></thead><tbody><tr><td align="center">微积分</td><td align="center">Python基础</td><td align="center">金融衍生品</td><td align="center">实习</td></tr><tr><td align="center">线性代数</td><td align="center">C&#x2F;C++基础</td><td align="center">投资学</td><td align="center">竞赛获奖</td></tr><tr><td align="center">概率论</td><td align="center">数据结构与算法</td><td align="center">宏观经济学</td><td align="center">科研经历及论文发表</td></tr><tr><td align="center">随机过程</td><td align="center">pandas</td><td align="center">微观经济学</td><td align="center">实盘策略</td></tr><tr><td align="center">统计学</td><td align="center">机器学习</td><td align="center">博弈论</td><td align="center"></td></tr><tr><td align="center">数论</td><td align="center">深度学习</td><td align="center">资产定价</td><td align="center"></td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> 量化交易 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Quant </tag>
            
            <tag> 职业发展 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
